â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ ç²¾ç®€ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
â¦¿ è¯¦ç»†å‚è€ƒ â˜…â˜…â˜…â˜…â˜…  http://www.jianshu.com/p/50b37ee596e0
â¦¿ è¯¦ç»†å‚è€ƒ â˜…â˜…â˜…â˜…â˜…  https://kisspuppet.gitbooks.io/puppet/chapter3.html

ğŸ”µ ç«¯å£ 
    å®¢æˆ·ç«¯å®šæ—¶è¿æ¥æœåŠ¡å™¨. åªè¦æœåŠ¡å™¨ç«¯å£å¼€äº†å°±è¡Œ.å®¢æˆ·ç«¯ç«¯å£ä¸ä¸€å®šè¦å¼€å¯çš„.

    agent  : 8139/tcp ã€ master : 8140/tcp
    
    lsof -i:8140
    nmap -p 8139,8140 127.0.0.1
    ss ???




ğŸ”µ ç›®å½• / é…ç½®

    ğŸ”¸ è½¯ä»¶æ€» ç›®å½•     cd /etc/puppetlabs  
    ğŸ”¸ agent  ç›®å½•     cd /etc/puppetlabs/puppet 
    ğŸ”¸ server ç›®å½•     cd /etc/puppetlabs/puppetserver

    ğŸ”¸ agent  é…ç½®     vi /etc/puppetlabs/puppet/puppet.conf    
    ğŸ”¸ server é…ç½®     vi /etc/puppetlabs/puppetserver/puppetserver.conf

    ğŸ”¸ agent  ssl:     /etc/puppetlabs/puppet/ssl            
    ğŸ”¸ server ssl:     /etc/puppetlabs/puppetserver/ssl            

    ğŸ”¸ server æ¸…å•:     vi /etc/puppetlabs/code/environments/production/manifests/site.pp
    ğŸ”¸ server æ¨¡å—:     cd /etc/puppetlabs/code/environments/production/modules


ğŸ”µ ç›®å½•ç®€ä»‹
    manifests      # puppetè„šæœ¬ä¸»æ–‡ä»¶ç›®å½•ï¼Œsite.ppæ–‡ä»¶å¿…é¡»å­˜åœ¨
    modules        # puppetæ¨¡å—ç›®å½•

  



ğŸ”µ å¸¸ç”¨å‘½ä»¤

    ğŸ”…puppet help agent       æŸ¥çœ‹agentè¯¥å­å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•.
        puppet agent -V       æŸ¥çœ‹ç‰ˆæœ¬
        puppet agent -v       è¯¦ç»†è¾“å‡ºå‘½ä»¤.  
        puppet agent -t       æµ‹è¯•+è¿è¡Œ.
        puppet agent --noop   æ¨¡æ‹Ÿè¿è¡Œ.

    ğŸ”¸è¯ä¹¦ç›¸å…³å‘½ä»¤:.
        puppet cert list                     åˆ—å‡ºæœªç­¾åè¯·æ±‚. (æœªç­¾åæœ€å‰é¢æ²¡æœ‰+å·)
        puppet cert list --all               åˆ—å‡ºæ‰€æœ‰çš„ç­¾å. åŒ…æ‹¬å·²ç­¾åçš„(å·²ç­¾åæœ€å‰é¢æœ‰ä¸ª+å·)
        puppet cert sign host2.example.com   ç»™æŸä¸ªå®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).
        puppet cert sign --all               ç»™æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å(æœåŠ¡å™¨ä¸Šæ“ä½œ).


        ss -tlunp | grep puppet           æŸ¥çœ‹puppetçš„ç«¯å£ é»˜è®¤8140
        ğŸ‘â€ğŸ—¨ å‡çº§ç‰ˆæœ¬. å…ˆå¸è½½(yum remove puppet-server) å†å®‰è£…



ğŸ”µ æœåŠ¡ç«¯å‘½ä»¤ 

    â¦¿ å¯åŠ¨    sudo systemctl start puppetserver && systemctl status puppetserver
    â¦¿ åœæ­¢    sudo systemctl stop puppetserver && systemctl status puppetserver



ğŸ”µ å®¢æˆ·ç«¯å‘½ä»¤

    â¦¿ è¿æ¥æµ‹è¯•    puppet agent --test

    â¦¿ å¯åŠ¨
        sudo /opt/puppetlabs/puppet/bin/puppet  resource service puppet ensure=running enable=true


    â¦¿ é…ç½®æ–‡ä»¶    vi /etc/puppetlabs/puppet/puppet.conf  

        â€¢ [master] æ¨¡å—
            è‡ªå¸¦æ¨¡å—. åº”ç”¨äºserverç«¯å’Œagentç«¯ï¼Œéƒ½ä¼šç”Ÿæ•ˆ

        â€¢ [agent] æ¨¡å—
            è¿™ä¸ªæ¨¡å—é»˜è®¤æ˜¯æ²¡æœ‰çš„,éœ€è¦æ–°å¢, è¯¥æ¨¡å—ä¸‹çš„è®¾ç½®ä¼šåœ¨agentç«¯ç”Ÿæ•ˆ
            server = gce.c.cloudpan-172312.internal



ğŸ”µ è¯ä¹¦é‡ç½®
    å®¢æˆ·ç«¯ è¿æ¥å¤±è´¥ ä¸€èˆ¬éœ€è¦åˆ é™¤å®¢æˆ·ç«¯çš„è¯ä¹¦.ç„¶åé‡æ–°ç”Ÿæˆ. ä¸‹é¢æ˜¯åŒæ–¹åˆ é™¤è¯ä¹¦æ­¥éª¤
    
    â€¢ å®¢æˆ·ç«¯: rm -rf /etc/puppetlabs/puppet/ssl     åˆ é™¤sslæ–‡ä»¶å¤¹æ‰€æœ‰å†…å®¹
        
    â€¢ æœåŠ¡å™¨: 
        puppet cert list                            æ˜¾ç¤ºæœªç­¾åè¯ä¹¦.
        puppet cert list --all                      æ˜¾ç¤ºæ‰€æœ‰è¯ä¹¦.
        puppet cert clean vps2.localdomain          åˆ é™¤å¯¹åº”è¯ä¹¦. 
        puppetserver reload ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸           åˆ é™¤/å¤±æ•ˆæŸè¯ä¹¦åå¿…é¡»é‡å¯æœåŠ¡å™¨

    â€¢ å®¢æˆ·ç«¯: puppet agent --test                   é‡æ–°ç”³è¯·è¯ä¹¦.
    
    â€¢ æœåŠ¡å™¨: puppet cert list                      åˆ—å‡ºå®¢æˆ·ç«¯çš„è¯·æ±‚
    â€¢ æœåŠ¡å™¨: puppet cert sign â€“all                 å¯¹æ‰€æœ‰å®¢æˆ·ç«¯è¿›è¡Œç­¾å.
    â€¢ æœåŠ¡å™¨: puppet cert sign mail.0214.help       å¯¹mail.0214.help è¿™å®¢æˆ·ç«¯è¿›è¡Œç­¾å.

    â€¢ å®¢æˆ·ç«¯: puppet agent --test                   é‡æ–°è¯·æ±‚è¿æ¥.



ğŸ”µ æµç¨‹

    GCE æœåŠ¡å™¨å®‰è£…æœåŠ¡ç«¯;  VPS1 æœåŠ¡å™¨å®‰è£…å®¢æˆ·ç«¯;

    å®¢æˆ·ç«¯ é…ç½® hosts æ–‡ä»¶  å’Œ é…ç½®æ–‡ä»¶.

    å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•.(ç”³è¯·è¯ä¹¦) âœ æœåŠ¡å™¨åŒæ„è¯ä¹¦ âœ å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•.(è¿æ¥æˆåŠŸ)

    æœåŠ¡å™¨ä¸‹è½½æ¨¡å— âœ  æœåŠ¡å™¨å®‰è£…æ¨¡å— âœ æœåŠ¡å™¨è‡ªå®šä¹‰ä¿®æ”¹æ¨¡å—



ğŸ”µ Misc 
  
    â¦¿ æ˜¾ç¤ºé…ç½®  puppet config print
    â¦¿ ä¿®æ”¹é…ç½®  puppet config set key=value
         æ­¤äº›å€¼çš„ä¿®æ”¹æ˜¯å¯¹/etc/puppet/puppet.confæ–‡ä»¶ç”Ÿæ•ˆ

    æœåŠ¡å™¨é…ç½®æ¨¡å—:  æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ï¼ŒåŒ…å«æ¸…å•å’Œæ¸…å•æ‰€ä¾èµ–çš„æ–‡ä»¶
    æœåŠ¡å™¨é…ç½®æ¸…å•:  é’ˆå¯¹ä¸€å°å®¢æˆ·ç«¯ï¼Œå®ƒæ‰€éœ€è¦çš„æ‰€æœ‰æ¨¡å—












â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ å‚¨å¤‡çŸ¥è¯† ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”µ puppet åˆè¡·

    puppet æ˜¯è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·, ç®¡ç†å¤§é‡æœåŠ¡å™¨; google éƒ½ç”¨ puppet.

    puppet çš„åˆ›å§‹è€…æ˜¯ä¸ª mac ç³»ç»Ÿç®¡ç†å‘˜. ç”¨ applescript ç®¡ç† MacOS.
    è¿ç»´æ˜¯ä¸€ç³»åˆ—é‡å¤çš„æœºæ¢°åŠ³åŠ¨.  æ¯”å¦‚è£…ç³»ç»Ÿ.çº¯å‡€ç‰ˆæœ¬çš„win7 è‡³å°‘2å°æ—¶.  ghostçš„è¯å¿«å¾ˆå¤š...
    è‹¦é€¼çš„ç³»ç»Ÿç®¡ç†å‘˜ä»¬éœ€è¦æœ‰ä¸€ä¸ªå´­æ–°çš„å·¥å…·æ¥ä½¿å¾—ä»–ä»¬çš„å·¥ä½œæ›´é«˜æ•ˆï¼Œæ›´ä¾¿æ·ã€‚
    puppet è¿™ä¸ªå·¥å…·æ˜¯ä¸ºç³»ç»Ÿç®¡ç†å‘˜è€Œè®¾è®¡çš„.
    puppet å­¦ä¹ æˆæœ¬ä½ï¼Œå¼€å‘é«˜æ•ˆï¼Œè·¨å¹³å°ï¼Œä»£ç å¯å¤ç”¨ï¼Œå®‰å…¨ï¼Œå¯æ‰©å±•æ€§é«˜ç­‰ç­‰ã€‚
    puppet æ˜¯åŸºäºruby å¼€å‘çš„. ä¸ä¼šruby ç…§æ ·å¯ä»¥å­¦å¥½ puppet.
    ä¸æ˜¯ä¸ºäº†æ‰¾å·¥ä½œè€Œå­¦ä¹ puppet, è€Œæ˜¯puppet å¯ä»¥å¸®ä½ å¹²ä»€ä¹ˆ!


ğŸ”µ Puppet ä½œç”¨

    é›†ç¾¤çš„ç¯å¢ƒç®¡ç†æ˜¯ä¸ªæœ€å¤§çš„é—®é¢˜. 

    æœºå™¨åˆ†ä¸º ç‰©ç†æœº å’Œ è™šæ‹Ÿæœº.
        â€¢ å¯¹äºå¤§éƒ¨åˆ†ç±» Web ç¨‹åºæˆ‘ä»¬ä½¿ç”¨è™šæ‹Ÿæœº
        â€¢ å¯¹äº Hadoopã€Mysql ç­‰èµ„æºæ¶ˆè€—å‹ç¨‹åºæˆ‘ä»¬ä½¿ç”¨ç‰©ç†æœº

    ä¸ç®¡æ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯å®ä½“æœº.æ–°æœºå™¨éƒ½å¿…é¡»éƒ¨ç½²åŸºç¡€ç¯å¢ƒåæ‰èƒ½å‘å¸ƒåº”ç”¨ç¨‹åº.


    Puppet èƒ½ç®¡ç†å¤šè¾¾å°†40å¤šç§èµ„æºç®¡ç†ï¼Œ
        ä¾‹å¦‚ï¼šfileã€userã€group ã€hostã€packageã€serviceã€cronã€execã€yumrepoç­‰ï¼Œ

    â¦¿ ç®¡ç†ä¸€å°ä¸»æœºæˆ–è€…è™šæ‹Ÿæœºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ:
        åˆå§‹å®‰è£…
        è½¯ä»¶å‡çº§
        SSH é…ç½®
        ç³»ç»Ÿç»´æŠ¤
        é…ç½®æ›´æ–°
        ç³»ç»Ÿä¸‹çº¿
        æ­å»ºæœåŠ¡
        æ–‡ä»¶ä¸‹è½½
        å®šæ—¶ä»»åŠ¡

        æœåŠ¡å™¨è¿ç§»                
        åˆ›å»ºç”¨æˆ·/ç¾¤ç»„.
        Apacheè™šæ‹Ÿä¸»æœºåˆ›å»º



ğŸ”¸ é…ç½®ç®€ä»‹ 
    puppetçš„ç»„æˆæ¸…å•è¿™ä¸»è¦åŒ…å«è¿™å‡ ä¸ªéƒ¨åˆ†

    èµ„æºï¼Œæ–‡ä»¶ï¼Œæ¨¡æ¿ï¼ŒèŠ‚ç‚¹ï¼Œç±»ï¼Œå®šä¹‰

    puppetä¸­æœ‰ä¸ªæ¨¡å—çš„å®šä¹‰ï¼Œè¿™ä¸ªæ¯”è¾ƒé‡è¦ï¼ŒåŸºæœ¬æ˜¯puppetçš„æ ¸å¿ƒï¼Œè¿™ä¸ªæ¨¡å—ä¸»è¦æ˜¯ç”±èµ„æºï¼Œæ–‡ä»¶ï¼Œæ¨¡æ¿ï¼Œç±»ï¼Œå®šä¹‰æ¥ç»„æˆçš„ã€‚

    puppetçš„æ¸…å•æ–‡ä»¶æ˜¯ä»¥.ppæ¥ç»“å°¾çš„ï¼Œåœ¨è½½å…¥æ–‡ä»¶çš„æ—¶å€™å°±ä¸éœ€è¦å†™.ppçš„æ‰©å±•åäº†ã€‚



ğŸ”¸ åŸºç¡€ 
    site.pp æ˜¯ puppet çš„åŸºç¡€. 
    å®¢æˆ·ç«¯è¿åˆ°æœåŠ¡å™¨åé¦–å…ˆæŸ¥çœ‹çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶. ç„¶åæ›´å…·è¯¥æ–‡ä»¶çš„é…ç½®.æ‰§è¡Œå¯¹åº”æ“ä½œ.




ğŸ”¸ å¸¸ç”¨å‚æ•°

    â¦¿ ensure => {present|installed|absent|latest|purged|"version"}, æŒ‡å®šæ–‡ä»¶çš„ç›®æ ‡çŠ¶æ€
            => present|installed, æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºä¹‹
            => absent, æ— å…¶ä»–è½¯ä»¶ä¾èµ–ï¼Œå¯åˆ é™¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
            => latest, æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œå¦åˆ™å‡çº§ä¸ºæœ€æ–°ç‰ˆæœ¬
            => purged, åˆ é™¤è¯¥åŒ…åŒ…æ‹¬æ‰€æœ‰ä¾èµ–çš„åŒ…,æœ‰é£é™©æ…ç”¨
            => "2.7.21-1", æŒ‡å®šæŸä¸€ä¸ªç‰ˆæœ¬å¤„äºå®‰è£…çŠ¶æ€

    â¦¿ name => package name, åŒ…çš„åå­—ï¼Œé»˜è®¤ä¸titleç›¸åŒå¯ä¸å†™

    â¦¿ provider => rpm, è¦æ±‚é€šè¿‡rpmå‘½ä»¤å®‰è£…åŒ…ï¼Œéœ€è¦é€šè¿‡sourceæŒ‡å®šå®‰è£…é‚£äº›åŒ…






ğŸ”¸ å¸¸è§èµ„æºç±»å‹ type
    â€¢ group   âœ ç”¨æˆ·ç»„ç›¸å…³è®¾ç½®
    â€¢ user    âœ ç”¨æˆ·ç›¸å…³è®¾ç½®
    â€¢ file    âœ æ–‡ä»¶/æ–‡ä»¶å¤¹/è¿æ¥ 
    â€¢ exec    âœ æ‰§è¡Œæ–‡ä»¶ 
    â€¢ motify  âœ é€šçŸ¥,å®¢æˆ·ç«¯æç¤º,æ˜¯å¦æˆåŠŸ
    â€¢ cron    âœ è®¡åˆ’ä»»åŠ¡
    â€¢ package âœ è½¯ä»¶åŒ…çš„å®‰è£…ã€å¸è½½ã€å‡çº§ç­‰
    â€¢ service âœ å®ç°æœåŠ¡ç®¡ç†


    â¦¿ exec å¯æ‰§è¡Œæ–‡ä»¶
        æœ‰onlyifã€unlessã€createsç­‰å±æ€§ä»¥å®ç°å‘½ä»¤çš„æ¡ä»¶å¼è¿è¡Œ
        æœ‰refreshonlyå±æ€§ï¼Œä»¥å®ç°åªæœ‰è®¢é˜…çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶æ‰æ‰§è¡Œ


    â¦¿ package è½¯ä»¶åŒ…
        é»˜è®¤ä½¿ç”¨ yum.
        ensure
            present         åªè¦å­˜åœ¨å³å¯ï¼Œæˆ–installedã€‚
            installed       å¿…é¡»å®‰è£…å¥½äº†ã€‚
            absent          åˆ é™¤ï¼ˆæ— ä¾èµ–ï¼‰ï¼Œå½“åˆ«çš„è½¯ä»¶åŒ…ä¾èµ–æ—¶ï¼Œä¸å¯åˆ é™¤ã€‚
            pureged         åˆ é™¤æ‰€æœ‰é…ç½®æ–‡ä»¶å’Œä¾èµ–åŒ…ï¼Œæœ‰æ½œåœ¨é£é™©ï¼Œæ…ç”¨ã€‚
            latest          å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚
            version         æŒ‡å®šå®‰è£…å…·ä½“çš„æŸä¸ªç‰ˆæœ¬å·ï¼ˆyum listï¼‰ï¼Œæ ¼å¼ï¼šensure => "ç‰ˆæœ¬å·",

        discription : æè¿°ä¿¡æ¯
        configfiles : é…ç½®æ–‡ä»¶
        keep
        replace
        install_options : å®‰è£…é€‰é¡¹
        name : ç¨‹åºåŒ…åç§°
        status : çŠ¶æ€
        source : ç¨‹åºåŒ…çš„æ¥æºï¼Œå¯ä»¥æœ¬åœ°æ–‡ä»¶è·¯å¾„æˆ–URL
        provider : ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å®‰è£…ï¼Œå¦‚å®‰è£…rpmå‘½ä»¤æ¥å®‰è£…


    â¦¿ ç‰¹æ®Šå±æ€§

        â€¢ å®šä¹‰ä¾èµ–å…³ç³»
            è¢«ä¾èµ–çš„èµ„æºä¸­ä½¿ç”¨before
            ä¾èµ–å…¶å®ƒçš„èµ„æºä¸­ä½¿ç”¨require

        â€¢ å®šä¹‰é€šçŸ¥å…³ç³»

        â€¢ èµ„æºå¼•ç”¨
            Type["title"] : typeé¦–å­—æ¯ä¸€å®šè¦å¤§å†™ï¼Œå¦‚User["zhenping"]




ğŸ”¸ å®šä¹‰èµ„æºè¯­æ³•

    type {"title":
        attribute => value,
        attribute => value,
    }

    æ³¨æ„ï¼štypeå¿…é¡»å°å†™ï¼Œ tileåœ¨åŒä¸€ç±»å‹ä¸‹å¿…é¡»å”¯ä¸€



ğŸ”¸ å®šä¹‰èµ„æºå‚è€ƒ

    user {'docker':
            ensure => present,
            uid => 5000,
            system => false,
            groups => hadoop,
            home => "/home/docker",
            password => "zhenping.com",
            salt => 3kkxxkjfk,
            shell => "/bin/bash",
            comment => "docker virtual teach",
    }




ğŸ”¸ puppet å˜é‡ / ä½œç”¨åŸŸ

    â¦¿ å˜é‡
        puppetå˜é‡åç§°å¿…é¡»ä»¥$å¼€å¤´ï¼Œèµ‹å€¼æ“ä½œç¬¦ä¸º"=",ä»»ä½•éæ­£åˆ™è¡¨è¾¾å¼ç±»å‹çš„æ•°æ®å‡å¯èµ‹å€¼å˜é‡ï¼Œ
        puppetçš„æ¯ä¸ªå˜é‡éƒ½æœ‰ä¸¤ä¸ªåå­—ï¼Œç®€çŸ­åç§°å’Œé•¿æ ¼å¼å®Œå…¨é™å®šåç§°

    â¦¿ ä½œç”¨åŸŸ
        å®šä¹‰ä»£ç çš„ç”Ÿæ•ˆèŒƒå›´ï¼Œä»¥å®ç°ä»£ç å•éš”ç¦»
        ä»…èƒ½éš”ç¦»: å˜é‡ï¼Œèµ„æºçš„é»˜è®¤å±æ€§
        ä¸èƒ½éš”ç¦»: èµ„æºçš„åç§°ï¼ŒåŠå¼•ç”¨

    â¦¿ æ¯ä¸ªå˜é‡ä¸¤ç§å¼•ç”¨è·¯å¾„
        ç›¸å¯¹è·¯å¾„ :$name
        ç»å¯¹è·¯å¾„ :$::scope::scope:variable

    â¦¿ ç¤ºä¾‹
        $webserver=nginx
        package {$webserver:
            ensure => latest,
        }




ğŸ”µ åŸºæœ¬æ¦‚å¿µ

    â¦¿ èµ„æºæŠ½è±¡å±‚(resource abstraction layre)

        ç›¸ä¼¼çš„èµ„æºè¢«æŠ½è±¡æˆåŒä¸€ç§èµ„æºâ€œç±»å‹â€ï¼Œå¦‚ç¨‹åºåŒ…èµ„æºã€ç”¨æˆ·èµ„æºåŠæœåŠ¡èµ„æºç­‰

        å°†èµ„æºå±æ€§æˆ–çŠ¶æ€çš„æè¿°ä¸å…¶å®ç°æ–¹å¼å‰¥ç¦»å¼€æ¥ï¼Œå¦‚ä»…è¯´æ˜å®‰è£…ä¸€ä¸ªç¨‹åºåŒ…è€Œä¸ç”¨å…³å¿ƒå…¶å…·ä½“æ˜¯é€šè¿‡yumã€pkgaddã€portsæˆ–æ˜¯å…¶å®ƒæ–¹å¼å®ç°

        ä»…æè¿°èµ„æºçš„ç›®æ ‡çŠ¶æ€ï¼Œä¹Ÿå³æœŸæœ›å…¶å®ç°çš„ç»“æœï¼Œè€Œä¸æ˜¯å…¶å…·ä½“è¿‡ç¨‹ï¼Œå¦‚â€œç¡®å®šnginxè¿è¡Œèµ·æ¥â€è€Œä¸æ˜¯å…·ä½“æè¿°ä¸ºâ€œè¿è¡Œnginxå‘½ä»¤å°†å…¶å¯åŠ¨èµ·æ¥






ğŸ”µ puppetèµ„æºç±»å‹

    ğŸ”¸ groupèµ„æºç±»å‹

        allowdupe : æ˜¯å¦å…è®¸ä½¿ç”¨ç›¸åŒçš„GIDå·
        ensure
        present :   å»ºç«‹
        absent :    åˆ é™¤
        gid :       æŒ‡å®šGIDå·
        name :     ç»„åï¼Œnamevar,ä¸æ˜¾ç¤ºå®šä¹‰å°±ä½¿ç”¨title
        system : æ˜¯å¦ä¸ºç³»ç»Ÿç»„
        true
        false
        members : æˆå‘˜



    ğŸ”¸userèµ„æºç±»å‹

        comment : æè¿°ä¿¡æ¯
        ensure
        present
        absent
        expiry : è¿‡æœŸæ—¶é—´
        gid : åŸºæœ¬ç»„ID
        groups : é™„åŠ ç»„
        home : å®¶ç›®å½•
        keys : æŒ‡æ˜å¯†é’¥
        name : namevar,ä¸æ˜¾ç¤ºå®šä¹‰å°±ä½¿ç”¨title
        password : å¯†ç 
        salt : å¯†ç çš„salt
        shell : é»˜è®¤shell
        uid : UID
        system : æ˜¯å¦ä¸ºç³»ç»Ÿç”¨æˆ·
        true
        false


    ğŸ”¸ fileèµ„æºç±»å‹

        content : ç›´æ¥ç»™å‡ºæ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒæ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦
        source : ä»æŒ‡å®šä½ç½®ä¸‹è½½æ–‡ä»¶,å¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹æœåŠ¡ç«¯çš„è·¯å¾„
        ensure
        file : æ–‡ä»¶
        directory : ç›®å½•
        link :è¿æ¥æ–‡ä»¶
        present
        absent
        force : å¼ºè¡Œè¿è¡Œ
        true
        false
        group : å±ç»„
        owner : å±ä¸»
        mode : æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ugo=rwæˆ–å¯ä»¥ä½¿ç”¨0664
        replace :è¦†ç›–
        path : è·¯å¾„
        target : å½“ensureä¸ºlinkæ—¶ï¼Œtargetè¡¨ç¤ºpathæŒ‡å‘çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥æ–‡ä»¶ï¼Œå…¶ç›®æ ‡ä¸ºäº›targetå±æ€§æ‰€æŒ‡å‘çš„è·¯å¾„ï¼Œæ­¤æ—¶contentå’Œsourceå±æ€§è‡ªåŠ¨å¤±æ•ˆ




    ğŸ”¸ execèµ„æºç±»å‹

        ä½¿ç”¨ç‰¹æ€§

        å‘½ä»¤æœ¬èº«å…·æœ‰å¹‚ç­‰æ€§
        èµ„æºæœ‰onlyifã€unlessã€createsç­‰å±æ€§ä»¥å®ç°å‘½ä»¤çš„æ¡ä»¶å¼è¿è¡Œ
        èµ„æºæœ‰refreshonlyå±æ€§ï¼Œä»¥å®ç°åªæœ‰è®¢é˜…çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶æ‰æ‰§è¡Œ
        å¸¸ç”¨å±æ€§

        command     : å‘½ä»¤
        creates     : æ–‡ä»¶ä¸å­˜åœ¨å°±æ–°å»º.
        cwd         : å‘½ä»¤æ‰§è¡Œè·¯å¾„.
        environment : å‘½ä»¤è¿è¡Œçš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ªpath
        group       : ä»¥æŒ‡å®šçš„ç»„è¿è¡Œå‘½ä»¤
        user        : ä»¥æŒ‡å®šçš„ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤
        onlyif      : ä»…åœ¨æ­¤å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼ˆè¿”å›çŠ¶æ€ç ä¸º0ï¼‰æ—¶ï¼Œæ‰è¿è¡ŒcommandæŒ‡å®šçš„å‘½ä»¤
        unless      : ä»…åœ¨æ­¤å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼ˆè¿”å›çŠ¶æ€ç é0ï¼‰æ—¶ï¼Œæ‰è¿è¡ŒcommandæŒ‡å®šçš„å‘½ä»¤
        refresh     : é»˜è®¤æ˜¯æ‰§è¡Œcommandä¸­å®šä¹‰çš„å‘½ä»¤ï¼Œå½“æ¥å—åˆ°å…¶å®ƒèµ„æºå‘æ¥çš„Notifyæ—¶ï¼Œå³ä¼šæ‰§è¡Œrefreshåé¢æŒ‡å®šçš„å‘½ä»¤
        refreshonly : ä»…åœ¨è®¢é˜…çš„èµ„æºè¿è¡ŒæˆåŠŸåï¼Œæ‰è¿è¡Œæ­¤èµ„æº
        returns     : æœŸæœ›çš„çŠ¶æ€è¿”å›å€¼ï¼Œè¿”å›éæ­¤å€¼æ—¶è¡¨ç¤ºå‘½ä»¤æ‰§è¡Œå¤±è´¥
        timeout     : å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ—¶é•¿
        tries       : å°è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1æ¬¡
        path        : å‘½ä»¤è·¯å¾„ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼pathç¯å¢ƒå˜é‡.




    ğŸ”¸ notifyèµ„æºç±»å‹
        æ˜¾ç¤ºé€šçŸ¥ä¿¡æ¯




    ğŸ”¸ cron èµ„æºç±»å‹ 
        ç®¡ç†è®¡åˆ’ä»»åŠ¡

        command     : è¦è¿è¡Œçš„job
        ensure
        present
        absent
        user        : è¿è¡Œä»»åŠ¡çš„ç”¨æˆ·
        name        : ä»»åŠ¡è®¡åˆ’çš„åç§°
        target
        hour        : å°æ—¶
        minute      : åˆ†é’Ÿ
        month       : æœˆ
        monthday    : æ¯æœˆçš„ç¬¬å‡ å¤©
        weekday     : æ¯å‘¨å‡ 
        environment : è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡



    ğŸ”¸ packageèµ„æºç±»å‹
        ç®¡ç†ç¨‹åºåŒ…çš„å®‰è£…ã€å¸è½½ã€å‡çº§ç­‰

        ensure
        installed
        present
        absent
        purged
        held
        discription     : æè¿°ä¿¡æ¯
        configfiles     : é…ç½®æ–‡ä»¶
        keep
        replace
        install_options : å®‰è£…é€‰é¡¹
        name            : ç¨‹åºåŒ…åç§°
        status          : çŠ¶æ€
        source          : ç¨‹åºåŒ…çš„æ¥æºï¼Œå¯ä»¥æœ¬åœ°æ–‡ä»¶è·¯å¾„æˆ–URL
        provider        : ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å®‰è£…ï¼Œå¦‚å®‰è£…rpmå‘½ä»¤æ¥å®‰è£…
        rpm




    ğŸ”¸ serviceèµ„æºç±»å‹

        binary     : äºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶è·¯å¾„
        enable     : æ˜¯å¦å¼€æœºè‡ªåŠ¨å¯åŠ¨
        true
        false
        manual
        ensure
        stopped
        running
        hasrestart : æœåŠ¡è„šæœ¬æ˜¯å¦æ”¯æŒrestartå‚æ•°
        true
        false
        hasstatus  : æœåŠ¡è„šæœ¬æ˜¯å¦æ”¯æŒstatuså‚æ•°
        true
        false
        name       : æœåŠ¡çš„åç§°ï¼Œnamevar
        path       : æœåŠ¡è„šæœ¬çš„æœç´¢è·¯å¾„
        pattern    : ç”¨äºæœç´¢æ­¤æœåŠ¡ç›¸å…³è¿›ç¨‹çš„æ¨¡å¼ï¼Œé€šè¿‡åŒ¹é…è¿›ç¨‹åç§°ç¡®å®šæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
        restart    : ç”¨äºæ‰§è¡Œé‡å¯çš„å‘½ä»¤
        start      : ç”¨äºæ‰§è¡Œå¼€å§‹çš„å‘½ä»¤
        status
        stop






    Puppet å¯ä»¥å•æœºä½¿ç”¨(æµ‹è¯•ç”¨). ä¸€èˆ¬éƒ½æ˜¯å¤šæœºå™¨ä½¿ç”¨

        ğŸ“Œ Puppet ä¸¤ç§æ‰§è¡Œæ¨¡å¼:
            ç›´æ¥è¯»å–puppet file.manifesté…ç½®
            é€šè¿‡puppetd --server puppetmaster.server.comï¼Œä»æœåŠ¡ç«¯ä¸‹è½½manifesté…ç½®


    æœåŠ¡å™¨åªæœ‰ä¸€å°. å®¢æˆ·ç«¯å¯ä»¥æœ‰åƒä¸‡å°. 
    æ‰€æœ‰å®¢æˆ·ç«¯ éƒ½å…ˆæŸ¥çœ‹ site.pp è¿™ä¸ªæ€»çš„é…ç½®æ–‡ä»¶.
    è¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œ å¯ä»¥ç»™æ¯ä¸ªå®¢æˆ·ç«¯è¿›è¡Œä¸åŒçš„é…ç½®.


    ğŸ”¸ ä½œç”¨.
        å¯ä»¥åœ¨å®¢æˆ·ç«¯è¿è¡Œå‘½ä»¤ã€è¿è¡Œè„šæœ¬ ç­‰ç­‰æ“ä½œ.

    å¦‚ åˆ›å»ºä¸€ä¸ª xuç”¨æˆ·.
    user{'11':
        name => xu,
        ensure => present,
    }



    ğŸ”¸ èŠ‚ç‚¹
        åŸŸååªè¦ å®¢æˆ·ç«¯ping æœåŠ¡å™¨å. èƒ½æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ipå°±å¯ä»¥.
        

        vps2. 104.224.139.45

        gce.c.cloudpan-172312.internal

        vps2.localdomain
        vps2.localdomain



    ğŸ”¸ site.pp 
        å°±æ˜¯èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¯¹å„ä¸ªèŠ‚ç‚¹çš„é…ç½®æè¿°ã€‚
        åœ¨å®ä¾‹é…ç½®æ–‡ä»¶ä¸­ï¼Œâ€puppetagentâ€å°±æ˜¯èŠ‚ç‚¹çš„ä¸»æœºåã€‚
        åŒ…å«åœ¨ puppetagent ä¸­çš„é…ç½®æè¿°å°±æ˜¯è¯¥èŠ‚ç‚¹çš„èµ„æºé›†åˆçš„æè¿°ã€‚

    é»˜è®¤åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤.


    æŒ‡å®šèŠ‚ç‚¹è¿è¡Œç‰¹å®šå‘½ä»¤: 
    node 'mail.0214.help'{
      include  motd
    }


    node slave01 {
      file {
        "/tmp/testpuppet": #åœ¨slaveèŠ‚ç‚¹ä¸Šåˆ›å»ºè¯¥æ–‡ä»¶
        content=>"good morning!\n"; #æ–‡ä»¶ä¸­æ‰“å°å¦‚ä¸‹å†…å®¹
      }
    }





    ğŸ”¸ ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶. âœ”ï¸
        åœ¨å®¢æˆ·ç«¯æ–°å»ºä¸€ä¸ªæ–‡ä»¶.å¹¶å†™å…¥å†…å®¹.

        â€¢ æœåŠ¡å™¨
            vi /etc/puppetlabs/code/environments/production/manifests/site.pp
            
        file { 'helloworld':

            path => '/etc/helloworld.txt',
            owner  => 'root',
            group  => 'root',
            mode   => '655',
            content => "hello world from puppet!\n",
            }

        â€¢ å®¢æˆ·ç«¯
            âœ˜âœ˜âˆ™ğ’—2 ~ âœ puppet agent --test

            ç„¶åå°±å¤šäº†ä¸ªæ–‡ä»¶å‡ºæ¥äº†
            âœ˜âœ˜âˆ™ğ’—2 ~ âœ cat /etc/helloworld.txt
            hello world from puppet!







    ğŸ”¸ æ‰§è¡Œè„šæœ¬.
        ä½œä¸ºè¿›é˜¶çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹å¯ä»¥æ‰§è¡Œä¸€äº›æ›´åŠ å¤æ‚ä¸€ç‚¹çš„ä»»åŠ¡ã€‚
        æˆ‘ä»¬å¸Œæœ›èŠ‚ç‚¹å¯ä»¥ä» PuppetServer è·å–ä¸€ä¸ªå‘½ä»¤è„šæœ¬ï¼Œå¹¶ä¸”æ‰§è¡Œè¯¥è„šæœ¬ã€‚

        â€¢ åˆ›å»ºä¸€ä¸ªåå«â€testâ€çš„æ¨¡å—æ–‡ä»¶å¤¹
            mkdir /etc/puppetlabs/code/environments/production/modules/test

        â€¢ åœ¨ test æ¨¡å—ä¸‹é¢åˆ›å»ºä¸€ä¸ªâ€filesâ€æ–‡ä»¶å¤¹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶æ˜¯å¯ä»¥è¢«èŠ‚ç‚¹è·å–çš„ã€‚
            mkdir /etc/puppetlabs/code/environments/production/modules/test/files

        â€¢ åœ¨â€filesâ€æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸€ä¸ª shell è„šæœ¬ test.sh
            è¯¥è„šæœ¬ä¼šåœ¨/etc/ç›®å½•ä¸‹åˆ›å»º helloworld.log æ–‡ä»¶ï¼Œç„¶ååœ¨æ–‡ä»¶é‡Œæ·»åŠ â€hello worldâ€å†…å®¹ã€‚

            vi /etc/puppetlabs/code/environments/production/modules/test/files/test.sh
            è„šæœ¬å†…å®¹
        touch /etc/helloworld.log
        echo "helloworld" >> /etc/helloworld.log

        â€¢ ç¼–è¾‘ site.pp
            æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªèµ„æºï¼šä¸€ä¸ªæ–‡ä»¶èµ„æºå’Œä¸€ä¸ªæ‰§è¡Œå‘½ä»¤èµ„æºã€‚
            è¿™ä¸¤ä¸ªèµ„æºæœ‰ä¾èµ–å…³ç³»ï¼Œå‘½ä»¤æ‰§è¡Œèµ„æºä¾èµ–äºæ–‡ä»¶èµ„æºï¼Œæ‰€ä»¥ Puppet ä¼šä¼˜å…ˆå¤„ç†æ–‡ä»¶èµ„æºã€‚
            æ‰§è¡Œå‘½ä»¤èµ„æºä¼šåœ¨æ–‡ä»¶èµ„æºå­˜åœ¨åå†æ‰§è¡Œã€‚

            vi /etc/puppetlabs/code/environments/production/manifests/site.pp


        file { 'test.sh':
        path => '/etc/test.sh',
        owner  => 'root',
        group  => 'root',
        mode   => '655',
        source => 'puppet:///modules/test/test.sh',
        }
        exec { 'execute ':
        command => 'bash /etc/test.sh',
        require => File['test.sh'],
        path => ["/bin/"],
        }


        â€¢ å®¢æˆ·ç«¯
            puppet agent --test

                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for vps2.localdomain
                Info: Applying configuration version '1500166128'
                Notice: /Stage[main]/Main/File[test.sh]/ensure: defined content as '{md5}4a7fef6d906b79559966eef350f380a6'
                Notice: /Stage[main]/Main/Exec[execute ]/returns: executed successfully
                Notice: Applied catalog in 0.41 seconds

        â€¢ å®¢æˆ·ç«¯æ£€æµ‹
            cat /etc/helloworld.log
            å‡ºç° helloworld








â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ ä¸ªäººæ¨¡å— ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”µ ç®€å•æ¨¡å— âœ”ï¸

ğŸ”¸ æµç¨‹ 
    æœåŠ¡ç«¯: åˆ›å»ºæ¨¡å—æ–‡ä»¶å¤¹, å®Œå–„æ¨¡å—ç›®å½•.
    æœåŠ¡ç«¯: åˆ›å»º pp æ–‡ä»¶.  init.pp 
    æœåŠ¡ç«¯: ä¿®æ”¹ site.pp 

    å®¢æˆ·ç«¯: è¿æ¥æœåŠ¡
    å®¢æˆ·ç«¯: ç»“æœæµ‹è¯•.


ğŸ”¸ æ¨¡å—æ–‡ä»¶å¤¹
    â¦¿ åˆ›å»ºæ¨¡å—ç»“æ„ 
        cd /etc/puppetlabs/code/environments/production/modules

        mkdir -p /etc/puppetlabs/code/environments/production/modules/motd/files/etc
        mkdir -p /etc/puppetlabs/code/environments/production/modules/motd/manifests
        mkdir -p /etc/puppetlabs/code/environments/production/modules/motd/templates

        touch /etc/puppetlabs/code/environments/production/modules/motd/files/etc/motdFile
        touch /etc/puppetlabs/code/environments/production/modules/motd/manifests/init.pp

        tree /etc/puppetlabs/code/environments/production/modules/motd


    â¦¿ ç»“æ„å‚è€ƒ
        /etc/puppetlabs/code/environments/production/modules/motd
        â”œâ”€â”€ files            #å­˜æ”¾æ–‡ä»¶ç›®å½•
        â”‚   â””â”€â”€ etc
        â”‚       â””â”€â”€ motdFile
        â”œâ”€â”€ manifests        #å­˜æ”¾æ¨¡å—ppé…ç½®æ–‡ä»¶ç›®å½•
        â”‚   â””â”€â”€ init.pp
        â””â”€â”€ templates        #å­˜æ”¾æ¨¡æ¿ç›®å½•

        4 directories, 2 files


ğŸ”¸ ç¼–è¾‘ motdFile æ–‡ä»¶.
    è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶. ç›®çš„æ˜¯æŠŠè¿™ä¸ªæ–‡ä»¶ä»æœåŠ¡å™¨ä¸Šä¸‹å‘åˆ°å®¢æˆ·ç«¯.
    è¿™ä¸ªæ–‡ä»¶ä¸æ˜¯ç©ºçš„å°±è¡Œ. echo >> æ˜¯è¿½åŠ åˆ°æ–‡ä»¶å°¾éƒ¨.
    echo "-â˜…--puppet test--â˜…-" >> /etc/puppetlabs/code/environments/production/modules/motd/files/etc/motdFile

    cat /etc/puppetlabs/code/environments/production/modules/motd/files/etc/motdFile


ğŸ”¸ ç¼–è¾‘ site.pp
    vi /etc/puppetlabs/code/environments/production/manifests/site.pp

    $puppetserver = 'gce.c.cloudpan-172312.internal' #è®¾ç½®å…¨å±€å˜é‡,å¿…é¡». init.pp ä¼šç”¨åˆ°

    node 'mail.0214.help'{
    include  motd
    }


ğŸ”¸ ç¼–è¾‘ init.pp æ–‡ä»¶
    äº•å·åé¢æ˜¯æ³¨é‡Š. å¯ä»¥ä¿ç•™æ³¨é‡Š.
    vi /etc/puppetlabs/code/environments/production/modules/motd/manifests/init.pp

class motd{                          # å¿…é¡»è¦æœ‰ä¸€ä¸ª class 

    # ğŸ”¸ æ–°å»ºç¾¤ç»„ âœ”ï¸
    group {'puppetGroup':            # ç¾¤ç»„åå­—
        ensure => present,       # ç¡®ä¿ç¾¤ç»„å­˜åœ¨. present:å»ºç«‹; absent: åˆ é™¤;
        gid => 200,              # æŒ‡å®š gid 
        system => true,          # æ˜¯å¦ä¸ºç³»ç»Ÿç»„.  true/false

        # å®¢æˆ·ç«¯æµ‹è¯•: æŸ¥çœ‹ç¾¤ç»„  cat /etc/group
        }


    # ğŸ”¸ æ–°å»ºç”¨æˆ· âœ”ï¸
    user {'puppetUser':                  # è®¾ç½® ç”¨æˆ·å 
        ensure => present,           # ç¡®ä¿ç¾¤ç»„å­˜åœ¨. present:å»ºç«‹; absent: åˆ é™¤;
        uid => 5000,                 # è®¾ç½® uid 
        system => false,             # æ˜¯å¦ä¸ºç³»ç»Ÿç»„.  true/false
        groups => puppetGroup,       # è®¾ç½® ç¾¤ç»„
        home => "/home",             # è®¾ç½® å®¶ç›®å½• 
        password => "puppetpasswd",  # è®¾ç½® å¯†ç 
        shell => "/bin/bash",        # è®¾ç½® ç™»å½•shell
        comment => "test user",      # ç”¨æˆ·æ³¨é‡Š

        # å®¢æˆ·ç«¯æµ‹è¯•: æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨    finger puppetUser 
        }


    # ğŸ”¸ åˆ›å»ºæ–‡ä»¶ç¤ºä¾‹ âœ”ï¸
    file {"/tmp/test4.txt": ensure => present, }
        # å®¢æˆ·ç«¯æµ‹è¯•: cat /tmp/test4.txt


    # ğŸ”¸ åˆ›å»ºç›®å½•ç¤ºä¾‹ âœ”ï¸
    file {"/tmp/test": ensure => directory, }
        # å®¢æˆ·ç«¯æµ‹è¯•: cd /tmp/test


    # ğŸ”¸ åˆ é™¤æ–‡ä»¶å¤¹ âœ”ï¸
    file { "/tmp/testFolder": ensure => absent, force   => true, }
        # å®¢æˆ·ç«¯æµ‹è¯•: å…ˆå»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ âœ åŒæ­¥ puppet âœ  ç„¶åçœ‹çœ‹æœ‰æ²¡æœ‰è¢«åˆ é™¤. 


    # ğŸ”¸ å‘æ–‡ä»¶ä¸­æ·»åŠ æ–‡æœ¬å†…å®¹ 1 âœ”ï¸
    file {"/tmp/puppet.txt":
            ensure => file,
            content => "This is a puppet write content .",
            mode => '700',       # å¿…é¡»åŠ å¼•å·. è¯¥å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹.ä¸æ˜¯æ•´æ•°.
            replace => true,
            
            # å®¢æˆ·ç«¯æµ‹è¯•:     cat /tmp/puppet.txt
            }


    # ğŸ”¸ å‘æ–‡ä»¶ä¸­æ·»åŠ æ–‡æœ¬å†…å®¹ 2 âœ”ï¸
    file { 'helloworld':                 # ç¬¬ä¸€ä¸ªæ–‡ä»¶. å®¢æˆ·ç«¯æ–°å»ºæ–‡ä»¶,å†…å®¹æ˜¯ content å€¼
        ensure  => present,              # æ–‡ä»¶å¿…é¡»å­˜åœ¨,å°±ç®—å®¢æˆ·ç«¯åˆ äº†ä¹Ÿä¼šæ–°å»º.
        path => '/etc/helloworld.txt',   # å®¢æˆ·ç«¯æ–‡ä»¶å­˜æ”¾ä½ç½®.
        owner  => 'root',                # æ–‡ä»¶ ç”¨æˆ·å±æ€§
        group  => 'root',                # æ–‡ä»¶ ç¾¤ç»„å±æ€§
        mode   => '655',                 # æ–‡ä»¶ æƒé™
        content => "hello puppet!\n",    # æ–‡ä»¶ å…·ä½“å†…å®¹

        # å®¢æˆ·ç«¯æµ‹è¯•: æŸ¥çœ‹æ–°å»ºæ–‡ä»¶çš„å†…å®¹    cat /etc/helloworld.txt
        }


    # ğŸ”¸ è¿œç¨‹æ–‡ä»¶å¤åˆ¶ç¤ºä¾‹ 1 âœ”ï¸
     file { 'syncfile':                  # ç¬¬äºŒä¸ªæ–‡ä»¶. åŒæ­¥æœåŠ¡å™¨çš„ motdFile åˆ°å®¢æˆ·ç«¯
        ensure  => present,              # æ–‡ä»¶å­˜åœ¨/æ–°å»º
            # file : æ–‡ä»¶ã€directory : ç›®å½•ã€link :è¿æ¥æ–‡ä»¶ã€presentã€absent
        path => '/etc/syncfile.txt',     # å®¢æˆ·ç«¯æ–‡ä»¶å­˜æ”¾ä½ç½®.
        owner  => 'root',
        group  => 'root',
        mode   => '655',
        source  => "puppet://$puppetserver/modules/motd/etc/motdFile", # æœåŠ¡å™¨æ–‡ä»¶è·¯å¾„

        # å®¢æˆ·ç«¯æµ‹è¯•: æŸ¥çœ‹åŒæ­¥æ–‡ä»¶çš„å†…å®¹    cat /etc/helloworld.txt           
        }    


    # ğŸ”¸ yum å‡çº§ âœ”
    exec { "yum update": command => "yum update -y" }


    # ğŸ”¸ yum å®‰è£…è½¯ä»¶: âœ”ï¸
    # å…ˆç”¨ yum list installed åˆ¤æ–­æ˜¯å¦å®‰è£…äº† nload; éœ€è¦åœ¨ path æŒ‡å®š yum æ‰§è¡Œè·¯å¾„.
    # æ²¡å®‰è£…å°±æ‰§è¡Œ command å‘½ä»¤.
    exec { "install nload":
        command => "yum install nload -y",                   # è¿è¡Œå‘½ä»¤.
        cwd => "/root"                                       # è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œcommandå‘½ä»¤
        user => root,                                        # å‘½ä»¤æ‰§è¡Œç”¨æˆ·
        group => root,                                       # å‘½ä»¤æ‰§è¡Œç¾¤ç»„
        path => ["/usr/local/bin","/usr/sbin","/usr/bin"],   # å‘½ä»¤ç¯å¢ƒè·¯å¾„,ä¸ç„¶å‘½ä»¤å¿…é¡»ç”¨ç»å¯¹è·¯å¾„
        unless => "yum list installed | grep nload",         # unless æ‰§è¡Œå¤±è´¥æ‰æ‰§è¡Œcommad
            # onlyif æ˜¯å‘½ä»¤æ‰§è¡ŒæˆåŠŸ. æ‰æ‰§è¡Œ command æŒ‡å®šçš„å‘½ä»¤.
    }

    # ç”Ÿæˆæ—¶é—´æˆ³æ–‡ä»¶: âœ”ï¸
    exec {
        "generate timestamp file":
        command => "date +%s > timestamp.file",
        path    => "/usr/bin:/usr/sbin:/bin",
        onlyif  => "test -f timestamp.file",                 # æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨.
        cwd     => "/tmp";
    }






    # ğŸ”¸ é€šçŸ¥ âœ”ï¸
    # ä¼šåœ¨ å®¢æˆ·ç«¯åŒæ­¥çš„æ—¶å€™ æ˜¾ç¤º.. å¥½åƒæ²¡å•¥ç”¨å•Š.  æ’é”™ç”¨ä¹ˆ
    nofify {"hello world":}
    notify {'warning':  message=> "From warning notify resource." }


    # ğŸ”¸ è®¡åˆ’ä»»åŠ¡ âœ”ï¸
    # ntpdate å’Œ ntpd éƒ½æ˜¯æ—¶é—´åŒæ­¥. å‰è€…æ˜¯ç«‹å³åŒæ­¥. åè€…æ˜¯é¡ºæ»‘åŒæ­¥.
    # ç«‹å³åŒæ­¥ ä¼šé€ æˆæ—¶é—´å˜åŒ–è¿‡å¿«. å¯¹æŸäº›ä¾èµ–æ—¶é—´çš„è½¯ä»¶æ˜¯è‡´å‘½çš„.
    # å¾ˆå¤šå…è´¹çš„NTP server . http://ntp.org.cn/çœ‹.
    # âœ˜âœ˜âˆ™ğ’—1 /tmp âœ ntpdate cn.ntp.org.cn
    # VPS å¥½å¤šä¸»æœºå…±äº«çš„. æ‰€ä»¥ä¸èƒ½æ”¹æ—¶é—´. ä¼šæ‰§è¡Œå¤±è´¥.æ²¡åŠæ³•çš„. 
    cron {"sync time":
        command => "/usr/sbin/ntpdate cn.ntp.org.cn &> /dev/null",
        hour => "18",
        minute => "28",
        user => root,   # æ¥æ”¶æ­¤ä»»åŠ¡çš„ç”¨æˆ·.
        # å®¢æˆ·ç«¯æµ‹è¯•: æŸ¥çœ‹å½“å‰è®¡åˆ’ä»»åŠ¡:  crontab -l
    }

    # ä¸‹é¢ cron æœªæµ‹è¯•.
    cron {
        "check raid":
        command => "/usr/local/scripts/check_raid.sh",
        user    => root,
        hour    => '*',
        minute  => '*/5',
        ensure  => present;

        "add puppet cron":
        command => "/usr/bin/puppet agent --server puppet.server.com",
        user    => root,
        minute  => [0,30];
    }








    # ğŸ”µ package è½¯ä»¶åŒ…: å®‰è£…ã€å¸è½½ã€æ›´æ–°; é»˜è®¤ä½¿ç”¨ yum.
    # ğŸ”¸ å¸è½½è½¯ä»¶ âœ”ï¸
    # è¢«å¸è½½çš„è½¯ä»¶ ä¸èƒ½æ˜¯åˆ«çš„è½¯ä»¶çš„ä¾èµ–ç»„ä»¶. å¦‚ postfix å°±ä¸èƒ½ç›´æ¥å¸è½½.å› ä¸º sendmail è¦ç”¨åˆ°.
    package { "htop": ensure =>   absent; }

    # ğŸ”¸ è½¯ä»¶å®‰è£… âœ”ï¸
    package { "nmap": ensure =>   present; }
    package { "httpd": name    => "httpd.x86_64", ensure  => installed; }
    package { "epel-release": ensure =>   present; }
    # epel-release æ˜¯ç¬¬ä¸‰æ–¹æº. è§£å†³yum é»˜è®¤è½¯ä»¶ç‰ˆæœ¬è¿‡ä½é—®é¢˜.!!!


    # ğŸ”¸ å®‰è£…æŒ‡å®šç‰ˆæœ¬ âœ”ï¸
    # ç”¨ yum æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬éœ€è¦é¢å¤–å‚æ•° --showduplicates
    # yum list zsh                   âœ æ˜¾ç¤ºæœ€æ–°ç‰ˆæœ¬ 5.0.2-25.el7_3.1
    # yum --showduplicates list zsh  âœ æ˜¾ç¤ºæ‰€æœ‰ç‰ˆæœ¬ 5.0.2-25.el7 + 5.0.2-25.el7_3.1
    package { "zsh": ensure   => "5.0.2-25.el7"; }

    # ğŸ”¸ è½¯ä»¶æ›´æ–° âœ”ï¸
    # package { "postfix": ensure   => latest; }
    

    # ğŸ”¸ rpm å®‰è£… æœªæµ‹è¯•.
    package {"jdk":
        ensure => installed,
        provider => rpm,                                    # rpm å®‰è£…. éœ€ source æŒ‡å®šrpmè·¯å¾„ 
        source => â€˜/usr/local/src/jdk-8u25-linux-x64.rpmâ€™,  # rpm åŒ…è·¯å¾„
        }



    # ğŸ”µ serviceèµ„æºç±»å‹
    # ğŸ”¸ nginx æŒç»­è¿è¡Œ âœ”ï¸
    service {"nginx":
        ensure => running,                             # ä¿è¯æœåŠ¡å¤„äºè¿è¡ŒçŠ¶æ€
        enable => true,                                # å®šä¹‰æ˜¯å¦å¼€æœºè‡ªå¯
        hasrestart => true,                            #
        hasstatus => true,                             #
        path => "/usr/sbin/nginx",                     # æœåŠ¡è·¯å¾„
        restart => "systemctl restart nginx.service",  # å®šä¹‰restartçš„æ–¹å¼

        # å®¢æˆ·ç«¯æµ‹è¯• æŸ¥çœ‹å½“å‰çŠ¶æ€. âœ  service nginx status
        # å®¢æˆ·ç«¯æµ‹è¯• åœæ­¢nginx     âœ  service nginx stop   æˆ–   service nginx force-quit
    }



    # ğŸ”µ ç‰¹æ®Šå±æ€§.
    # ğŸ”¸ ä¾èµ–å…³ç³» 1  ï¸ âœ”
    # puppet çš„æ‰§è¡Œä¸ä¸€å®šæ˜¯ä»ä¸Šåˆ°ä¸‹çš„. æ‰€ä»¥æœ‰ä¾èµ–çš„éœ€è¦å®šä¹‰ ä¾èµ–å…³ç³». require  / before
    # æ¯”å¦‚ åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„.  è¦æ–°å»ºç”¨æˆ·ç»„. ç„¶åç”¨æˆ·çš„ç”¨æˆ·ç»„å±æ€§æ‰èƒ½ç”¨åˆšæ–°å»ºå‡ºæ¥çš„ç»„.
    group {"linux":
        gid => 2001,
        ensure => present,
        before => User["linux"],
    }

    user {"linux":
        ensure => present,
        uid => 2001,
        gid => 2001,
        shell => "/bin/bash",
        home => "/home/linux",
        system => false,
        password => "0214.helpâ€,
        require => Group["linux"],
    }


    # ğŸ”¸ ä¾èµ–å…³ç³» 2 âœ”ï¸
    # å…ˆå®‰è£… nginx âœ ç„¶åé…ç½® nginx âœ æœ€åå¯åŠ¨ nginx
    package {"nginx":
        ensure => latest,
        allow_virtual => false,
        before => File["/etc/nginx/nginx.conf"],
    }

    file {"/etc/nginx/nginx.conf":
        source => "/tmp/nginx.conf",
        owner => nginx,
        group => nginx,
        require => Package["nginx"],
        notify => Service["nginx"],
        ensure => file,
    }
    service {"nginx":
        ensure => running,
        enable => true,
        hasrestart => true,
        hasstatus => true,
        restart => "systemctl reload nginx",
        path => "/usr/lib/systemd/system",
        require => [Package["nginx"],File["/etc/nginx/nginx.conf"]],
        subscribe => File["/etc/nginx/nginx.conf"],
    }


}










â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ ç°æˆæ¨¡å— ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”µ ç°æˆæ¨¡å—

ğŸ”¸ ç®€ä»‹

    puppet æ˜¯é€šè¿‡æ¨¡å— ç®¡ç†æœåŠ¡å™¨çš„,æœ‰ç°æˆçš„æ¨¡å—.
    https://forge.puppet.com/    ä¸€ä¸ªå…è´¹çš„æ¨¡å—åº“,åŸºæœ¬è¦†ç›–æ‰€æœ‰æ“ä½œç³»ç»Ÿä»¥åŠå¸¸ç”¨è½¯ä»¶ã€‚


ğŸ”¸ æ¨¡å—æœç´¢: 

    â€¢ è¿›å…¥ç½‘ç«™ âœ æœç´¢ nginx âœ é€‰æ‹©ç¬¬ä¸€ä¸ªæ¨¡å— puppet/nginx https://forge.puppet.com/puppet/nginx
    â€¢ ç»ˆç«¯ç›´æ¥æœç´¢: puppet module search nginx   âœ ä¹Ÿä¼šå‡ºæ¥ç»“æ„.


ğŸ”¸ æ¨¡å—å®‰è£…:

    å®˜ç½‘æ¨¡å—å®‰è£…æ–‡æ¡£: https://docs.puppet.com/puppet/4.10/modules_installing.html
    ä¸åŒç‰ˆæœ¬,å®‰è£…æ–¹æ³•æœ‰åŒºåˆ«.è¿™é‡Œç”¨ 4.10 ä¸ºå‡†

    è‡ªåŠ¨å®‰è£…: mod 'puppet-nginx', '0.7.0' æ·»åŠ åˆ° Puppetfile
    æ‰‹åŠ¨å®‰è£…âœ”ï¸: puppet module install puppet-nginx --version 0.7.0

        âœ˜âœ˜âˆ™GCE puppetlabs âœ puppet module install puppet-nginx --version 0.7.0
        Notice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...
        Notice: Downloading from https://forgeapi.puppet.com ...
        Notice: Installing -- do not interrupt ...
        /etc/puppetlabs/code/environments/production/modules
        â””â”€â”¬ puppet-nginx (v0.7.0)
        â”œâ”€â”€ puppetlabs-apt (v2.4.0)
        â”œâ”€â”€ puppetlabs-concat (v3.0.0)
        â””â”€â”€ puppetlabs-stdlib (v4.18.0)


ğŸ”¸ æ¨¡å—ç»“æ„ 

    âœ˜âœ˜âˆ™GCE nginx âœ ls
    total 156
    -rw-r--r-- 1 root root 114005 Aug  1 19:24 CHANGELOG.md
    -rw-r--r-- 1 root root   8029 Aug  1 19:25 checksums.json
    -rw-r--r-- 1 root root    304 Aug  1 19:24 composer.json
    drwxr-xr-x 2 root root    123 Aug  1 19:25 examples
    -rw-r--r-- 1 root root   3745 Aug  1 19:24 Gemfile
    drwxr-xr-x 3 root root     19 Aug  1 19:25 lib
    -rw-r--r-- 1 root root   1079 Aug  1 19:24 LICENSE.md
    drwxr-xr-x 4 root root    115 Aug  1 19:25 manifests  âœ é‡Œé¢çš„ init.pp æ˜¯é‡ç‚¹
    -rw-r--r-- 1 root root   1511 Aug  1 19:25 metadata.json
    -rw-r--r-- 1 root root   1577 Aug  1 19:24 Rakefile
    -rw-r--r-- 1 root root  10304 Aug  1 19:24 README.md
    drwxr-xr-x 6 root root   4096 Aug  1 19:25 spec
    drwxr-xr-x 7 root root     79 Aug  1 19:25 templates  
    drwxr-xr-x 2 root root     32 Aug  1 19:25 types



    tree -d åªæ˜¾ç¤ºç›®å½•.
 
    tree /etc/puppetlabs/code/environments/production/modules/nginx -d
        /etc/puppetlabs/code/environments/production/modules/nginx
        â”œâ”€â”€ examples
        â”œâ”€â”€ lib
        â”‚Â Â  â””â”€â”€ facter
        â”œâ”€â”€ manifests
        â”‚Â Â  â”œâ”€â”€ package
        â”‚Â Â  â””â”€â”€ resource
        â”‚Â Â      â””â”€â”€ upstream
        â”œâ”€â”€ spec
        â”‚Â Â  â”œâ”€â”€ acceptance
        â”‚Â Â  â”‚Â Â  â””â”€â”€ nodesets
        â”‚Â Â  â”‚Â Â      â”œâ”€â”€ docker
        â”‚Â Â  â”‚Â Â      â””â”€â”€ ec2
        â”‚Â Â  â”œâ”€â”€ classes
        â”‚Â Â  â”œâ”€â”€ defines
        â”‚Â Â  â””â”€â”€ unit
        â”‚Â Â      â””â”€â”€ facter
        â”‚Â Â          â””â”€â”€ util
        â”œâ”€â”€ templates
        â”‚Â Â  â”œâ”€â”€ conf.d
        â”‚Â Â  â”œâ”€â”€ mailhost
        â”‚Â Â  â”œâ”€â”€ server
        â”‚Â Â  â”‚Â Â  â””â”€â”€ locations
        â”‚Â Â  â”œâ”€â”€ streamhost
        â”‚Â Â  â””â”€â”€ upstream
        â””â”€â”€ types



ğŸ”¸ æ¨¡å—å‘½ä»¤

    â¦¿ puppet-4.10 æ¨¡å—é»˜è®¤å®‰è£…ä½ç½®
       cd /etc/puppetlabs/code/environments/production/modules

    â¦¿ æŸ¥çœ‹æ¨¡å—
        ll /etc/puppetlabs/code/environments/production/modules
        tree /etc/puppetlabs/code/environments/production/modules/nginx -d

    â¦¿ æ¨¡å—å‡çº§
        puppet module upgrade puppet-nginx --version 0.7.0
        0.7.0 æ”¹æˆ æœ€æ–°çš„å°±å¯ä»¥.
    
    â¦¿ æ¨¡å—åˆ é™¤  
        puppet module uninstall puppet-nginx


ğŸ”µ æ¨¡å—å¸¸è¯†
    äº†è§£äº†æ¨¡å—.ä½ å°±åŸºæœ¬äº†è§£äº† puppet ç»“æ„.
    æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹!   
    æ¨¡å—ä¸€èˆ¬éƒ½åœ¨ modules æ–‡ä»¶å¤¹ä¸‹. ä¸åŒç‰ˆæœ¬, modules æ–‡ä»¶å¤¹è·¯å¾„ä¸åŒ!!!

    ğŸ”¸ manifests   manifestsæ˜¯æ¸…å•çš„æ„æ€  é‡Œé¢çš„ init.pp æœ€é‡è¦


ğŸ”µ æ¨¡å—ä½¿ç”¨

    ğŸ”¸ masterä¸»æœº
        â¦¿ åˆ›å»º/å®‰è£… æ¨¡å—

        â¦¿ é…ç½®ç«™ç‚¹æ¸…å•
            puppet 4.10 é»˜è®¤ç«™ç‚¹æ¸…å•ä½ç½® /etc/puppetlabs/code/environments/production/manifests/
            puppet cert list --all  å¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹åå­—.


            vi /etc/puppetlabs/code/environments/production/manifests/site.pp
            node mail.0214.help {
                include nginx
            }


        â¦¿ é‡å¯
            sudo systemctl start puppetserver && systemctl status puppetserver


    ğŸ”¸ agentèŠ‚ç‚¹
        â¦¿ è¿æ¥æœåŠ¡å™¨  puppet agent --test


    ğŸ”¸ å˜åŒ–.
        æ¨¡å—å¹²äº†ä»€ä¹ˆ... å°±è¦åˆ†ææ¨¡å—äº†...
        ä» puppet agent --test çš„è¿è¡Œç»“æœçœ‹æ˜¯å¢æ”¹äº†ä¸€äº›æ–‡ä»¶.
        -    include /etc/nginx/conf.d/*.conf;
        +  include /etc/nginx/conf.d/*.conf;
        +  include /etc/nginx/sites-enabled/*;
        }

        Info: Computing checksum on file /etc/nginx/nginx.conf
        Info: /Stage[main]/Nginx::Config/File[/etc/nginx/nginx.conf]: Filebucketed /etc/nginx/nginx.conf to puppet with sum f7984934bd6cab883e1f33d5129834bb
        Notice: /Stage[main]/Nginx::Config/File[/etc/nginx/nginx.conf]/content: content changed '{md5}f7984934bd6cab883e1f33d5129834bb' to '{md5}2cd40583be476db9fe1b949ab0d82ca1'
        Info: Class[Nginx::Config]: Scheduling refresh of Class[Nginx::Service]
        Info: Class[Nginx::Service]: Scheduling refresh of Service[nginx]
        Notice: /Stage[main]/Nginx::Service/Service[nginx]/enable: enable changed 'false' to 'true'
        Notice: /Stage[main]/Nginx::Service/Service[nginx]: Triggered 'refresh' from 1 events
        Notice: Applied catalog in 6.17 seconds


ğŸ”µ nginx æ¨¡å—è¯¦è§£

ğŸ”¸ ç®€ä»‹
    å‘½ä»¤éƒ½æ˜¯åœ¨ site.pp ä¸­çš„.
    cat /etc/puppetlabs/code/environments/production/manifests/site.pp
    node mail.0214.help {
        include nginx
    }
    è¿™ä¸ª site.pp åŒ…å«äº†æ¨¡å—.  æ‰€ä»¥å…·ä½“å‘½ä»¤è¦å»nginxæ¨¡å—çœ‹
    cd /etc/puppetlabs/code/environments/production/modules/nginx
    æ¯ä¸ªæ¨¡å—éƒ½æœ‰å„è‡ªçš„ puppet é…ç½®æ–‡ä»¶(.pp ç»“å°¾), ä¸€èˆ¬éƒ½åœ¨ æ¨¡å—/mainifests ç›®å½•ä¸‹.

    âœ˜âœ˜âˆ™GCE manifests âœ ls
    total 36
    -rw-r--r-- 1 root root  9231 Aug  1 19:24 config.pp
    -rw-r--r-- 1 root root 11592 Aug  1 19:24 init.pp
    drwxr-xr-x 2 root root    38 Aug  1 19:25 package
    -rw-r--r-- 1 root root  1360 Aug  1 19:24 package.pp âœ ç¨‹åºçš„å®‰è£…å¸è½½å‡çº§
    -rw-r--r-- 1 root root  3738 Aug  1 19:24 params.pp
    drwxr-xr-x 3 root root   137 Aug  1 19:25 resource
    -rw-r--r-- 1 root root  1581 Aug  1 19:24 service.pp âœ æœåŠ¡ç®¡ç†

    å¯ä»¥çœ‹æˆ nginx æ¨¡å—æœ‰ 5 puppeté…ç½®æ–‡ä»¶.

ğŸ”¸ service.pp 
ä¸‹é¢çš„è¯­æ³•æ˜¯ç”¨ puppet è‡ªå·±çš„è¯­æ³•. å…¶å®å¾ˆç®€å•çš„.




âœ˜âœ˜âˆ™GCE manifests âœ cat service.pp

class nginx::service(   âœ åº”è¯¥æ˜¯è®¾ç½®å˜é‡çš„
  $service_restart = $::nginx::service_restart,
  $service_ensure  = $::nginx::service_ensure,
  $service_name    = $::nginx::service_name,
  $service_flags   = $::nginx::service_flags,
  $service_manage  = $::nginx::service_manage,
) {

  assert_private()

  $service_enable = $service_ensure ? {
    'running' => true,
    'absent'  => false,
    'stopped' => false,
    'undef'   => undef,
    default   => true,
  }

  if $service_ensure == 'undef' {
    $service_ensure_real = undef
  } else {
    $service_ensure_real = $service_ensure
  }

  if $service_manage {
    case $::osfamily {
      'OpenBSD': {
        service { 'nginx':
          ensure     => $service_ensure_real,
          name       => $service_name,
          enable     => $service_enable,
          flags      => $service_flags,
          hasstatus  => true,
          hasrestart => true,
        }
      }
      default: {
        service { 'nginx':                    âœ serviceèµ„æºç±»å‹
          ensure     => $service_ensure_real, 
          name       => $service_name,
          enable     => $service_enable,   âœ å¼€æœºå¯åŠ¨
          hasstatus  => true,
          hasrestart => true,
        }
      }
    }
  }

  # Allow overriding of 'restart' of Service resource; not used by default
  if $service_restart {
    Service['nginx'] {
      restart => $service_restart,
    }
  }
}






ğŸ”¸ package 
âœ˜âœ˜âˆ™GCE manifests âœ cat package.pp

class nginx::package {

  $package_name             = $::nginx::package_name
  $package_source           = $::nginx::package_source
  $package_ensure           = $::nginx::package_ensure
  $package_flavor           = $::nginx::package_flavor
  $passenger_package_ensure = $::nginx::passenger_package_ensure
  $manage_repo              = $::nginx::manage_repo

  assert_private()

  case $::osfamily {
    'redhat': {
      contain ::nginx::package::redhat
    }
    âœ redhat ç³»ç»Ÿ

    'debian': {
      contain ::nginx::package::debian
    }
    âœ debian ç³»ç»Ÿ


    'Solaris': {
      # $package_name needs to be specified. SFEnginx,CSWnginx depending on
      # where you get it.
      if $package_name == undef {
        fail('You must supply a value for $package_name on Solaris')
      }

      package { 'nginx':     âœ packageèµ„æºç±»å‹
        ensure => $package_ensure,
        name   => $package_name,
        source => $package_source,
      }
    }
    âœ Solaris ç³»ç»Ÿ: æ¯”è¾ƒå°ä¼—. æ²¡å¬è¿‡ä¹Ÿæ­£å¸¸..


    'OpenBSD': {
      package { $package_name:
        ensure => $package_ensure,
        flavor => $package_flavor,
      }
    }
    default: {
      package { $package_name:     âœ packageèµ„æºç±»å‹,  è¿™ä¸ªè½¯ä»¶
        ensure => $package_ensure, âœ ç¡®ä¿è¿™ä¸ªè½¯ä»¶æ˜¯ã€€å¯åŠ¨çš„!!
      }
    }
  }
}





ğŸ”¸ è‡ªå®šä¹‰æ¨¡å—
âœ˜âœ˜âˆ™ğ’—1 ~ âœ cd /etc/nginx
âœ˜âœ˜âˆ™ğ’—1 nginx âœ ls
total 60
drwxr-xr-x 2 root root 4096 Aug 16 21:12 conf.d
drwxr-xr-x 2 root root 4096 Aug 16 21:12 conf.mail.d
drwxr-xr-x 2 root root 4096 Aug 16 21:12 conf.stream.d
-rw-r--r-- 1 root root 1007 Jul 11 21:50 fastcgi_params
-rw-r--r-- 1 root root 2837 Jul 11 21:50 koi-utf
-rw-r--r-- 1 root root 2223 Jul 11 21:50 koi-win
-rw-r--r-- 1 root root 3957 Jul 11 21:50 mime.types
lrwxrwxrwx 1 root root   29 Aug 16 21:12 modules -> ../../usr/lib64/nginx/modules
-rw-r--r-- 1 root root 1502 Aug 16 21:12 nginx.conf
-rw-r--r-- 1 root root  636 Jul 11 21:50 scgi_params
drwxr-xr-x 2 root root 4096 Aug 16 21:12 sites-available
drwxr-xr-x 2 root root 4096 Aug 16 21:12 sites-enabled
drwxr-xr-x 2 root root 4096 Aug 16 21:12 streams-available
drwxr-xr-x 2 root root 4096 Aug 16 21:12 streams-enabled
-rw-r--r-- 1 root root  664 Jul 11 21:50 uwsgi_params
-rw-r--r-- 1 root root 3610 Jul 11 21:50 win-utf


å…¶å®nginx æ¨¡å—å¹²äº†å¾ˆå¤šäº‹æƒ….  æœ‰æ•ˆæ˜¯æˆ‘ä»¬ä¸éœ€è¦çš„.
å…¶å®ç°åœ¨æˆ‘ä»¬è¦ ç»™ vps1 åŠ ä¸ª è™šæ‹Ÿä¸»æœº. å®Œå…¨å¯ä»¥é€šè¿‡ gce çš„puppet æ‰§è¡Œ.

æ¯”å¦‚ç°åœ¨ vps1 çš„ip æ˜¯åˆ° nginx çš„æ¬¢è¿é¡µé¢çš„.  /home/wwwroot/defaulet 
æˆ‘ä»¬æŠŠå®ƒæ”¹æ‰.  /home/wwwroot/cv.0124.help  ç¡®ä¿ä¸‹é¢æœ‰ index.html æ–‡ä»¶.
é¦–å…ˆæˆ‘ä»¬è¿›è¡ŒåŸŸåè§£æ. 
puppetcv.0214.help âœ 23.105.192.96

åªè¦åœ¨æ¨¡å—ä¸‹æ–°å»ºä¸ªé…ç½®. 

cd /etc/puppetlabs/code/environments/production/modules/nginx/manifests

vi cv.pp

include ::nginx

::nginx::resource::server { 'puppetcv.0214.help':
    ensure => present,
    www_root => '/home/wwwroot/cv.0124.help/',
}

ç„¶åå®¢æˆ·ç«¯é‡æ–°è¿æœåŠ¡å™¨
puppet agent --test
åº”è¯¥ä¼šæ‰§è¡Œ....
è¿™ä¸ªå¯æ˜¯æŒ‰ç…§ æ¨¡å—çš„æ ·æœ¬æ–‡ä»¶æ¥çš„å•Š..


â¦¿ ping æµ‹è¯• 
    ping puppetcv.0214.help
    ç¡®ä¿å·²ç»è§£æåˆ° 23.105.192.96


â¦¿ æµè§ˆå™¨æµ‹è¯• 
    puppetcv.0214.help
    æ²¡å˜åŒ–å•Š...
    å“ªé‡Œé”™äº†...
    è‡ªå·±æ–°å»ºæ–‡ä»¶ä¸è¡Œ... é‚£å°±ä¿®æ”¹æ–‡ä»¶..
    è¿™ä¸ªå±äºé…ç½® 
    ğŸ‘¹ âŒ.........  ä¸çŸ¥é“æ€ä¹ˆåŠäº† 
å®˜æ–¹è¯´æ˜æ–‡æ¡£çœ‹ä¸æ‡‚å•Š..
    https://forge.puppet.com/puppet/nginx

é‚£å°±å…ˆåˆ›å»ºæœ€ç®€å•çš„æ¨¡å—å§. ä¸æ”¹åˆ«äººçš„æ¨¡å—äº†









ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ ä¾‹ä¸€ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ







ğŸ”µ master/agentçš„å¤šç¯å¢ƒæ”¯æŒ

puppetçš„å¤šç¯å¢ƒæ”¯æŒï¼š
    masterç«¯ç¯å¢ƒé…ç½®æ®µï¼šä¸ºä¸åŒçš„ä¸»æœºé…ç½®ä¸åŒçš„é…ç½®
        [master]
        enviroment = production, testing, development   #å£°æ˜masteræ”¯æŒé‚£äº›ç¯å¢ƒé…ç½®

        [production](ç”Ÿäº§ç¯å¢ƒï¼‰
        manifest = /etc/puppet/environments/production/manifests/site.pp
        modulepath = /etc/puppet/enviroments/production/modules/
        fileserverconfig = /etc/puppet/fileserver.conf

        [testing]
        manifest = /etc/puppet/environments/testing/manifests/site.pp
        modulepath = /etc/puppet/enviroments/testing/modules/
        fileserverconfig = /etc/puppet/fileserver.conf

        [development]
        manifest = /etc/puppet/environments/development/manifests/site.pp
        modulepath = /etc/puppet/enviroments/development/modules/
        fileserverconfig = /etc/puppet/fileserver.conf    

    agentç«¯é…ç½®æ–‡ä»¶ï¼š
        [agent]
        enviroment = testing

































â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ  Puppet å®‰è£… ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”µ å®‰è£…ç®€ä»‹
                                  â¤ï¸â¤ï¸ï¸â¤ï¸ Puppet æå“å…¥é—¨æ•™ç¨‹ â¤ï¸â¤ï¸â¤ï¸
     http://www.zsythink.net/archives/category/%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3/puppet/

                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸å®‰è£…puppet-server ä¼šè‡ªåŠ¨å®‰è£… puppet-agent.â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸â—ï¸
                          ä¸ç®¡ä»€ä¹ˆç”µè„‘è¦ç”¨puppetå®‰è£… puppet-server å°±å¯¹äº†.
                           æ‰€ä»¥: æœåŠ¡å™¨å°½é‡å®‰è£…æœ€æ–°ç‰ˆæœ¬. å®¢æˆ·ç«¯ç›¸å¯¹æ— æ‰€è°“.


                        ğŸ“Œåˆ«åœ¨Macä¸ŠæŠ˜è…¾ puppet-agent. æˆ‘åæ­£åŠå¤©æ²¡æŠ˜è…¾æˆåŠŸğŸ“Œ
    ğŸ”¸ç›®çš„: åœ¨æ— å…¬ç½‘IPçš„Centos7è™šæ‹Ÿæœºä¸Šæ­å»º puppet-server æœåŠ¡å™¨. æ§åˆ¶æœ‰å…¬ç½‘IPçš„ vps.(puppet-agent)



ğŸ”µ ä¸‰ä¸ªç»„ä»¶:
    ğŸ”¸puppet-server    Puppet Server. ä¼šè‡ªåŠ¨å®‰è£… puppet-agent!!!
    ğŸ”¸puppet-agent     å¤šåˆä¸€å®‰è£…åŒ….ä¼šå®‰è£… Puppet-agent, Ruby, Facter.ç­‰å„ç§ä¾èµ–.
                       ğŸ‘â€ğŸ—¨Facter è·å–å®¢æˆ·ç«¯æ•°æ®å¹¶ä¼ ç»™æœåŠ¡å™¨.
    ğŸ”¸puppetdb         æ•°æ®åº“. å¯ä»¥æ›´å¥½çš„ä½¿ç”¨ puppet.

        Puppet: C/Sæ¶æ„è½¯ä»¶.
            ğŸ“ŒæœåŠ¡å™¨ä¸€èˆ¬è¦å®‰è£… puppet-server
            ğŸ“Œå®¢æˆ·ç«¯ä¸€èˆ¬ä¹Ÿå®‰è£… puppet-server åæ­£ä¼šè‡ªåŠ¨å®‰è£…puppet-agentçš„.       





ğŸ”µ Puppet å·¥ä½œæµç¨‹

    puppetæ˜¯æ‰¹é‡ç®¡ç†æœåŠ¡å™¨çš„, æ¯”å¦‚è¦å®‰è£…/è¾“å‡º/æ›´æ–°è½¯ä»¶ã€æ–°å»º/åˆ é™¤ç”¨æˆ·ã€å¯åŠ¨/åœæ­¢è¿›ç¨‹...
    æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½æ˜¯å‚¨å­˜åœ¨æœåŠ¡å™¨ä¸­.å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨. çœ‹æœåŠ¡å™¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°.
    å¦‚æœæœ‰æ›´æ–°.å°±ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶ååœ¨æœ¬åœ°æ‰§è¡Œ

    å®¢æˆ·ç«¯çš„facter ä¼šè·å–å®¢æˆ·ç«¯è‡ªå·±ç”µè„‘çš„ä¿¡æ¯(å¦‚ä¸»æœºåï¼Œå†…å­˜å¤§å°ï¼Œipåœ°å€ç­‰) å‘é€ç»™æœåŠ¡å™¨.
    æœåŠ¡å™¨çš„facter æ ¹æ®å®¢æˆ·ç«¯ä¸»æœºå.åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”çš„é…ç½®.æ¥åˆ†æå®¢æˆ·ç«¯æ˜¯å¦æˆåŠŸæ‰§è¡Œ

    å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŸºäºSSLè¯ä¹¦çš„.
    ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è¯·æ±‚è¿æ¥æœåŠ¡å™¨. ä½†æ˜¯åªæœ‰åœ¨æœåŠ¡å™¨åŒæ„åæ‰å¯ä»¥å’ŒæœåŠ¡å™¨é€šä¿¡!!

    puppet  ä¼šè®©ç³»ç»Ÿä¿æŒåœ¨äººä»¬æ‰€æœŸæœ›çš„æŸç§çŠ¶æ€å¹¶ä¸€ç›´ç»´æŒä¸‹å».ä¾‹å¦‚ï¼š
        ä¿è¯æŸä¸ªæ–‡ä»¶ä¸€ç›´å­˜åœ¨ï¼Œ å¦‚æœè¯¥æ–‡ä»¶è¢«åˆ é™¤äº†   puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡æ–°åˆ›å»ºæ–‡ä»¶.
        ä¿è¯sshæœåŠ¡å§‹ç»ˆå¼€å¯ï¼Œ  å¦‚æœsshæœåŠ¡è¢«å…³é—­äº†  puppetä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ä¼šé‡å¯sshæœåŠ¡.









ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ CentOS6 å®‰è£… ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ

    ğŸ”µä¾èµ–ç¯å¢ƒ
        ğŸ”¸ lsb_release -a                æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬. âœ  Description: CentOS release 6.9 (Final)
        ğŸ”¸ uname -a                      æŸ¥çœ‹ç³»ç»Ÿæ˜¯32ä½è¿˜æ˜¯64ä½. åªæœ‰è¾“å‡ºæ˜¯x86_64 æ‰æ˜¯64ä½çš„. å…¶ä»–éƒ½æ˜¯32ä½çš„!!!!
        ğŸ”¸ yum install ruby ruby-rdoc    å®‰è£…rubyç¯å¢ƒ.
        ğŸ”¸ æ·»åŠ puppet çš„å®˜æ–¹yumæº.
            rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
            â—ï¸â—ï¸è¿™ä¸ªPC1æº(Puppet Collections)æ‰å¯ä»¥å®‰è£…4.+ç‰ˆæœ¬ â—ï¸â—ï¸

                    rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm
                    ğŸ‘â€ğŸ—¨ è¿™ä¸ªæºæœ€é«˜åªèƒ½å®‰è£… 3.8.7çš„ç‰ˆæœ¬!! åˆ«ç”¨è¿™ä¸ªæº.

                    ğŸ‘¹ package puppetlabs-release-22.0-2.noarch is already installed
                    å¦‚æœå‡ºç° xxx is already installed ç±»ä¼¼æç¤º.  ç”¨ rpm --force -i  âœš ç½‘å€ å¼ºåˆ¶å®‰è£….
                    rpm --force -i https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm

    ğŸ”µå®‰è£…puppet-server
        ğŸ”¸yum install puppetserver
            ğŸ‘â€ğŸ—¨ 4+ ç‰ˆæœ¬å’Œ3+çš„å®‰è£…å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ 3+ çš„å¥½åƒæ˜¯: yum install puppetmaster
            Serveré»˜è®¤å¯¹å†…å­˜è¦æ±‚é«˜å¾—2G... 256mçš„vpsè·‘ä¸ªå®¢æˆ·ç«¯å°±å¯ä»¥äº†åˆ«è·‘æœåŠ¡ç«¯äº†...
        ğŸ”¸ é…ç½®ç¯å¢ƒè·¯å¾„
                å®‰è£…å¥½åä½ ä¼šå‘ç°ä¸èƒ½æ‰§è¡Œpuppetå‘½ä»¤!
                    ğŸ‘â€ğŸ—¨ å¦‚æœä½ ç”¨çš„æ˜¯ 3.8.7 çš„é‚£ä¸ªæºæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨puppetå‘½ä»¤çš„.ä¹Ÿå°±ä¸éœ€è¦é…ç½®ç¯å¢ƒè·¯å¾„. 
                æ­£å¸¸ puppet agent -V å°±èƒ½æ˜¾ç¤ºå½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬çš„.
                ğŸ“ŒPuppet4 çš„å˜åŒ–æ¯”è¾ƒå¤§. 
                    ğŸ‘â€ğŸ—¨ é…ç½®è·¯å¾„: /etc/pupperlabs
                    ğŸ‘â€ğŸ—¨ ç¨‹åºè·¯å¾„: /opt/puppetlabs
                ç›´æ¥å»ç¨‹åºå®‰è£…è·¯å¾„å»çœ‹çœ‹èƒ½ä¸èƒ½æ‰§è¡Œ.
                cd /opt/puppetlabs/bin
                ./puppet agent -V
                    è¿™ä¸‹å°±æ˜¾ç¤ºå‡ºå½“å‰ç‰ˆæœ¬äº†!è¯´æ˜å®‰è£…æˆåŠŸçš„.è‡ªå·±é…ä¸‹ç¯å¢ƒè·¯å¾„å°±å¥½äº†. 
                    è¿™ä¸€è¿™ä¸ªå‘½ä»¤å‰çš„ ./ è¿™ä¸ªè¡¨ç¤ºå½“å‰æ–‡ä»¶å¤¹!!!!

                ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨æŠŠ /opt/puppetlabs/bin   è¿™ä¸ªè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒè·¯å¾„ä¸­!!
                ä»¥åä»»ä½•ä½ç½®éƒ½å¯ä»¥è¿è¡Œpuppetå‘½ä»¤äº†. è€Œä¸æ˜¯å¿…é¡»cdåˆ°puppetçš„å®‰è£…è·¯å¾„ä¸‹æ‰èƒ½è¿è¡Œpuppetå‘½ä»¤.
                ç¯å¢ƒè·¯å¾„ å’Œä½ ä½¿ç”¨çš„sehllæœ‰å…³. 
                æˆ‘ç”¨zsh é‚£ä¹ˆåªè¦åœ¨  ~/.zshrc è¿™ä¸ªæ–‡ä»¶é‡ŒåŠ ä¸‹é¢è¡Œ.ç„¶åé‡å¯shellç”Ÿæ•ˆ.
                export PATH=/opt/puppetlabs/bin:$PATH
                åœ¨æ–‡ä»¶å°¾éƒ¨æ·»åŠ ä¸€è¡Œ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨echo. å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨viæ·»åŠ .
                ğŸ”… echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
                ğŸ‘â€ğŸ—¨ è¿™é‡Œå¿…é¡»ç”¨ å•å¼•å·. å•å¼•å·é‡Œé¢çš„å†…å®¹æ‰ä¼šä¸€æ¨¡ä¸€æ ·çš„è¿½åŠ åˆ°æ–‡ä»¶ä¸­.ä¸ç„¶$PATHè¿™ä¸ªå˜é‡ä¼šå±•å¼€.
                ğŸ‘â€ğŸ—¨ æ·»åŠ å˜é‡åè®°å¾—é‡å¯shell. æœåŠ¡å™¨çš„è¯.æ–­å¼€ssh é‡æ–°è¿å°±å¯ä»¥äº†.

                
ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸â¤ï¸ FRP å†…ç½‘ç©¿é€è®¾ç½®â¤ï¸ ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

    è§’è‰²           ç³»ç»Ÿ             IPåœ°å€    å®‰è£…è½¯ä»¶           ä¸»æœºå.
    puppet-server  Centos7(è™šæ‹Ÿæœº)  å†…ç½‘IP    puppet-server      VM-C7     
    puppet-agent   Centos6(VPS)     å…¬ç½‘IP    puppwt-agent       mail.0214.help 

è¦ä½¿ç”¨ puppet. å¿…é¡»ä¿è¯ åŒæ–¹èƒ½ç”¨åŸŸåäº’ç›¸è§£æåˆ°. 
å› ä¸º puppet æ˜¯é€šè¿‡  VM-C7 å’Œ mail.0214.help  ä¸»æœºåæ¥äº’ç›¸äº¤æµçš„!

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent éƒ½åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…. æ¯”å¦‚:
    puppet-server çš„IPåœ°å€æ˜¯ 192.168.1.1, ä¸»æœºåæ˜¯ master
    puppet-agent  çš„IPåœ°å€æ˜¯ 192.168.1.2, ä¸»æœºåæ˜¯ client

    é‚£ä¹ˆåŸŸåè§£æéå¸¸ç®€å•.
        åªè¦åœ¨puppet-server çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.2  client
            æ·»åŠ åä½ å»puppet-server ç”µè„‘å¼€ç»ˆç«¯ ping client å°±æ˜¯ping 192.168.1.2

        åªè¦åœ¨puppet-agent çš„hostsæ–‡ä»¶æ·»åŠ ä¸€è¡Œ: 192.168.1.1  master
            æ·»åŠ åä½ å»puppet-agent ç”µè„‘å¼€ç»ˆç«¯ ping master å°±æ˜¯ping 192.168.1.1

        è¿™å°±æ˜¯åŸŸåè§£æ. ä¹Ÿå°±æ˜¯æŠŠä¸€ä¸ªåå­— å¯¹åº”åˆ°ä¸€ä¸ªIPä¸Š. å°±è¿™ä¹ˆç®€å•.

ğŸ”µ å¦‚æœ puppet-server å’Œ puppet-agent ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†….æ¯”å¦‚:
    puppet-server çš„å†…ç½‘IPåœ°å€æ˜¯ 192.168.1.1,  ä¸»æœºåæ˜¯ VM-C7
    puppet-agent  çš„å…¬ç½‘IPåœ°å€æ˜¯ 23.105.192.96 ä¸»æœºåæ˜¯ mail.0214.help
    è¦å®ç°äº’ç›¸è§£æå°±éœ€è¦å¯¹ç½‘ç»œ å’Œ puppet æœ‰ç‚¹äº†è§£äº†. éœ€è¦å€ŸåŠ©å†…ç½‘ç©¿é€å·¥å…·.æ¨èç”¨frp. 
    ä¸¤å°puppetè¡¨é¢ä¸Šæ˜¯é€šè¿‡ åŸŸåæ¥äº’ç›¸äº¤æµçš„. å®é™…ä¸Šæ˜¯é€šè¿‡IPæ¥äº’ç›¸äº¤æµçš„.
    ç”¨åŸŸååªæ˜¯ä¸ºäº†æ–¹ä¾¿äººç±»è®°å¿†. å¥½æ¯” å§“åå’Œèº«ä»½è¯å·ç . è‚¯å®šæ˜¯å§“åå®¹æ˜“è®°å•Š..

    å†æ·±å…¥ä¸€ç‚¹. æœåŠ¡å™¨å¯ä»¥åŒæ—¶è¿è¡Œå¾ˆå¤šè½¯ä»¶.ä¸€èˆ¬ä¸€ä¸ªæœåŠ¡å™¨ä¹Ÿå°±ä¸€ä¸ªå¤–ç½‘IP.
    ç”µè„‘ä¸Šçš„æ¯ä¸ªè½¯ä»¶åªç”¨äº†IPçš„å‡ ä¸ªç«¯å£è€Œå·².
    æ¯”å¦‚ç½‘é¡µ:   http çš„80ç«¯å£ã€https çš„443ç«¯å£.
    æ¯”å¦‚puppet: puppet-server çš„8140ç«¯å£. puppet-agent çš„8139ç«¯å£.

    å…¶å® puppet-server å’Œ puppet-agent ä¹‹é—´ç”¨çš„æ˜¯ http åè®®.
    puppet-agent é€šè¿‡ç”µè„‘ä¸Šçš„8139ç«¯å£ å‘æ¶ˆæ¯ç»™ puppet-server ä¸Šçš„8140ç«¯å£.
    æ—¢ç„¶ç«¯å£æ˜¯ç¡®å®šçš„. æˆ‘ä»¬ä¸ç”¨ç®¡.é‚£ä¹ˆæˆ‘ä»¬åªè¦è§£å†³IPé—®é¢˜å°±å¥½äº†. 
    puppet-agent æœåŠ¡å™¨æ˜¯æœ¬èº«å¸¦æœ‰å…¬ç½‘IPçš„. ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-agentå¾ˆç®€å•.  è§£æå¯ä»¥ç†è§£æˆè¿æ¥. æ¯”å¦‚sshè¿æ¥.
    puppet-server æ˜¯å†…ç½‘ç”µè„‘.æ²¡æœ‰IPçš„.     ä»»ä½•ç”µè„‘è¦è§£æåˆ°puppet-serverå°±å¾ˆéš¾. ç”¨äº† frpå°±å¾ˆç®€å•!!!
    frp åŸç†è¿™é‡Œä¸è¯´. è‡ªå·±çœ‹ frp.txtå».


ğŸ”µ FRPæœåŠ¡å™¨è®¾ç½® (Centos6 VPS å…¬ç½‘IP: 23.105.192.96)
    vi frps.ini                 âœ ç¼–è¾‘frpæœåŠ¡å™¨é…ç½®æ–‡ä»¶,æ·»åŠ ä¸‹é¢ä¸‰è¡Œ: 
    [vm-centos7-puppetserver]   âœ æ¨¡å—åå­—. åå­—ä»»æ„å–.ä½†æ˜¯å¿…é¡»å’Œfrpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å—åä¸€æ ·.
    auth_token = 123            âœ å¯†ç . æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ äº¤æµè¦å…ˆå¯¹æ¯”å¯†ç çš„. åŒæ–¹å¯†ç ä¸€ç›´æ‰å¯ä»¥æˆåŠŸè¿ä¸ŠæœåŠ¡å™¨.
    listen_port = 8140          âœ è¿™ä¸ªå°±æ˜¯é‡ç‚¹äº†. è¿™ä¸ªæ˜¯frpæœåŠ¡å™¨ç«¯å£.
                                âœ å¦‚æœæœ‰äººè®¿é—®23.105.192.96:8140 é¦–å…ˆæ˜¯è¿æ¥åˆ°frpæœåŠ¡å™¨è¿™å°ç”µè„‘.
                                âœ ç„¶åfrpæœåŠ¡å™¨å°±ä¼šæŠŠè¿™ä¸ªç«¯å£çš„æ‰€æœ‰æ•°æ®è½¬å‘ç»™æˆ‘ä»¬ç­‰ä¸‹å°±å»è®¾ç½®çš„å®¢æˆ·ç«¯.
                                âœ æ–‡ä»¶ç¼–è¾‘å¥½åéœ€è¦é‡å¯frpæœåŠ¡.

    ğŸ”¸ pidof frps                    âœ æ‰¾å‡ºfrpsè¿›ç¨‹: 
    ğŸ”¸ kill xxx                      âœ æ€æ­»frpsè¿›ç¨‹. ä¹Ÿå°±æ˜¯åœæ­¢ç¨‹åºäº†.
    ğŸ”¸ ./frps -c ./frps.ini          âœ æµ‹è¯•å¯åŠ¨. æœ‰é”™è¯¯ä¼šæŠ¥é”™! æ²¡æŠ¥é”™å†ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œåå°é•¿æœŸè¿è¡Œ..
    ğŸ”¸ nohup ./frps -c ./frps.ini &  âœ åå°è¿è¡Œ.æ–­å¼€sshä¹Ÿæ²¡å…³ç³».



ğŸ”µ FRPå®¢æˆ·ç«¯è®¾ç½® (puppet-server Centos7 è™šæ‹Ÿæœº)
    ğŸ”¸ä¸‹è½½å¯¹åº”çš„å®¢æˆ·ç«¯ wget https://github.com/fatedier/frp/releases/download/v0.9.3/frp_0.9.3_linux_386.tar.gz
    ğŸ”¸ è§£å‹æ–‡ä»¶        tar -xzf 
    ğŸ”¸ vi frpc.ini  ç¼–è¾‘frpå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
    [common]                       âœ åˆ«åŠ¨; è¿æ¥FRPæœåŠ¡å™¨çš„æ¨¡å—åç§°.
    server_addr = 23.105.192.96    âœ ä¿®æ”¹; FRPæœåŠ¡å™¨IP    
    server_port = 7000             âœ ä¸ç®¡; FRPæœåŠ¡å™¨ç«¯å£. 

    auth_token = 123               âœ ä¸ç®¡
    privilege_token = 12345678     âœ ä¸ç®¡

    [vm-centos7-puppetserver]      âœ é‡ç‚¹! è¿™ä¸ªéœ€è¦å’ŒFRPæœåŠ¡å™¨ä¸Šçš„æ¨¡å—åå¯¹åº”.
    local_port = 8140              âœ é‡ç‚¹! ä»»ä½•æ•°æ®è®¿é—®æœåŠ¡å™¨ä¸Šçš„ 8140ç«¯å£ 23.105.192.96:8140 
                                        FRPæœåŠ¡å™¨ å°±ä¼šæŠŠæ•°æ®è½¬å‘åˆ°è¿™å°ç”µè„‘. ä½†æ˜¯è¿™å°ç”µè„‘æœ‰å¾ˆå¤šç«¯å£. 
                                        local_port=8140çš„æ„æ€å°±æ˜¯ è½¬å‘åˆ°8140è¿™ä¸ªç«¯å£
                                        ç°åœ¨åˆ«çš„iFFmpegæŒ‰é’®è¡¨é¢ä¸Šæ˜¯è®¿é—®çš„ 23.105.192.96:8140 
                                        å…¶å®ç»è¿‡frpæœåŠ¡å™¨åœ¨ä¸­è½¬å å®é™…å°±å˜æˆäº†è®¿é—® puppet-serverçš„8140ç«¯å£äº†.
                                        ä¹Ÿå°±æ˜¯åˆ«çš„ç”µè„‘æƒ³è¦è¿æ¥åˆ° pupper-server.
    ğŸ”¸nohup ./frpc -c ./frpc.ini &  âœ åå°å¯åŠ¨frp å®¢æˆ·ç«¯





ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸åŸŸåè§£æ ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

ğŸ”¸ å…³é—­ SELINUX
    Security-Enhanced Linuxçš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§éå¸¸å®‰å…¨çš„LINUXæ¨¡å¼ã€‚
    åŸºæœ¬ä¸Šç”¨æˆ·å¾—ä¸åˆ°ä»€ä¹ˆæƒé™åœ¨è¿™ä¸ªç³»ç»Ÿä¸‹é¢ã€‚
    ğŸ”…  /usr/sbin/sestatus -v                     âœ æŸ¥çœ‹å½“å‰SELINUXçŠ¶æ€. 
        vi /etc/selinux/config                    âœ ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥æ°¸ä¹…å…³é—­SELINUX
        å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabled   âœ ä¿®æ”¹åé‡å¯ç”µè„‘.


ğŸ”¸ æ–°æ‰‹å…³é—­é˜²ç«å¢™.

ğŸ”¸ æ—¶é—´è®¾ç½®
       Puppetçš„masterèŠ‚ç‚¹çš„æ—¶é—´å¿…é¡»è®¾ç½®å‡†ç¡®ï¼Œå› ä¸ºä»–å°†ç”¨äºè¯ä¹¦ç­¾å‘.å°½å¯èƒ½çš„ä½¿ç”¨NTP.

ğŸ”¸Cent0s7 æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname VM-C7  âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆVM-C7


ğŸ”¸puppet-agentåŸŸåè§£æ
    vi /etc/hosts         
    23.105.192.96 VM-C7 âœ  æ·»åŠ è¿™è¡Œå°±å¯ä»¥äº†. ä½ ä¸ç”¨ç®¡ç«¯å£çš„ 
                        âœ è¿™ä¸ªç”µè„‘è¿è¡Œçš„æ˜¯puppet-agent é‚£ä¹ˆå®ƒè‚¯å®šæ˜¯å»è¿æ¥æœåŠ¡å™¨çš„.è‚¯å®šæ˜¯å»è¿æ¥8140ç«¯å£çš„.
                        âœ 23.105.192.96:8140 ç«¯å£çš„æ‰€æœ‰æ•°æ®.éƒ½ä¼šè¢«frpæœåŠ¡å™¨.è½¬ä¸ªpuppet-serverçš„8140ç«¯å£.

ğŸ”¸ ç¼–è¾‘puppet-agenté…ç½®æ–‡ä»¶. åœ¨[agent]æ¨¡å—ä¸‹æ·»åŠ ä¸‹é¢ä¸€è¡Œ.
    vi /etc/puppetlabs/puppet/puppet.conf
    server = VM-C7      âœ è¿™ä¸ªå°±æ˜¯ä½ è¦è¿æ¥çš„ puppet-server çš„ä¸»æœºå/åŸŸå
                        âœ puppet-agent æ˜¯è¿åˆ°å«è¿™ä¸ªåå­—çš„æœåŠ¡å™¨ä¸Šçš„. 
                        âœ è¿™ä¸ªåå­—å¯¹åº”çš„ip å°±æ˜¯æˆ‘ä»¬hostsæ–‡ä»¶é‡Œæ·»åŠ çš„dnsè§£æ

ğŸ”¸ puppet-agent è¿æ¥æœåŠ¡å™¨æµ‹è¯•
    ğŸ”… puppet agent --test
    Info: Creating a new SSL key for mail.0214.help

    puppet ä¸ºäº†ä¿¡æ¯å®‰å…¨. åŒæ–¹é‡‡ç”¨äº†SSLåè®®. ä¹Ÿå°±æ˜¯https. éœ€è¦ç”¨åˆ°è¯ä¹¦!
    å®¢æˆ·ç«¯è¿è¡Œ å°±è‡ªåŠ¨ä¼šå‘æœåŠ¡å™¨ç”³è¯·å»ºç«‹è¿æ¥. 
    è¿™æ—¶å€™è¦å»æœåŠ¡å™¨åŒæ„å®¢æˆ·ç«¯çš„è¿æ¥.å®¢æˆ·ç«¯æ‰èƒ½çœŸæ­£è¿ä¸ŠæœåŠ¡å™¨.
    åŒæ„è¿æ¥è¿™ä¸ªæ“ä½œå°±å«ç­¾å.
    æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å°±ä¼šé•¿æœŸä¿æŒé€šä¿¡(å®¢æˆ·ç«¯æ¯åŠå°æ—¶è¿ä¸€æ¬¡æœåŠ¡å™¨)!!!


ğŸ”¸ puppet-server æœåŠ¡å™¨æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚
    ğŸ”…puppet cert list
      "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
      å‡ºç°ä¸€ä¸ª å‰é¢æ²¡å¸¦åŠ å·çš„ å°±è¯´æ˜æœ‰å®¢æˆ·ç«¯æƒ³è¦è¿æœåŠ¡å™¨.å¦‚æœä½ åŒæ„å¯¹æ–¹è¿æ¥ å°±éœ€è¦ç­¾å.

ğŸ”¸ puppet-server å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œç­¾å
    ğŸ”…puppet cert sign mail.0214.help
    Signing Certificate Request for:
    "mail.0214.help" (SHA256) 6E:3F:48:F6:F1:52:18:30:F8:DD:2F:D3:7E:BA:C1:2E:1E:89:8A:0D:37:96:DF:E3:F5:79:A0:7F:85:5C:28:97
    Notice: Signed certificate request for mail.0214.help
    Notice: Removing file Puppet::SSL::CertificateRequest mail.0214.help at '/etc/puppetlabs/puppet/ssl/ca/requests/mail.0214.help.pem'


ğŸ”¸puppet-server æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦
    ğŸ”…requests puppet cert list -all
    + "mail.0214.help" (SHA256) 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    + "mail.0214.live" (SHA256) D3:D7:DB:74:E6:53:CC:0F:EE:55:83:5E:65:A5:9B:32:4B:D6:9F:E5:DA:D1:50:67:88:31:3C:44:EE:C0:EE:92

ğŸ”¸puppet-server å¤±æ•ˆæŸè¯ä¹¦  puppet cert --revoke mail.0214.live
ğŸ”¸puppet-server åˆ é™¤æŸè¯ä¹¦  puppet cert --clean mail.0214.live
    â—ï¸â—ï¸è¯ä¹¦ç­¾åçš„è¿‡æœŸæˆ–åˆ é™¤éœ€è¦é‡å¯puppetmasteræœåŠ¡ã€‚â—ï¸â—ï¸
    sudo systemctl restart puppetserver

ğŸ”¸puppet-agent è¿æ¥è®¾ç½®.
    âœ  puppet puppet agent --test
    Error: Could not request certificate: The certificate retrieved from the master does not match the agent's private key.
    Certificate fingerprint: 4D:01:04:D7:4B:C8:75:D6:C2:D5:63:BA:93:46:C2:E1:D9:82:D6:97:AA:AC:A8:50:69:9F:6A:A8:67:27:67:F2
    To fix this, remove the certificate from both the master and the agent and then start a puppet run, which will automatically regenerate a certificate.
    On the master:
    puppet cert clean mail.0214.help
    On the agent:
    1a. On most platforms: find /etc/puppetlabs/puppet/ssl -name mail.0214.help.pem -delete
    1b. On Windows: del "\etc\puppetlabs\puppet\ssl\certs\mail.0214.help.pem" /f
    2. puppet agent -t


    ğŸ“Œå¦‚æœå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨å‡ºé—®é¢˜. 
    ğŸ“Œ 1. é¦–å…ˆæ’é™¤frpé—®é¢˜. çœ‹frps/frpc æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
    ğŸ“Œ 2. è¿›è¡Œä¸‹é¢çš„æ­¥éª¤
    ğŸ“Œè¿˜ä¸è¡Œå°±é‡è£…å®¢æˆ·ç«¯.   è¿˜ä¸è¡Œå°±é‡è£…æœåŠ¡å™¨.  å†ä¸è¡Œå°±è‡ªå·±åˆ†æé—®é¢˜åŸå› äº†.
    1. å®¢æˆ·ç«¯: rm -rf /etc/puppetlabs/puppet/ssl/*     åˆ é™¤sslæ–‡ä»¶å¤¹æ‰€æœ‰å†…å®¹. ä¸è¦åªåˆ é™¤æŸä¸ªæ–‡ä»¶.
    3. æœåŠ¡å™¨: puppet cert clean mail.0214.help        åˆ é™¤è¯ä¹¦. 
    4. æœåŠ¡å™¨ï¸:ï¸ puppetserver reload ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸ ï¸       åˆ é™¤/å¤±æ•ˆæŸè¯ä¹¦åå¿…é¡»é‡å¯æœåŠ¡å™¨
    5. å®¢æˆ·ç«¯: puppet agent --test                     é‡æ–°ç”³è¯·è¯ä¹¦.
    6. æœåŠ¡å™¨: puppet cert list                        åˆ—å‡ºå®¢æˆ·ç«¯çš„è¯·æ±‚
    7. æœåŠ¡å™¨: puppet cert sign mail.0214.help         å¯¹mail.0214.help è¿™å®¢æˆ·ç«¯è¿›è¡Œç­¾å.
    8. å®¢æˆ·ç«¯: puppet agent --test                     é‡æ–°è¯·æ±‚è¿æ¥.
        ğŸ‘¹ Info: Caching certificate for mail.0214.help
        Error: Could not request certificate: 
        Server hostname 'VM-C7' did not match server certificate; 
        expected one of localhost.localdomain, DNS:puppet, DNS:localhost.localdomain
        Exiting; failed to retrieve certificate and waitforcert is disabled
            åˆæŠ¥é”™äº†...  æœåŠ¡å™¨çš„åå­— å’ŒæœåŠ¡å™¨çš„è¯ä¹¦ä¸æœ.
            é—®é¢˜å‡ºåœ¨æœåŠ¡å™¨. å…¶å®æœåŠ¡å™¨æ˜¯æ”¹è¿‡ä¸»æœºåå­—çš„. 
            åŸæ¥åå­—æ˜¯ localhost.localdomain å®‰è£…å¥½puppetserveråæ”¹æˆVM-C7äº†.
            å…¶å®puppetserver å®‰è£…çš„æ—¶å€™æ˜¯éœ€è¦ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦çš„! ç”Ÿæˆè¯ä¹¦è‚¯å®šç”¨åˆ°ä¸»æœºåçš„. 
            è¿™æ—¶å€™ç”¨çš„ä¸»æœºåæ˜¯localhost.localdomain.  å¯¹åº”æœåŠ¡å™¨è¯ä¹¦ä¸Šçš„ä¸»æœºåæ˜¯localhost.localdomain
            ğŸ”¸è§£å†³æ–¹æ³•ä¸€: å¸è½½é‡è£….puppet-server

            ğŸ”¸è§£å†³æ–¹æ³•äºŒ: å®¢æˆ·ç«¯: æ·»åŠ å‚æ•°. --server 
                âœ  ~ puppet agent --test --server localhost.localdomain
                Info: Caching certificate_revocation_list for ca
                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for mail.0214.help
                Info: Applying configuration version '1492656142'
                Info: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml

            ğŸ”¸è§£å†³æ–¹æ³•ä¸‰: 
                ç¼–è¾‘å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ [anent] ä¸‹é¢çš„server name æ”¹æ‰
                vi /etc/puppetlabs/puppet/puppet.conf
                server = localhost.localdomain

                è¿˜è¦æ·»åŠ  ä¸€æ¡åŸŸåè§£æ..
                vi /etc/hosts
                23.105.192.96 localhost.localdomain

                âœ  puppet puppet agent -t
                Info: Using configured environment 'production'
                Info: Retrieving pluginfacts
                Info: Retrieving plugin
                Info: Caching catalog for mail.0214.help
                Info: Applying configuration version '1492656538'
                Notice: Applied catalog in 0.02 seconds




ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸
é¦–å…ˆ ä½ å¾—å¤§æ¦‚çŸ¥é“puppet æœ‰å¤šå°‘å­å‘½ä»¤. æ¯ä¸ªpuppet å­å‘½ä»¤åˆæœ‰å“ªäº›action..
âœ˜âœ˜âˆ™ğ’— pp puppet help

Usage: puppet <subcommand> [options] <action> [options]

Available subcommands:

  agent             The puppet agent daemon
  apply             Apply Puppet manifests locally
                    âœ åœ¨å®¢æˆ·ç«¯æœ¬åœ°è¿è¡Œxx.pp 

  cert              Manage certificates and requests
                    âœ è¯ä¹¦ç›¸å…³å‘½ä»¤.

  config            Interact with Puppet's settings.
 
  facts             Retrieve and store facts.

  lookup            Data in modules lookup function

  master            The puppet master daemon
  module            Creates, installs and searches for modules on the Puppet Forge.

  node              View and manage node definitions.
  parser            Interact directly with the parser.
  plugin            Interact with the Puppet plugin system.









ğŸ”µ puppet apply 

puppet agent å®¢æˆ·ç«¯é»˜è®¤éƒ½æ˜¯ä»æœåŠ¡å™¨ä¸‹è½½é…ç½®æ–‡ä»¶.ç„¶åå†æ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶.
puppet apply å®¢æˆ·ç«¯å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä»æœåŠ¡å™¨ä¸‹è½½.è€Œæ˜¯ç›´æ¥è¿è¡Œæœ¬åœ°çš„é…ç½®æ–‡ä»¶.

ğŸ”¸é…ç½®æ–‡ä»¶:
config.pp
class puppet::config{
  include puppet::params
  file { '/etc/puppet/puppet.conf':
    ensure  => present,
    content => template('puppet/puppet.conf.erb'),
    owner   => 'root',
    group   => 'root',
    mode    => '0644',
    require => Class['puppet::install'],
    notify  => Class['puppet::service'],  #é…ç½®æ›´æ–°åä¸»åŠ¨é€šè¿‡puppetæœåŠ¡é‡å¯
  }
}

ğŸ”¸ æ¨¡æ‹Ÿæ‰§è¡Œè¿™ä¸ªé…ç½®æ–‡ä»¶.
âœ˜âœ˜âˆ™ğ’— pp puppet apply config.pp --noop --verbose


















ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ GCE(CentOS7_x64) puppet-server ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ

ğŸ”¸ å…¶ä»–è®¾ç½®

    â¦¿ CentOS æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname gce    âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆgce


ğŸ”¸ å®‰è£…&é…ç½®

    â¦¿ puppetå®˜æ–¹yumæº: 
        https://yum.puppetlabs.com/
    â¦¿ Centos6 æ·»åŠ puppet çš„å®˜æ–¹yumæº.
        rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
    â¦¿ Centos7 æ·»åŠ puppet çš„å®˜æ–¹yumæº.
        rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm
        ğŸ‘â€ğŸ—¨ åªè¦é€‰ä¸€ä¸ª.  æ ¹æ®centos ç‰ˆæœ¬é€‰å°±å¯ä»¥äº†

    â¦¿ å®‰è£…rubyç¯å¢ƒ             yum install ruby ruby-rdoc -y
    â¦¿ å®‰è£… puppet-server       yum install puppetserver -y

    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„å¹¶é‡è½½(zsh)       
        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc && source ~/.zshrc
    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„å¹¶é‡è½½(bash)      
        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bash_profile && source ~/.bshrc

    â¦¿ æŸ¥çœ‹ puppet agent ç‰ˆæœ¬   puppet agent -V

    â¦¿ â—ï¸ä¿®æ”¹å†…å­˜è¦æ±‚(æœåŠ¡ç«¯)â—ï¸    
        é»˜è®¤2Gçš„å†…å­˜. ä¸ç„¶å°±å¯åŠ¨ä¸äº†! åªèƒ½æ‰‹åŠ¨ä¿®æ”¹å†…å­˜è¦æ±‚.
        å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ”¹.ä¸€èˆ¬512m è¿˜æ˜¯è¦çš„... 256 å¥½åƒä¹Ÿèƒ½å¯åŠ¨...
        éšä¾¿ä½ æ”¹. å¯ä»¥æ˜¯256m ä¹Ÿå¯ä»¥æ˜¯1g. å»ºè®®åˆ†é…å¤šç‚¹..
        vi /etc/sysconfig/puppetserver 
            JAVA_ARGS="-Xms2g -Xmx2g"  âœ JAVA_ARGS="-Xms256m -Xmx256m"
            JAVA_ARGS="-Xms2g -Xmx2g"  âœ JAVA_ARGS="-Xms1g -Xmx1g"

    â¦¿ å¯åŠ¨puppet-server   å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ           
        sudo systemctl start puppetserver && systemctl status puppetserver
    â¦¿ å¼€æœºå¯åŠ¨
        sudo systemctl enable puppetserver

    â¦¿ 8140ç«¯å£çŠ¶æ€
        nmap -p 8140 127.0.0.1 && netstat -nlatp | grep 8140






ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ VPS2 (CentOS7_x64) puppet-agent ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ


â—ï¸â—ï¸åŸŸåè®¾ç½®.  ä¸»æœºåå­—ä¸é‡è¦! åªè¦èƒ½è§£æåˆ° æœåŠ¡å™¨çš„IPå°±è¡Œ.â—ï¸â—ï¸
æ¯”å¦‚æœåŠ¡å™¨çš„IPæ˜¯ 104.224.139.45
www.0214.live å’Œ ss.0214.live éƒ½æ˜¯æŒ‡å‘ 104.224.139.45çš„.
é‚£ä¹ˆ ä¸»æœºå. é€‰æ‹©www.0214.live æˆ–è€… ss.0214.live éƒ½å¯ä»¥.






ğŸ”¸ å…¶ä»–è®¾ç½®

    â¦¿ CentOS æ›´æ”¹ä¸»æœºå:
        hostname                                      âœ æŸ¥çœ‹å½“å‰ä¸»æœºå.
        sudo hostnamectl --static set-hostname VPS2   âœ æ°¸ä¹…æ›´æ”¹ä¸»æœºåæˆvps2

        ğŸ‘¹ Warning: Server hostname 'gce' did not match server certificate; expected one of gce.c.cloudpan-172312.internal, DNS:puppet, DNS:gce.c.cloudpan-172312.internal
        ç”¨gceçš„æœåŠ¡å™¨è¦æ³¨æ„äº†.   gce æœåŠ¡å™¨çš„ä¸»æœºå ä¸æ˜¯ hostname æŸ¥è¯¢å‡ºæ¥çš„ä¸»æœºå.
        è€Œæ˜¯ç±»ä¼¼ è¿™æ ·çš„æ ¼å¼. gce.c.cloudpan-172312.internal


        ğŸ‘¹ å¸®ç“¦å·¥ vps
        æ”¹åç›´æ¥å»æ§åˆ¶é¢æ¿æ”¹.




ğŸ”¸ å®‰è£…&é…ç½®


    â¦¿ Centos7 æ·»åŠ puppet çš„å®˜æ–¹yumæº.
        rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm

    â¦¿ å®‰è£… puppet-agent     sudo yum -y install puppet-agent

    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„(zsh)        echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.zshrc
    â¦¿ é…ç½®ç¯å¢ƒè·¯å¾„(bash)       echo 'export PATH=/opt/puppetlabs/bin:$PATH' >> ~/.bash_profile
    â¦¿ é‡æ–°åŠ è½½ zsh é…ç½®æ–‡ä»¶    source ~/.zshrc

    â¦¿ æŸ¥çœ‹ puppet agent ç‰ˆæœ¬   puppet agent -V

    â¦¿ å¼€å¯å®¢æˆ·ç«¯: 
        sudo /opt/puppetlabs/bin/puppet resource service puppet ensure=running enable=true


    â¦¿ åŸŸåè§£æ
        vi /etc/hosts 
        35.194.128.92 gce.c.cloudpan-172312.internal

    â¦¿ ç¼–è¾‘puppet-agenté…ç½®æ–‡ä»¶. 
        vi /etc/puppetlabs/puppet/puppet.conf  
        åœ¨æ·»åŠ ä¸‹é¢ä¸¤è¡Œ.

        [agent]
        server = gce.c.cloudpan-172312.internal


ğŸ”¸ puppet-agent è¿æ¥æµ‹è¯•
    puppet agent --test


    å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¿æ¥æœåŠ¡å™¨è¦å…ˆè·å¾—æœåŠ¡å™¨çš„å…è®¸åæ‰èƒ½è¿æ¥æœåŠ¡å™¨.
    è¦å»æœåŠ¡å™¨åŒæ„å…ˆ.


    å®‰è£…è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä¸»è¦éƒ½æ˜¯DNSå¯¼è‡´ã€‚
    ä¸€å¼€å§‹ ç›´æ¥ç”¨hosts æ¥é…ç½®æ˜¯æœ€ç®€ä¾¿çš„ï¼ŒæŠŠserverçš„ipæŒ‡å®šä¸ºpuppetåŸŸå

    âœ˜âœ˜âˆ™ğ’—2 ~ âœ puppet agent --test
    Info: Caching certificate_revocation_list for ca
    Info: Using configured environment 'production'
    Info: Retrieving pluginfacts
    Info: Retrieving plugin
    Info: Caching catalog for vps2.localdomain
    Info: Applying configuration version '1500102434'
    Notice: Applied catalog in 0.03 seconds













