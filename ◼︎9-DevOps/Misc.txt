â¤ï¸ git/github

ðŸ”¸ Github è·³è½¬æŠ€å·§

    æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶é‡Œçš„æŸä¸€è¡Œä»£ç å†™å¾—éžå¸¸é…·ç‚«æƒ³åˆ†äº«ä¸€ä¸‹ã€‚
    å¯ä»¥åœ¨urlåŽé¢åŠ ä¸Š #Lè¡Œå·
    æ¯”å¦‚ï¼Œç‚¹å‡»ä¸‹é¢è¿™ä¸ªurlï¼š
    https://github.com/AlloyTeam/AlloyTouch/blob/master/touch.js#L240
    ä½ ä¾¿ä¼šè·³åˆ°touch.jsçš„ç¬¬240è¡Œ. å¹¶é«˜äº®é‚£è¡Œ.
    
    https://github.com/AlloyTeam/AlloyTouch/blob/master/alloy_touch.js#L39-L45
    è·³è½¬+é«˜äº® 39-45è¡Œ!!!











â¤ï¸ï¸ å…¬å…±DNS
  å®½å¸¦å•†(ISP)ä¸æ˜¯ä¸“ä¸šçš„DNSæœåŠ¡å•†. æŠ€æœ¯æœ‰é™!è€Œä¸”ä¼šé€šè¿‡DNSåŠ«æŒæ¤å…¥å¹¿å‘Š.
  æ‰€ä»¥æœ‰å¿…è¦ç”¨ä¸“ä¸šçš„DNS.

  â¦¿ anycast æŠ€æœ¯
      Anycast èƒ½å¤Ÿè®©å¤šä¸ªä¸»æœºä½¿ç”¨ä¸€ä¸ª IP åœ°å€ï¼Œ
      å½“ç”¨æˆ·è¿žæŽ¥è¿™ä¸ª IP åœ°å€çš„æ—¶å€™ï¼Œè¿žæŽ¥åˆ°çš„åªæ˜¯è¿™å¤šä¸ªä¸»æœºä¸­çš„å…¶ä¸­ä¹‹ä¸€ï¼Œ
      é€šå¸¸ä¼šé€‰æ‹©æœ€å¿«çš„çº¿è·¯ï¼Œèƒ½æœ‰æ•ˆçš„é™ä½Žå»¶è¿Ÿ.

      DNS æœåŠ¡å™¨åªæœ‰ä¸€ä¸ªIP, ä½†æ˜¯DNSæœåŠ¡å™¨ç»å¯¹ä¸æ­¢ä¸€å°.
      anycast æŠ€æœ¯å¯ä»¥æŠŠæ•°æ®å‘é€åˆ°ä¸€ç»„ç›®æ ‡èŠ‚ç‚¹ä¸Š. é€šè¿‡è·¯ç”±åè®®é€‰æ‹©æœ€å¿«çš„èŠ‚ç‚¹ 
      anycast è®©ç”¨æˆ·è®¿é—®ç¦»è‡ªå·±æœ€è¿‘çš„ DNSæœåŠ¡å™¨ æ¥å®žçŽ°åŠ é€Ÿ.

  â¦¿ æŽ¨è DNS
      1. è°·æ­Œçš„ 8.8.8.8 
      2. é˜¿é‡Œçš„ 223.6.6.6
        ping 8.8.8.8       åªæœ‰ 3  ms çš„å»¶è¿Ÿ
        ping 223.6.6.6     åªæœ‰ 10 ms çš„å»¶è¿Ÿ
        ping www.baidu.com éƒ½æœ‰ 30 ms çš„å»¶è¿Ÿ




â¤ï¸ ä»£ç†.
         ping 23.105.192.96 190 +

  ä¸å¼€ä»£ç† ping gce 35.194.128.92 å»¶è¿Ÿ 170 +
  å¼€äº†ä»£ç† ping gce 35.194.128.92 å»¶è¿Ÿ 240 +
  ä¼°è®¡æ˜¯å¼€äº†ä»£ç†åŽ. é€šè¿‡ä»£ç† è¿žæŽ¥çš„ gce æ‰€ä»¥å˜æ…¢äº†.


  å›½å†…ä¸åŒåœ°æ–¹ ping gce å·®åˆ«å¾ˆå¤§ æœ‰çš„ å‡ åæ¯«ç§’ æœ‰çš„ å‡ ç™¾æ¯«ç§’..





â¤ï¸ CDN
  ç½‘ç«™æœåŠ¡å™¨æ˜¯GCEçš„ 35.194.128.92 
  ä½†æ˜¯ping 35.194.128.92 è¿˜æ˜¯æœ‰240+ msçš„å»¶è¿Ÿ

  å…¶å®žå¯ä»¥ç”¨è°·æ­Œçš„ Google Cloud CDN å®žçŽ°åŠ é€Ÿ.
  æ­¤åŠŸèƒ½å°±ç›¸å½“äºŽä¸€ä¸ª HTTP(S) çš„åå‘ä»£ç†ï¼Œ
  æ‰€ä»¥åªèƒ½é’ˆå¯¹ HTTP/HTTPS è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚

  æ²¡æœ‰ä½¿ç”¨CDNä¹‹å‰ æ‹“æ‰‘:
  ç”¨æˆ· -- è¾¹ç¼˜æœåŠ¡å™¨ -- å®žä¾‹



  Google äº‘ç«¯ CDN åˆ©ç”¨ Google éå¸ƒå…¨çƒçš„è¾¹ç¼˜ç‚¹ï¼Œåœ¨è·æ‚¨çš„ç”¨æˆ·æ›´è¿‘çš„ä½ç½®ç¼“å­˜ HTTP(S) å†…å®¹ï¼Œä»¥æé«˜å†…å®¹ä¼ é€é€Ÿåº¦å¹¶é™ä½Žå†…å®¹æä¾›æˆæœ¬ã€‚è¦å¼€å§‹ä½¿ç”¨ï¼Œè¯·ç‚¹å‡»â€œæ·»åŠ æ¥æºâ€ã€‚
  è°·æ­ŒæœåŠ¡å™¨ æœ‰å¾ˆå¤šèŠ‚ç‚¹å¯ä»¥é€‰æ‹©.
  å¦‚ç¾Žå›½ æ—¥æœ¬ å°æ¹¾.
  ä¸­å›½ç”¨æˆ·å½“ç„¶è®¿é—®å°æ¹¾çš„æœ€å¿«äº†.
  ä½†æ˜¯ç¾Žå›½ç”¨æˆ· è‚¯å®šæ˜¯è®¿é—®ç¾Žå›½èŠ‚ç‚¹æœ€å¿«äº†.
  ç”±äºŽæˆ‘ä»¬æœåŠ¡å™¨æ˜¯å»ºç«‹åœ¨ å°æ¹¾çš„. æ‰€ä»¥ç¾Žå›½äººè®¿é—®å°±æ…¢äº†.
  è§£å†³åŠžæ³•æ˜¯ åœ¨ç¾Žå›½ä¹Ÿå»ºè®®ä¸€ä¸ªæœåŠ¡å™¨. ä¹Ÿæ­å»ºç½‘é¡µ.
  ç„¶åŽç”¨ è°·æ­Œ çš„äº‘ç«¯CDN åŠŸèƒ½å®žçŽ°ç¾Žå›½ç”¨æˆ·è®¿é—®ç¾Žå›½çš„æœåŠ¡å™¨.
  ä¸­å›½ç”¨æˆ·è®¿é—®å°æ¹¾çš„æœåŠ¡å™¨.






â¤ï¸ ç›‘æŽ§ stackdriver













ç½‘ç»œ âžœ äº‘ç«¯CDN













â¤ï¸ gitlab
github éƒ½æ˜¯å…¬å¼€çš„.  å¦‚æžœè¦ä¸å…¬å¼€å°±è¦æ”¶è´¹.
ä½ å¯ä»¥è‡ªå·±æ­å»º gitlab æœåŠ¡å™¨. å®žçŽ°æ¯”github æ›´åŠ å¼ºå¤§çš„åŠŸèƒ½.




































# This script is used to download some images and packaged kubernetes used

KUBEVERSION=$1

images=(kube-proxy-amd64:$KUBEVERSION kube-discovery-amd64:1.0 kubedns-amd64:1.7 kube-scheduler-amd64:$KUBEVERSION kube-controller-manager-amd64:$KUBEVERSION kube-apiserver-amd64:$KUBEVERSION etcd-amd64:3.0.14-kubeadm kube-dnsmasq-amd64:1.3 exechealthz-amd64:1.1 pause-amd64:3.0 kubernetes-dashboard-amd64:v1.5.0)

echo -e "\033[33mclean old files!\033[0m"
rm -rf ~/kube_images > /dev/null 2>&1
rm -f ~/kube_images-$KUBEVERSION.tar.gz > /dev/null 2>&1

echo -e "\033[32mcreate download directory...\033[0m"
mkdir ~/kube_images

for imageName in ${images[@]} ; do
  echo -e "\033[32mpull image: $imageName...\033[0m"
  docker pull gcr.io/google_containers/$imageName
  if [ ! "$?"=="0" ]; then
    echo -e "\033[31merror: pull image: $imageName failed!\033[0m"
    exit 1
  fi
  echo -e "\033[32msave image: $imageName...\033[0m"
  docker save gcr.io/google_containers/$imageName > ~/kube_images/$imageName.tar

  if [ -f ~/kube_images/$imageName.tar ]; then
    echo -e "\033[32mdownload $imageName image success!\033[0m"
  else
    echo -e "\033[31mdownload $imageName image failed!\033[0m"
    exit 1
  fi
done

echo -e "\033[32mcreate images package...\033[0m"
(cd ~/kube_images && tar -zcvf ~/kube_images-$KUBEVERSION.tar.gz *.tar)

if [ -f ~/kube_images-$KUBEVERSION.tar.gz ]; then
  echo -e "\033[32mcreate images package success!\033[0m"
  echo -e "\033[32mclean temp files...\033[0m"
  rm -rf ~/kube_images
else
  echo -e "\033[31merror: create images package failed!\033[0m"
  exit 1
fi





for imageName in `docker images | grep -v "REPOSITORY" | awk '{print $1":"$2}'`;do docker save $imageName > `echo $imageName | tr '/' '_' | tr ':' '_'`.tar ; done





cd /data/repo/centos/7/ && ls | xargs -i createrepo --update {}





KUBE_API_SERVER=$1
CERT_DIR=${CERT_DIR-"."}

kubectl config set-cluster default-cluster --server=${KUBE_API_SERVER} \
    --certificate-authority=${CERT_DIR}/ca.pem 

kubectl config set-credentials default-admin \
    --certificate-authority=${CERT_DIR}/ca.pem \
    --client-key=${CERT_DIR}/apiserver-key.pem \
    --client-certificate=${CERT_DIR}/apiserver.pem      

kubectl config set-context default-system --cluster=default-cluster --user=default-admin
kubectl config use-context default-system




#!/bin/bash
yum update -y
yum install tmux wget lrzsz vim net-tools zsh bind-utils yum-utils ctags git -y
sh -c "$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)"





# This script is use to automatically configure Conoha LAN IP
# reference https://www.conoha.jp/conoben/archives/10174

IPADDR=$1

if [ "$IPADDR" == "" ]; then
  echo -e "\033[33merror: ip address is blank\033[0m"
  echo -e "\033[32muse ./init_private_neiwork.sh IPADDRESS NETMASK [ETH_BUMBER] [MAC_ADDRESS]\033[0m"
  exit 1
fi

NETMASK=$2

if [ "$NETMASK" == "" ]; then
  echo -e "\033[33merror: netmask is blank\033[0m"
  echo -e "\033[32muse ./init_private_neiwork.sh IPADDRESS NETMASK [ETH_BUMBER] [MAC_ADDRESS]\033[0m"
  exit 1
fi

ETH_BUMBER=$3

if [ "$ETH_BUMBER" == "" ]; then
  ETH_BUMBER="eth1"
fi

MAC_ADDRESS=$4

if [ "$MAC_ADDRESS" == "" ]; then
  yum update -y >> /dev/null 2>&1 && yum upgrade -y >> /dev/null 2>&1 && yum install net-tools >> /dev/null 2>&1
  MAC_ADDRESS=`ifconfig "$ETH_BUMBER" | grep ether | awk -F" " '{print $2}'`
  if [ "$MAC_ADDRESS" == "" ]; then
    echo -e "\033[33mget MAC_ADDRESS"
    echo -e "\033[33mget MAC_ADDRESS failed! please input MAC_ADDRESS!"
    exit 1
  fi
fi

echo -e "\033[32mupdate /etc/sysconfig/network-scripts/ifcfg-$ETH_BUMBER...\033[0m"
echo ""

# setting network
tee /etc/sysconfig/network-scripts/ifcfg-$ETH_BUMBER <<EOF
DEVICE=$ETH_BUMBER
TYPE=Ethernet
HWADDR=$MAC_ADDRESS
ONBOOT=yes
NM_CONTROLLED=no
BOOTPROTO=static
IPADDR=$IPADDR
NETMASK=$NETMASK
EOF

echo ""
echo -e "\033[32mupdate  /etc/iproute2/rt_tables...\033[0m"
echo ""

tee /etc/iproute2/rt_tables <<EOF
201     gate1
EOF

echo ""
echo -e "\033[32mupdate  /etc/sysconfig/network-scripts/rule-$ETH_BUMBER...\033[0m"
echo ""

tee /etc/sysconfig/network-scripts/rule-$ETH_BUMBER <<EOF
from $IPADDR table gate1
EOF

echo ""
echo -e "\033[32mupdate  /etc/sysconfig/network-scripts/route-$ETH_BUMBER...\033[0m"
echo ""

tee /etc/sysconfig/network-scripts/route-$ETH_BUMBER <<EOF
default via $IPADDR table gate1
EOF

echo ""
echo -e "\033[32mrestart network...\033[0m"

systemctl restart network





tee /etc/yum.repos.d/docker.repo <<-'EOF'
[dockerrepo]
name=Docker Repository
baseurl=https://yum.dockerproject.org/repo/main/centos/7/
enabled=1
gpgcheck=1
gpgkey=https://yum.dockerproject.org/gpg
EOF

yum install docker-engine -y

systemctl enable docker
systemctl start docker
systemctl status docker





curl -L "https://github.com/docker/compose/releases/download/1.8.1/docker-compose-$(uname -s)-$(uname -m)" > /usr/local/bin/docker-compose

chmod +x /usr/local/bin/docker-compose

echo "alias dc='docker-compose'" >> ~/.zshrc





tee /usr/local/bin/proxy <<EOF
#!/bin/bash
http_proxy=http://192.168.1.21:8123 https_proxy=http://192.168.1.21:8123 \$*
EOF

chmod +x /usr/local/bin/proxy





#nc -x192.168.1.21:1083 -X5 \$*
connect-proxy -S 192.168.1.21:1083 $*
EOF

chmod +x /usr/local/bin/proxy-wrapper

tee ~/.ssh/config <<EOF
Host github github.com mritd.me
#Hostname github.com
#User git
ProxyCommand /usr/local/bin/proxy-wrapper '%h %p'
EOF


# import key
rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org

# install elrepo repo
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm

# install kernel
yum --enablerepo=elrepo-kernel install kernel-lt kernel-lt-headers kernel-lt-devel -y

# modify grub
grub2-set-default 0












set -e

RPM_DIR=$1

if [ "$RPM_DIR" == "" ];then
    echo -e "\033[31mError: RPM_DIR is blank!\033[0m"
    exit 1
fi
#yum install rpm-sign -y 

# clean old files
#rm -f /data/repo/centos/7/x86_64/{kubelet*,kubeadm*,kubernetes-cni*,kubectl*}

# signature rpms
echo %_signature gpg > ~/.rpmmacros
echo "%_gpg_name mritd (mritd rpm repository)" >> ~/.rpmmacros

for rpmName in `ls ${RPM_DIR}/*.rpm`; do
  rpm --addsign $rpmName
  cp -f $rpmName /data/repo/centos/7/x86_64
done

# create repodata
`pwd`/flush_repo.sh

# sync cdn
`pwd`/syncrpm.sh






FORCEPUSH=$1

# clean old files
upx rm centos/7/x86_64/\*
upx rm centos/7/x86_64/repodata/\*

# waiting cdn clean cache
echo "Wating cdn sync:"
if ! [ "$FORCEPUSH" == "-f" ];then
    for i in `seq -w 120 -1 1`;do
        echo -ne "\033[1;31;32m\b\b\b$i\033[0m";
        sleep 1;
    done
fi

# sync rpm
cd /data/repo/centos/7/x86_64/ && for rpmName in `ls *.rpm`;do upx put $rpmName centos/7/x86_64/;done
cd /data/repo/centos/7/x86_64/repodata/ && for repodata in `ls`;do upx put $repodata centos/7/x86_64/repodata/;done






VERSION=$1
VERSION2=$2

function version_gt() { test "$(echo "$@" | tr " " "\n" | sort -V | head -n 1)" != "$1"; }
function version_le() { test "$(echo "$@" | tr " " "\n" | sort -V | head -n 1)" == "$1"; }
function version_lt() { test "$(echo "$@" | tr " " "\n" | sort -rV | head -n 1)" != "$1"; }
function version_ge() { test "$(echo "$@" | tr " " "\n" | sort -rV | head -n 1)" == "$1"; }

if version_gt $VERSION $VERSION2; then
   echo "$VERSION is greater than $VERSION2"
fi

if version_le $VERSION $VERSION2; then
   echo "$VERSION is less than or equal to $VERSION2"
fi

if version_lt $VERSION $VERSION2; then
   echo "$VERSION is less than $VERSION2"
fi

if version_ge $VERSION $VERSION2; then
   echo "$VERSION is greater than or equal to $VERSION2"
fi





