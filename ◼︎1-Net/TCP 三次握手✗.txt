@: TCP 三次握手

客户端A要与B建立连接，TCP握手的过程是这样的：
A：你好，B。我是A。发送序列号（SYN）是5。 B：你好，A。我是B，确认序列号（ACK）是5，发送序列号（SYN）是3。 A：你好，B。我是A，确认序列号（ACK）是3，发送序列号（SYN）是6。我要请求example.net。 B：你好，A。我是B，确认序列号（ACK）是6.发送序列号（SYN）是4。下面是你请求的结果：……
然后，A和B之间就可以相互通信了。对A或者B而言，每发送一个byte，序列号都会相应地增加。这样就可以跟踪是否所有的数据都被对方接收，保证可靠的传输。





比如要发一个视频.
先把视频 分成很多是 数据包.

然后同时发送几个数据包. 
> 这里不是先发第一个数据包.等对方回复收到第一个数据包再发第二个数据包.. 这样效率太低了. 其实是同时发好多个数据包.然后某个数据包没收到 再重发那个数据包就可以了.






其实是同时发很多文字过去. 给每个文字都一个识别编号.
这样每个字都可以被单独的确认.
这样就可以 同时发送多条信息了.





TCP 是靠三次交互完成建立的.
四次交互来断开一个连接.
为什么是 三次握手. 四次挥手呢.



TCP 其实是一个API. 
里面有很多个 函数 组成.
比如
connect()  建立连接函数.
close()    关闭连接函数



listen 监听函数
write  传送数据
read 读取数据函数









## 问题排查

比如邮件无法发送.
有可能是邮件服务器死机,
有可能是邮件服务器 没有运行 mail 服务,
或者服务器和客户端之间 网络断开了.

也可能是复杂问题:
DNS问题... 等等.





处理方法:

网络问题 一般都可以通过抓包来处理.

1. 先看服务器程序是否在运行.
2. 本地电脑 能正常连网.
3. ping 服务器正常
有些服务器ping不同 但是能用.说明服务器的防火墙拦截了 icmp信息.
所以ping不通 不一定表示连接有问题.
防火墙.可能是一个专用的防火墙. 或者是路由器上的防火墙.或者是电脑自到的防火墙.



如果是 防火墙拦截了. 你抓包软件中是可以看出来的.

如果 SYN 收到 RST 回复. 那就是 防火墙拦截了断开.
SYN 没任何响应 或者是程序没有运行. 或者是防火墙拦截了某端口.

永远记住 是否有NAT. 端口转发. .. 这些会中断tcp的正常操作.






tcp 最重要的机制之一 就是 滑动窗口机制.





## http 抓包实战

网页性能变差:

看网络负载.
诊断 tcp , 没有太多的重传. 
DNS 问题.
