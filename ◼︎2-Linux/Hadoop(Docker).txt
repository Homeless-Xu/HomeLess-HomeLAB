â¤ï¸ Hadoop ç¯å¢ƒæ­å»º

      å­¦ä¹ hadoop. éœ€è¦ä¸€ä¸ªæœ€åŸºæœ¬çš„ hadoop ç¯å¢ƒ: ä¸€å° master ä¸¤å° slave
          ä¸‰å°ç”µè„‘å¯ä»¥ç”¨å®ä½“æœº. ä¹Ÿå¯ä»¥ç”¨è™šæ‹Ÿæœº(vmware / vbox / Docker)
          æˆ‘ä»¬åªæœ‰ä¸€å°ç¬”è®°æœ¬.æ‰€ä»¥é€‰æ‹©docker.  vm/vb è·‘ä¸‰ä¸ªè™šæ‹Ÿæœºå®åœ¨å¤ªå¡äº†. 
          Mac åŸç”Ÿæ˜¯ä¸æ”¯æŒdockerçš„. è™½ç„¶Docker å®˜æ–¹ä¹Ÿæä¾›Mac çš„å®‰è£…åŒ…,ä½†æ˜¯ä¸å¥½ç”¨.
          å¼ºçƒˆå»ºè®®åœ¨ Ubuntu/Debian/CentOS/Kali è¿™æ ·çš„Linuxå¹³å°è¿è¡Œ Docker
          Linux å†…æ ¸ç‰ˆæœ¬å¿…é¡»æ˜¯ 2.6ä»¥ä¸Šçš„. æ¨èCentOS 7+

        æˆ‘ä»¬åœ¨Macä¸Šæ­å»º. CentOS7 çš„è™šæ‹Ÿæœº.
        åœ¨Centos7 ä¸Šæ­å»ºDockerç¯å¢ƒ.
        åœ¨Docker ä¸­ æ­å»ºä¸¤ä¸ªcentos slave è™šæ‹Ÿæœº
        ç°åœ¨æˆ‘ä»¬å°±æœ‰ä¸‰ä¸ªcentosäº†; ä¸€ä¸ª vmå‡ºæ¥çš„centos; ä¸¤ä¸ª docker å‡ºæ¥çš„ centos..



â¤ï¸ CentOS7 è™šæ‹Ÿæœºç½‘ç»œé…ç½® 
      è™šæ‹Ÿæœºå®‰è£…çš„æ—¶å€™é€‰æ‹©å¸¦ç•Œé¢çš„GUIæ¨¡å¼!!! ä¸è¦é€‰æœ€å°åŒ–.CLIæ¨¡å¼æ€•ä½ ç½‘ç»œéƒ½é…ç½®ä¸å¥½.

      ğŸ”¸ è®¾ç½®å›ºå®šIP ç„¶åé‡å¯æœåŠ¡.
           service network restart âœ  é‡å¯ç½‘ç»œæœåŠ¡æ¥ç”Ÿæ•ˆ 

      ğŸ”¸ æŸ¥çœ‹sshè¿œç¨‹è®¾ç½®(é»˜è®¤è‡ªå¸¦sshæœåŠ¡,å¹¶ä¸”å¼€å¯çš„)!!! 
            service sshd status                  âœ  æ­£å¸¸åº”è¯¥æ˜¯è¿è¡Œçš„.
            service listening on 0.0.0.0 port 22 âœ  è¯´æ˜ CentOS æ˜¯å…è®¸æ‰€æœ‰ç”µè„‘è¿›è¡Œè¿œç¨‹çš„.

      ğŸ”¸ å…å¯†ç SSHç™»å½•è®¾ç½®
            å®¢æˆ·ç«¯: ğŸ”… cd /Users/v/.ssh/
                // Macçš„å…¬é’¥æ˜¯åœ¨è¿™ä¸ªä½ç½®çš„.
            æœåŠ¡å™¨: ğŸ”… mkdir ~/.ssh
                // æ–‡ä»¶æ˜¯ä¼ åˆ° æœåŠ¡å™¨å¯¹åº”ç”¨æˆ·çš„.sshç›®å½•ä¸‹çš„. å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹.ä½ å¾—è‡ªå·±å»ºç«‹.
            å®¢æˆ·ç«¯: ğŸ”… scp -r id_rsa.pub root@192.168.169.111:~/.ssh/   
                // scp è¿™é‡Œæœ‰å¯èƒ½è¿ä¸æ˜¯è™šæ‹Ÿæœº. 
                // ssh è®¤è¯æ˜¯åŒå‘çš„. 
                // ä½ è¿è¿‡å“ªäº›æœåŠ¡å™¨çš„IP. æœ¬åœ°æŠŠæœåŠ¡å™¨çš„å…¬é’¥ä¹Ÿä¿å­˜ä¸‹æ¥çš„!!
                // ä¸€æ—¦ä½ æœåŠ¡å™¨é‡è£…ç³»ç»Ÿ. ä¹Ÿå°±æ„å‘³ç€æœåŠ¡å™¨çš„å…¬é’¥å˜äº†.
                // ä¸€æ—¦ä½ åœ¨æœ¬åœ°ç”¨åŒæ ·çš„ipè¿é‡è£…ç³»ç»Ÿçš„æœåŠ¡å™¨.å°±ä¼šå¯¼è‡´æœåŠ¡å™¨çš„å…¬é’¥å’Œæœ¬åœ°ä¹‹å‰å­˜çš„æœåŠ¡å™¨å…¬é’¥ä¸ä¸€è‡´.
                // è¿™äº›è®°å½•åœ¨ /Users/v/.ssh/ çš„ known_hostsæ–‡ä»¶ä¸­.
                // å¦‚æœæŸæœåŠ¡å™¨ç™»å½•ä¸äº†. å¯ä»¥è¯•ç€åœ¨è¿™æ–‡ä»¶é‡Œé¢åˆ é™¤å¯¹åº”çš„æœåŠ¡å™¨å…¬é’¥.
            æœåŠ¡å™¨: ğŸ”… cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

      ğŸ”¸ è™šæ‹Ÿæœºè®¾ç½®å¿«ç…§æ¥å¤‡ä»½
          é€‰æ‹©è™šæ‹Ÿæœº âœ  å³é”® âœ  snapshot âœ  take ..


â¤ï¸ï¸ ï¸å®¹å™¨å›ºå®šIPè®¾ç½®
    ğŸ“ŒğŸ“Œ IPè®¾ç½®å¦‚æœçœ‹ä¸æ‡‚. åŠ¡å¿…å…ˆçœ‹ docker.txt é‡Œé¢æœ‰è¯¦ç»†æ•™æ€ä¹ˆç»™å®¹å™¨è®¾ç½®å›ºå®šIP.

    ğŸ”¸ brctl addbr xujian                       æ·»åŠ ä¸€ä¸ªç½‘æ¡¥(è™šæ‹Ÿç½‘å¡):xujian
    ğŸ”¸ ip addr add 192.168.1.1/24 dev xujian    ç»™è¿™ä¸ªç½‘å¡è®¾ç½®ç½‘æ®µ:  
    ğŸ”¸ ip link set dev xujian up                å¼€å¯è¿™ä¸ªç½‘å¡:  
    ğŸ”¸ systemctl stop  docker.service           åœæ­¢dockeræœåŠ¡                       

    ğŸ”¸ vim /etc/sysconfig/docker         
            ç¼–è¾‘docker é…ç½®æ–‡ä»¶ ç›®çš„å°±æ˜¯æŠŠè™šæ‹Ÿçš„æ¡¥æ¥å£ç”±é»˜è®¤çš„docker0æ”¹ä¸ºbridge0
            å°†   OPTIONS='--selinux-enabled --log-driver=journald'
            æ”¹ä¸º OPTIONS='--selinux-enabled --log-driver=journald -b=xujian'

    ğŸ”¸ systemctl start  docker.service    å¼€å¯dockeræœåŠ¡ 

    ğŸ”¸ docker run -itd --name=Master --net=none centos7ifconfig /bin/bash   ç”¨--net=none æ¨¡å¼æ–°å»ºä¸€ä¸ªå«Masterå®¹å™¨. 
    ğŸ”¸ docker run -itd --name=Slave1 --net=none centos7ifconfig /bin/bash   ç”¨--net=none æ¨¡å¼æ–°å»ºä¸€ä¸ªå«Slave1å®¹å™¨. 
    ğŸ”¸ docker run -itd --name=Slave2 --net=none centos7ifconfig /bin/bash   ç”¨--net=none æ¨¡å¼æ–°å»ºä¸€ä¸ªå«Slave2å®¹å™¨. 

    ğŸ”¸ pipework xujian -i eth0 Master 192.168.1.10/24@192.168.1.1           ç»™Masterå®¹å™¨ ä¸€ä¸ªå›ºå®šIP
    ğŸ”¸ pipework xujian -i eth0 Slave1 192.168.1.11/24@192.168.1.1           ç»™Slave1å®¹å™¨ ä¸€ä¸ªå›ºå®šIP
    ğŸ”¸ pipework xujian -i eth0 Slave2 192.168.1.12/24@192.168.1.1           ç»™Slave2å®¹å™¨ ä¸€ä¸ªå›ºå®šIP

    ğŸ”¸ docker attach Master  è¿›å…¥å®¹å™¨ç”¨ifconfig æŸ¥çœ‹IPæ˜¯å¦ç”Ÿæ•ˆ. å¹¶pingå¤–ç½‘è¯•è¯•èƒ½ä¸èƒ½ä¸Šç½‘.
    ğŸ”¸ docker attach Slvae1  è¿›å…¥å®¹å™¨ç”¨ifconfig æŸ¥çœ‹IPæ˜¯å¦ç”Ÿæ•ˆ. å¹¶pingå¤–ç½‘è¯•è¯•èƒ½ä¸èƒ½ä¸Šç½‘.
    ğŸ”¸ docker attach Slave2  è¿›å…¥å®¹å™¨ç”¨ifconfig æŸ¥çœ‹IPæ˜¯å¦ç”Ÿæ•ˆ. å¹¶pingå¤–ç½‘è¯•è¯•èƒ½ä¸èƒ½ä¸Šç½‘.





â¤ï¸ hadoop
å‚è€ƒ http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/

ğŸ”µ Hadoop Dockeré•œåƒ
ä½ å½“ç„¶å¯ä»¥ç”¨ centos çš„dockeré•œåƒ.ç„¶ååœ¨é‡Œé¢å®‰è£… hadoop...
å®‰è£…hadoop åˆéœ€è¦ä¸€å¤§å †çš„ä¾èµ–è½¯ä»¶. åæ­£å°±æ˜¯éº»çƒ¦.
æˆ‘ä»¬é‡ç‚¹æ˜¯å­¦ä¹  hadoop. æš‚æ—¶ä¸èŠ±ç²¾åŠ›å»æ­å»ºhadoop.
ç”¨ hadoopçš„docker é•œåƒå¯ä»¥å¿«é€Ÿåœ°åœ¨å•ä¸ªæœºå™¨ä¸Šæ­å»ºHadoopé›†ç¾¤ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æ–°æ‰‹æµ‹è¯•å’Œå­¦ä¹ ã€‚


Hadoop çš„é•œåƒä¸å°!!!!
ubuntu å°±130MB. åŠ ä¸Š vim / hadoop / ssh / JDK(java) æœ‰ 500MB ..



åŸç†:
ä¸‰ä¸ªhadoopå®¹å™¨: ä¸€ä¸ª master ä¸¤ä¸ªslave åˆ†åˆ«è¿è¡Œåœ¨ä¸‰ä¸ªä¸åŒçš„ å®¹å™¨ä¸­.

hadoop-master å®¹å™¨è¿è¡Œ: namenode å’Œ resourcemanager
hadoop-slave å®¹å™¨è¿è¡Œ: datanode å’Œ nodemanager
namenode å’Œ datanode æ˜¯ hadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ç»„ä»¶. è´Ÿè´£å­˜å–æ•°æ®.
resourcemanager å’Œ nodemanager æ˜¯hadoopé›†ç¾¤èµ„æºç®¡ç†ç³»ç»Ÿ. è´Ÿè´£cpu/å†…å­˜èµ„æºçš„è°ƒåº¦.


åˆ›å»º hadoop å•ç‹¬çš„ç½‘ç»œ.ä¹Ÿå°±æ˜¯hadoopä¸“ç”¨ç½‘æ¡¥.
sudo docker network create --driver=bridge hadoop

ç„¶ååœ¨è¿è¡ŒHadoopå®¹å™¨æ—¶ï¼Œä½¿ç”¨â€â€“net=hadoopâ€é€‰é¡¹ï¼Œ
è¿™æ—¶æ‰€æœ‰å®¹å™¨å°†è¿è¡Œåœ¨hadoopç½‘ç»œä¸­ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡å®¹å™¨åç§°è¿›è¡Œé€šä¿¡ã€‚



ğŸ”µ æ‹‰å–é•œåƒ:

    sudo docker pull kiwenlau/hadoop:1.0

ä¸‹è½½ gitä»“åº“:
git clone https://github.com/kiwenlau/hadoop-cluster-docker

3. åˆ›å»ºHadoopç½‘ç»œ
sudo docker network create --driver=bridge hadoop


4. è¿è¡ŒDockerå®¹å™¨
cd hadoop-cluster-docker
./start-container.sh

è¿è¡Œç»“æœ
start hadoop-master container...
start hadoop-slave1 container...
start hadoop-slave2 container...
root@hadoop-master:~#

å¯åŠ¨äº†3ä¸ªå®¹å™¨ï¼Œ1ä¸ªmaster, 2ä¸ªslave
è¿è¡Œåå°±è¿›å…¥äº†hadoop-masterå®¹å™¨çš„/rootç›®å½•



5. å¯åŠ¨hadoop
./start-hadoop.sh

6. è¿è¡Œwordcount
./run-wordcount.sh

input file1.txt:
Hello Hadoop
input file2.txt:
Hello Docker
wordcount output:
Docker	1
Hadoop	1
Hello	2


Hadoopç½‘é¡µç®¡ç†åœ°å€:
NameNode: http://192.168.59.1:50070/
ResourceManager: http://192.168.59.1:8088/

192.168.59.1ä¸ºè¿è¡Œå®¹å™¨çš„ä¸»æœºçš„IPã€‚





























ğŸ”µ å®‰è£…hadoop: 
  wget http://mirrors.cnnic.cn/apache/hadoop/common/hadoop-2.7.2/hadoop-2.7.2.tar.gz
  sudo mkdir /usr/local/hadoop
  sudo tar zxf hadoop-2.7.2.tar.gz -C /usr/local/hadoop
  sudo echo "export HADOOP_HOME=/usr/local/hadoop/hadoop-2.7.2" >> /etc/bashrc
  sudo echo "export HADOOP_CONFIG_HOME=$HADOOP_HOME/etc/hadoop" >> /etc/bashrc
  sudo echo "export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin" >> /etc/bashrc
  source /etc/bashrc



ğŸ”µ é…ç½® hadoop

    é…ç½®:  https://github.com/kbyyd24/blog/issues/2





ğŸ”µ å…å¯†ç ç™»å½•

    ssh-keygen -t rsa -P "" -f ~/.ssh/id_rsa
    cd ~/.ssh
    #è·å–å®¿ä¸»æœºçš„å…¬é’¥ï¼Œæ–¹ä¾¿å®¿ä¸»æœºç™»å½•
    scp melo@172.17.0.1:~/.ssh/id_rsa.pub authorized_keys
    cat id_rsa.pub >> authorized_keys
    chmod 600 authorized_keys

    è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå› ä¸ºåé¢è¿è¡Œæ—¶ï¼Œå¦‚æœæ¯æ¬¡éƒ½ä»é•œåƒå¯åŠ¨ï¼Œé‚£éƒ½æ˜¯å…¨æ–°çš„ç¯å¢ƒï¼Œä½¿ç”¨sshç™»å½•æ—¶æ˜¯éœ€è¦ç¡®è®¤çš„ã€‚
    ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œç‰¹æ„æŸ¥äº†èµ„æ–™ï¼Œæ‰¾åˆ°è§£å†³åŠæ³•ã€‚
    æƒ³è¦è¾¾åˆ°è¿æ¥æ–°ä¸»æœºæ—¶ä¸ç”¨ç¡®è®¤çš„æ•ˆæœï¼Œ
    å°±éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„sshé…ç½®çš„StrictHostKeyCheckingã€‚è¯¥å‚æ•°é»˜è®¤ä¸ºaskï¼Œä¿®æ”¹ä¸ºno
        Host *
        StrictHostKeyChecking no
        
        http://www.worldhello.net/2010/04/08/1026.html



ğŸ”µ Docker é…ç½®

ğŸ”¸ä¿å­˜Container
docker commit -m "hadoop installed" <container id|container name> centos:hadoop


ğŸ”¸å¯åŠ¨Hadoop

  slaveéœ€è¦çŸ¥é“masteråœ¨å“ªé‡Œï¼Œæ‰èƒ½å‘masterå‘é€å¿ƒè·³å’Œæ•°æ®å—ï¼Œå¦åˆ™masterä¸Šçš„namenodeå°†æ‰¾ä¸åˆ°datanode
  å› ä¸ºå¯¹dockerçš„ç½‘ç»œé…ç½®ä¸ç†Ÿæ‚‰ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº†ä¸€ä¸ªç®€å•çš„åŠæ³•ï¼Œä¿®æ”¹/root/run.sh
  #!/bin/bash
  echo "172.17.0.4    master" >> /etc/network
  /usr/sbin/sshd -D
  å› ä¸ºèŠ‚ç‚¹åªæœ‰3ä¸ªï¼Œæˆ‘ä¹Ÿåªå¼€è¿™ä¸‰ä¸ªå®¹å™¨ï¼Œmasteråˆæ˜¯æœ€åå¯åŠ¨çš„ï¼Œæ‰€æœ‰masterçš„åœ°å€å°±æ˜¯172.17.0.4

  æ‰€ä»¥ä¸Šé¢åˆ›å»ºçš„é•œåƒå·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚



ğŸ”¸å¯åŠ¨å®¹å™¨

    $ docker run -d --name slave1 centos:hadoop /root/run.sh
    $ docker run -d --name slave2 centos:hadoop /root/run.sh
    $ docker run -d --name master -h master -P --link slave1:slave1 --link slave2:slave2 centos:hadoop /root/run.sh

    æˆ‘å°†ä»¥ä¸Šä¸‰ä¸ªå‘½ä»¤å†™åˆ°äº†ä¸€ä¸ªå¯åŠ¨è„šæœ¬é‡Œï¼Œç›´æ¥å°±å¯ä»¥å¯åŠ¨äº†ï¼Œç„¶ååœ¨ç”¨sshç™»å½•åˆ°masterä¸Šå¯åŠ¨hadoop
    å› ä¸ºä½¿ç”¨çš„æ˜¯dockerçš„é»˜è®¤ç½‘ç»œï¼Œæ‰€æœ‰å¯ä»¥ç®—å‡ºmasterçš„IPåœ°å€ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡docker netword inspect bridgeå‘½ä»¤å»è·å–


ğŸ”¸ å¯åŠ¨ Hadoop

  åˆ‡æ¢åˆ°$HADOOP_HOMEç›®å½•ï¼Œé¦–å…ˆæ ¼å¼åŒ–namenode:
  ./bin/hadoop namenode -format
  ç„¶åå°±å¯ä»¥å¯åŠ¨Hadoopäº†
  å°±å¯ä»¥ä½¿ç”¨æµè§ˆå™¨ æŸ¥çœ‹web ç®¡ç†æ¥å£!!
  è¯¦ç»†æ–‡ç« : https://github.com/kbyyd24/blog/issues/2







ğŸ”µ  NTPæ—¶é—´åŒæ­¥
        é›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºå¿…é¡»ä¿æŒæ—¶é—´åŒæ­¥ï¼Œå¦‚æœæ—¶é—´ç›¸å·®è¾ƒå¤§ä¼šå¼•èµ·å„ç§é—®é¢˜ã€‚
        å…·ä½“æ€è·¯å¦‚ä¸‹ï¼šmasterèŠ‚ç‚¹ä½œä¸ºntpæœåŠ¡å™¨ï¼Œå¯¹æ‰€æœ‰datanodeèŠ‚ç‚¹æä¾›æ—¶é—´åŒæ­¥æœåŠ¡ã€‚
        æ‰€æœ‰datanodeèŠ‚ç‚¹ä»¥masterèŠ‚ç‚¹ä¸ºåŸºç¡€åŒæ­¥æ—¶é—´
        æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ç›¸å…³ç»„ä»¶ï¼šyum install ntpã€‚
        å®Œæˆåï¼Œé…ç½®å¼€æœºå¯åŠ¨ï¼šchkconfig ntpd on,
        æ£€æŸ¥æ˜¯å¦è®¾ç½®æˆåŠŸï¼šchkconfig --list ntpdå…¶ä¸­2-5ä¸ºonçŠ¶æ€å°±ä»£è¡¨æˆåŠŸ

