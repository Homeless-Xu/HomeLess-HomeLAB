```

VPNâ€¢ WireGuardâ€¢ AIO âœ æœ€æ–° æœ€å¼º æœ€å®‰å…¨ VPNğŸ’¯ğŸ’¯ğŸ’¯

ğŸ”µ Desc 

    â¦¿ VPN é‡Œé€Ÿåº¦æœ€å¿«! 
        æ–°ä¸€ä»£ VPN.  æ”¯æŒUDP!  

    â¦¿ é…ç½®è¶…çº§ç®€å•! 
        ä¸‰æ­¥æå®š:  åŒæ–¹å®‰è£…è½¯ä»¶. æŸæ–¹ç”Ÿæˆå¯†é’¥å¯¹, æ”¹åŒæ–¹é…ç½®. æå®š!!! 
    
    â¦¿ æ”¯æŒIPæ¼«æ¸¸! 
        ä»»ä½•ä¸€ç«¯æœ‰ä¸€ä¸ªå…¬ç½‘IPå°±è¡Œ! 
        ä¸éœ€è¦å›ºå®šIP. IPå˜äº†å®Œå…¨ä¸æ–­ç½‘!


ğŸ”µ Tips 

    â—ï¸ å®¢æˆ·ç«¯ æœåŠ¡ç«¯ ç”¨çš„åŒä¸€ä¸ªå®‰è£…åŒ…!!!   åŒæ–¹åŸºæœ¬å¹³ç­‰çš„.  å°±æ˜¯è°è¿è°çš„é—®é¢˜.  â—ï¸
    â—ï¸ å®¢æˆ·ç«¯ æœåŠ¡ç«¯ ç”¨çš„åŒä¸€ä¸ªå®‰è£…åŒ…!!!   åŒæ–¹åŸºæœ¬å¹³ç­‰çš„.  å°±æ˜¯è°è¿è°çš„é—®é¢˜.  â—ï¸
    â—ï¸ å®¢æˆ·ç«¯ æœåŠ¡ç«¯ ç”¨çš„åŒä¸€ä¸ªå®‰è£…åŒ…!!!   åŒæ–¹åŸºæœ¬å¹³ç­‰çš„.  å°±æ˜¯è°è¿è°çš„é—®é¢˜.  â—ï¸

    ğŸ”¶ å¯†é’¥
        â¦¿ A è¿ B:  B ç”Ÿæˆä¸€å¯¹å¯†é’¥(å…¬é’¥+ç§é’¥)  >>  å…¬é’¥é…åˆ° Aé…ç½®é‡Œ; >> A å¯åŠ¨æœåŠ¡å°± ä¸»åŠ¨è¿B. 
        â¦¿ B è¿ A:  A ç”Ÿæˆä¸€å¯¹å¯†é’¥(å…¬é’¥+ç§é’¥)  >>  å…¬é’¥é…åˆ° Bé…ç½®é‡Œ; >> B å¯åŠ¨æœåŠ¡å°± ä¸»åŠ¨è¿A.
        â¦¿ ABäº’è¿:  AB å„è‡ªç”Ÿæˆå¯†é’¥å¯¹ >> Açš„å…¬é’¥é…åˆ°Bé‡Œé¢, Bçš„å…¬é’¥é…Aé‡Œé¢. >>  AB éƒ½å¯åŠ¨ å°±äº’è”.



ğŸ”µ è¦æ±‚
    ç®€æ˜“ç³»ç»Ÿ:  Debian8+  Ubuntu16+   centos7 ä¹Ÿå¯ä»¥.
    ç¡¬ä»¶è¦æ±‚:  é™¤äº† OpenVZ éƒ½å¯ä»¥.



ğŸ”µ è½¯ä»¶ å®‰è£… (å®¢æˆ·ç«¯ æœåŠ¡ç«¯ é€šç”¨)

    ğŸ”¶ å®‰è£…  linux-headers å†…æ ¸
        â¦¿ æ›´æ–°è½¯ä»¶åŒ…æº
            apt update

        â¦¿ å®‰è£…å’Œ linux-image å†…æ ¸ç‰ˆæœ¬ç›¸å¯¹äºçš„ linux-headers å†…æ ¸
            apt install linux-headers-$(uname -r) -y

        â¦¿ éªŒè¯ 
            dpkg -l|grep linux-headers
            æ²¡å®‰è£…å‰æ˜¯ç©ºçš„. å®‰è£…åæœ‰.


    ğŸ”¶ å®‰è£… WireGuard

        # æ·»åŠ  unstable è½¯ä»¶åŒ…æºï¼Œä»¥ç¡®ä¿å®‰è£…ç‰ˆæœ¬æ˜¯æœ€æ–°çš„
        echo "deb http://deb.debian.org/debian/ unstable main" > /etc/apt/sources.list.d/unstable.list
        echo -e 'Package: *\nPin: release a=unstable\nPin-Priority: 150' > /etc/apt/preferences.d/limit-unstable
        
        # æ›´æ–°ä¸€ä¸‹è½¯ä»¶åŒ…æº
        apt update
        
        # å¼€å§‹å®‰è£… WireGuard ï¼Œresolvconf æ˜¯ç”¨æ¥æŒ‡å®šDNSçš„ï¼Œæ—§ä¸€äº›çš„ç³»ç»Ÿå¯èƒ½æ²¡è£…ã€‚
        apt install wireguard resolvconf -y


    ğŸ”¶ WireGuard å®‰è£…éªŒè¯
 
        root@doubi:~# modprobe wireguard && lsmod | grep wireguard
        wireguard             212992  0
        ip6_udp_tunnel         16384  1 wireguard
        udp_tunnel             16384  1 wireguard

        ç¬¬ä¸€è¡Œæ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œè‡³äºä¸‹é¢çš„ä¸¤è¡Œä¸åŒç³»ç»Ÿä¼¼ä¹è¿˜ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸å½±å“ä½¿ç”¨ã€‚



ğŸ”µ é…ç½® 

ğŸ”¶ æœåŠ¡ç«¯ - ç”Ÿæˆå¯†åŒ™å¯¹
    cd /etc/wireguard
    # é¦–å…ˆè¿›å…¥é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨è¯·å…ˆæ‰‹åŠ¨åˆ›å»ºï¼šmkdir /etc/wireguard

    # ç„¶åå¼€å§‹ç”Ÿæˆ å¯†åŒ™å¯¹(å…¬åŒ™+ç§åŒ™)ã€‚
    wg genkey | tee sprivatekey | wg pubkey > spublickey
    wg genkey | tee cprivatekey | wg pubkey > cpublickey


ğŸ”¶ æœåŠ¡ç«¯ - é…ç½® 
# äº•å·å¼€å¤´çš„æ˜¯æ³¨é‡Šè¯´æ˜ï¼Œç”¨è¯¥å‘½ä»¤æ‰§è¡Œåä¼šè‡ªåŠ¨è¿‡æ»¤æ³¨é‡Šæ–‡å­—ã€‚
# ä¸‹é¢åŠ ç²—çš„è¿™ä¸€å¤§æ®µéƒ½æ˜¯ä¸€ä¸ªä»£ç ï¼è¯·æŠŠä¸‹é¢å‡ è¡Œå…¨éƒ¨å¤åˆ¶ï¼Œç„¶åç²˜è´´åˆ° SSHè½¯ä»¶ä¸­æ‰§è¡Œï¼Œä¸è¦ä¸€è¡Œä¸€è¡Œæ‰§è¡Œï¼
 
echo "[Interface]
# æœåŠ¡å™¨çš„ç§åŒ™ï¼Œå¯¹åº”å®¢æˆ·ç«¯é…ç½®ä¸­çš„å…¬åŒ™ï¼ˆè‡ªåŠ¨è¯»å–ä¸Šé¢åˆšåˆšç”Ÿæˆçš„å¯†åŒ™å†…å®¹ï¼‰
PrivateKey = $(cat /etc/wireguard/sprivatekey)

# VPN è¿ä¸Šå â—ï¸ ä¼šåœ¨æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡. è¿™ä¸ªç½‘å¡è¦ä¸€ä¸ªIPâ—ï¸
# è‡ªåŠ¨ä»ä¸‹é¢çš„ç½‘æ®µ åˆ†é…ä¸€ä¸ªå¯ç”¨çš„IP ç»™æœåŠ¡å™¨! ä¸€èˆ¬é»˜è®¤å³å¯ï¼Œé™¤éå’Œä½ æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯è®¾å¤‡æœ¬åœ°ç½‘æ®µå†²çª
Address = 10.0.0.1/24 

# è¿è¡Œ WireGuard æ—¶è¦æ‰§è¡Œçš„ iptables é˜²ç«å¢™è§„åˆ™ï¼Œç”¨äºæ‰“å¼€NATè½¬å‘ä¹‹ç±»çš„ã€‚
# å¦‚æœä½ çš„æœåŠ¡å™¨ä¸»ç½‘å¡åç§°ä¸æ˜¯ â—ï¸ eth0 ï¼Œé‚£ä¹ˆè¯·ä¿®æ”¹ä¸‹é¢é˜²ç«å¢™è§„åˆ™ä¸­æœ€åçš„ eth0 ä¸ºä½ çš„ä¸»ç½‘å¡åç§°ã€‚â—ï¸
PostUp   = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens32 -j MASQUERADE
# åœæ­¢ WireGuard æ—¶è¦æ‰§è¡Œçš„ iptables é˜²ç«å¢™è§„åˆ™ï¼Œç”¨äºå…³é—­NATè½¬å‘ä¹‹ç±»çš„ã€‚
# å¦‚æœä½ çš„æœåŠ¡å™¨ä¸»ç½‘å¡åç§°ä¸æ˜¯â—ï¸ eth0 ï¼Œé‚£ä¹ˆè¯·ä¿®æ”¹ä¸‹é¢é˜²ç«å¢™è§„åˆ™ä¸­æœ€åçš„ eth0 ä¸ºä½ çš„ä¸»ç½‘å¡åç§°ã€‚â—ï¸
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o ens32 -j MASQUERADE

# â—ï¸ æœåŠ¡ç«¯ç›‘å¬ç«¯å£ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹â—ï¸
ListenPort = 888

# æœåŠ¡ç«¯è¯·æ±‚åŸŸåè§£æ DNS 
# æœåŠ¡ç«¯ èƒ½è®¿é—® 8.8.8.8  å°±è®¾ç½®è¿™ä¸ª. é¿å…åŸŸåæ±¡æŸ“.
DNS = 8.8.8.8

# ä¿æŒé»˜è®¤
MTU = 1420



# â—ï¸ [Peer] ä»£è¡¨å®¢æˆ·ç«¯é…ç½®ï¼Œæ¯å¢åŠ ä¸€æ®µ [Peer] å°±æ˜¯å¢åŠ ä¸€ä¸ªå®¢æˆ·ç«¯è´¦å· â—ï¸
[Peer]
# è¯¥å®¢æˆ·ç«¯è´¦å·çš„å…¬åŒ™ï¼Œå¯¹åº”å®¢æˆ·ç«¯é…ç½®ä¸­çš„ç§åŒ™ï¼ˆè‡ªåŠ¨è¯»å–ä¸Šé¢åˆšåˆšç”Ÿæˆçš„å¯†åŒ™å†…å®¹ï¼‰
PublicKey = $(cat cpublickey)
# æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯è´¦å·åˆ†é…çš„å†…ç½‘IPåœ°å€
AllowedIPs = 10.0.0.2/32"|sed '/^#/d;/^\s*$/d' > wg0.conf
 
# ä¸Šé¢åŠ ç²—çš„è¿™ä¸€å¤§æ®µéƒ½æ˜¯ä¸€ä¸ªä»£ç ï¼è¯·æŠŠä¸‹é¢å‡ è¡Œå…¨éƒ¨å¤åˆ¶ï¼Œç„¶åç²˜è´´åˆ° SSHè½¯ä»¶ä¸­æ‰§è¡Œï¼Œä¸è¦ä¸€è¡Œä¸€è¡Œæ‰§è¡Œï¼
# wg0æ˜¯é…ç½®å. éšä¾¿å–. 



ğŸ”¶ å®¢æˆ·ç«¯ é…ç½®

    ğŸ”¶ æœåŠ¡ç«¯ - å®¢æˆ·ç«¯ä¿¡æ¯: bash wg5 

        [Interface]
        PrivateKey = aN6H7rIZk8FYM8046m/qgg1v6fgFSn7sQDiBS4OlzFU=
        Address = 10.0.0.186/24, fd08:620c:4df0:65eb::186/64
        DNS = 8.8.8.8, 2001:4860:4860::8888

        [Peer]
        PublicKey = 4LTTApeeKI3qrgEN+brtqKl6Tvbx19lX9mkyb2cADyM=
        Endpoint = 89.208.246.127:21388
        AllowedIPs = 0.0.0.0/0, ::0/0
        PersistentKeepalive = 25


    ğŸ”¶ å®¢æˆ·ç«¯é…ç½®.
        ä¸Šé¢å†…å®¹å†™åˆ° /etc/wireguard/client.conf:

    ğŸ”¶ å¯åŠ¨ WireGuard
        wg-quick up é…ç½®å!
        wg-quick up wg0
        wg-quick up client 

        â¦¿ åœæ­¢ WireGuard:    wg-quick down wg0
        â¦¿ WireGuard çŠ¶æ€:    wg

    ğŸ”¶ éªŒè¯.
        æŸ¥çœ‹åŒæ–¹ å†…ç½‘ip.  ç„¶å! ping è¯•è¯•! 



ğŸ”µ Demo 

ğŸ”¶ åŒæ–¹ç½‘ç»œäº’è” 
å‡è®¾å­˜åœ¨ Peer Aã€Peer Bï¼Œåœ¨å…¶ä¹‹é—´å»ºç«‹ä¸€ä¸ª Tunnelï¼š
æˆ‘ä»¬å‡å®šè¿æ¥ç«¯å£å‡ä¸º 51820ã€‚
ä»¬å‡å®šè¿æ¥ç«¯å£å‡ä¸º 51820ã€‚

Peer A Config Fileï¼š

[Interface] 
Address = 192.168.100.1/24 
PrivateKey = Peer A's PrivateKey
ListenPort = 51820
[Peer] 
Endpoint = Peer B's Address:51820 
PublicKey = Peer B's PrivateKey
AllowedIPs = 192.168.100.2/32
PresharedKey = Your PreSharedKey
Peer B Config Fileï¼š

[Interface] 
Address = 192.168.100.2/24 
PrivateKey = Peer B's PrivateKey
ListenPort = 51820
[Peer] 
Endpoint = Peer A's Address:51820 
PublicKey = Peer A's PrivateKey
AllowedIPs = 192.168.100.1/32
PresharedKey = Your PreSharedKey
åœ¨ä¸¤ç«¯æœºå™¨ä¸Šæ‰§è¡Œï¼š

$ sudo wg-quick up $CONFIGFILE






```