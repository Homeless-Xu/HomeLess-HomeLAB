@: 1986-10-01-wireshark 简介
---
layout: post
title: wireshark 简介
tags: Wireshark
categories: Tooles
---


官网 [https://www.wireshark.org/#download]


wireshark : 功能强大的 网络数据 捕获工具
可以分析网络数据流量 第一时间发现蠕虫病毒 木马程序 以及 arp 欺骗 等问题的根源






## 简单设置
默认设置: 会得到大量的无用信息 以至于很难找到自己需要的信息
 这就需要 设置 过滤规则 来减少信息量了.


## 使用步骤
1: 选择接口  (网卡)
主界面 自己双击你要的接口. 

2: 设置捕捉过滤器
默认情况下，Wireshark捕捉一切看得见的数据，这可能正是你一开始想要做的事情。但是一旦你了解了流量的类型，就可以设置捕捉过滤器，那样你仅仅捕捉发往/来自特定机器的流量，或特定的协议。




## 混杂模式

所谓混杂模式，用最简单的语言就是让网卡抓取任何经过它的数据包，不管这个数据包是不是发给它或者是它发出的

你之所以监测无线网络，最感兴趣的是想看看网络上有什么情况。这意味着需要把网卡设置成混杂模式（promiscuous mode）

混杂模式是指网卡不过滤通过它的目标地址不是它的包.
要通过混杂模式收到发给其他地址的包,首先要这些包有发到你的网卡上.



关闭:混杂模式  只捕获进入/送出你计算机的包

开启:混杂模式  捕捉 Lan 网段上的 所有包





在以太网中
会把包不区分地址转发到所有网卡的设备,叫做集线器(HUB),这是一个一层设备.

交换机(Switch),交换机是一个二层设备,它会根据包的目标地址将包只发送到对应地址的网卡,不会发送给其他网卡,混杂模式自然是抓不到的.

路由器(Router)是一个三层设备,和交换机一样会选择把数据发送到指定的网卡.

一般而言，Unix不会让普通用户设置混杂模式，因为这样可以看到别人的信息，比如telnet的用户名和密码，这样会引起一些安全上的问题，所以只有root用户可以开启混杂模式，开启混杂模式的命令是：ifconfig eth0 promisc, eth0是你要打开混杂模式的网卡。


无线网卡 开启这功能 可能会导致网络堵塞 上不了网




混杂模式：promiscuous mode
让网卡抓取任何经过它的数据包，不管这个数据包是不是发给它的.

要通过混杂模式收到发给其他地址的包,首先要这些包有发到你的网卡上


集线器 HUB 一层设备
会把包不区分地址转发到所有网卡的设备,叫做集线器(HUB),

交换机 Switch 二层设备
它会根据包的目标地址将包只发送到对应地址的网卡,不会发送给其他网卡,混杂模式自然是抓不到的.

路由器 Router 三层设备 
和交换机一样会选择把数据发送到指定的网卡.

无线网卡 开启这功能 可能会导致网络堵塞 上不了网





## 软件界面介绍

上面:   数据包列表  简单信息
中间:   协议树    详细信息
下面:  16进制 显示 数据包内容 : 数据在物理层上传输时的最终形式

no.  数据包 数量
Time 每个数据包的捕捉时间 

source:  源地址
destination:  目的地址
protocal:  所属协议
length:  数据包长度
info: 数据包简单信息
frame number:
主机 mac 地址:  ethernetII ip 地址   : internet protocol 
TCP 端口号: transmission control protocol
HTTP 协议具体内容: Hypertext transfer protocol 


右键 有追踪流 功能: 获取更详细的信息 



192.168.0.255 是广播的意思 









🔵 捕获过滤器










🔵 内容显示过滤器





ip.dst==23.105.192.96









🔸 查看图片: 
















1、Wireshark的数据包详情窗口，如果是用中括号[]括起来的，表示注释，在数据包中不占字节 


2、在二进制窗口中，如“DD 3D”，表示两个字节，一个字节8位 


3、TCP数据包中，seq表示这个包的序号，注意，这个序号不是按1递增的，而是按tcp包内数据字节长度加上，如包内数据是21字节，而当前IP1发到IP2的包的seq是10的话，那下个IP1发到IP2的包的seq就是10+21=31 


4、注意我们分析tcp包时，要以一个会话做为一个完整对象，即通讯只发生在两个IP之间，两个固定的端口之间，如果端口变化了，那链接就不是同一条了，不同的链接之间的seq是没有关联的 


5、tcp包分为包头的内容，tcp的包头长度是32字节，整个数据包的包头是66字节(不一定的)，如果整个数据包是66字节的话，那内容长度就是0 


6、每个tcp包都带有win、ack，这些是告诉对方，我还可以接收数据的滑动窗口是多少，如果A发到B的包的win为0，就是A告诉B说我现在滑动窗口为0了，饱了，你不要再发给我了，就说明A端环境有压力（如带宽满了等） 


7、ack可以理解为应答。A发给B的ack是告诉B，我已收到你发的数据包，收到ack号这里了，你下次要发seq为ack号的给我 


8、在网络不堵即滑动窗口一点都不堵的情况下，第一个包的ack号就是第二个包的seq号，如果堵了，由于是滑动窗口缓存处理队列，所以这个值会错开 


9、如果A发到B连续几个包，seq号不变，ack号一直在变大，说明A一直在收B的数据，一直在给B应答 


10、如果A发到B连续几个包，seq号一直变大，ack号一直没变，说明A一直在向B发数据，不用给B应答，而是在等B的应答 


11、可以接收多个数据包后，一次性给一个应答，不用每个数据包一一对应给应答 


12、发了一个包，很久没有收到应答后，会重发包，在Wireshark抓包工具提示“[TCP Retransmission]”，在数据包详情窗口点开可以看到是对哪个数据包的重传 


13、“[TCP Dup ACK ?#?]”应答包的重传 


14、如果出现这个错误“[TCP Previous segment not captured]”，说明乱序了，前一个包没有收到，收到后面的包了，这时也会重传包



