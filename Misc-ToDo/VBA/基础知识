ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ ADO ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶

ğŸ”µ ADO ç®€ä»‹

    ADO: ActivateX Data Objects
    å¾®è½¯å‡ºçš„ä¸œè¥¿. ç”¨äºè®¿é—® æ•°æ®æºçš„ä¸€ä¸ªç»„ä»¶.
    æ–¹ä¾¿å¼€å‘äººå‘˜è®¿é—®æ•°æ®åº“. è€Œä¸ç”¨å…³å¿ƒåº•å±‚åˆ°åº•æ˜¯å¦‚ä½•å®ç°è®¿é—®æ•°æ®åº“çš„.



ğŸ”µ  ADO å¯¹è±¡

    ğŸ”¶â—ï¸è¿æ¥ - Connection
    ğŸ”¶â—ï¸è®°å½•é›† - Recordset
    ğŸ”¶â—ï¸å‘½ä»¤ - Command
 

    ğŸ”¶ è®°å½• - Record 
    ğŸ”¶ æµ - Stream 
    ğŸ”¶ é”™è¯¯ - Error 
    ğŸ”¶ å­—æ®µ - Field 
    ğŸ”¶ å‚æ•° - Parameter 
    ğŸ”¶ å±æ€§ - Property 


ğŸ”µ ADO å¯¹è±¡ç®€ä»‹

    connection Command å’Œ Recordset æ˜¯ADO çš„æ ¸å¿ƒ.
    é€šè¿‡ Connection å’Œæ•°æ®åº“å»ºç«‹è¿æ¥.
    ç„¶å åˆ©ç”¨ command æ‰§è¡ŒæŸ¥è¯¢.ä»è€Œè¿”å›ç»“æœ.
    æœ€åæŠŠç»“æœ(è®°å½•é›†) å­˜å…¥ Recordset å¯¹è±¡.
    ç„¶åè®¿é—® Recordset å¯¹è±¡å°±å¯ä»¥è·å¾— æŸ¥åˆ°çš„å†…å®¹.




ğŸ”µ ODBC æ•°æ®æºç§ç±»

    ğŸ”¶ æ•°æ®æº( DSN ): Data Source Name 

        DSN å®šä¹‰äº†ä¸€ä¸ªç¡®å®šçš„æ•°æ®åº“è¿æ¥å¿…é¡»ç”¨åˆ°çš„é©±åŠ¨ç¨‹åº.
        é¦–å…ˆä½ è¦åˆ›å»ºä¸€ä¸ªDSN. 
        ç„¶åç»™è¿™ä¸ªæ•°æ®æº é€‰æ‹©å¯¹åº”çš„é©±åŠ¨
        ç„¶åè¿˜è¦é€‰æ‹© tnsnames.ora é‡Œé¢çš„ä¸€ä¸ªåå­—.
        ç„¶åè¾“å…¥ç”¨æˆ·åå¯†ç å°±å¯ä»¥è¿ä¸Šæ•°æ®åº“äº†.


    ğŸ”¶ ç”¨æˆ·æ•°æ®æº
        åªèƒ½è¢«å½“å‰ç”¨æˆ·ä½¿ç”¨. 
        åŒä¸€å°è®¡ç®—æœºé‡Œé¢åˆ«çš„ç”¨æˆ·æ˜¯æ— æ³•ä½¿ç”¨è¿™ä¸ª DSN çš„


    ğŸ”¶ ç³»ç»Ÿæ•°æ®æº
        æ•´ä¸ªç”µè„‘çš„æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨.

    ğŸ”¶ æ–‡ä»¶æ•°æ®æº
        åªè¦å®‰è£…äº†é©±åŠ¨å°±èƒ½ç”¨.åˆ«çš„ç”µè„‘ä¹Ÿèƒ½ç”¨...




ğŸ”µ ADO ä½¿ç”¨ åŸºæœ¬æ­¥éª¤

    1. åˆ›å»ºä¸€ä¸ªåˆ°æ•°æ®åº“çš„ ADO è¿æ¥  âœ  è¿æ¥åˆ°æ•°æ®åº“ä¸­.
    2. æ‰“å¼€æ•°æ®åº“è¿æ¥
    3. åˆ›å»º ADO è®°å½•é›†     âœ è¿™æ ·æ‰èƒ½ä¿å­˜æ•°æ®åº“ä¸­çš„æ•°æ®.
    4. ä»è®°å½•é›†æå–æ‚¨éœ€è¦çš„æ•°æ®
    5. å…³é—­è®°å½•é›†
    6. å…³é—­è¿æ¥




ğŸ”µ ADO ç»„ä»¶ä½¿ç”¨æ–¹æ³• âœ”


    ğŸ”¶ åˆ›å»ºæ³•: - æ— éœ€å¼•å…¥åº“ (æ¨è!!!)

        Set cnn = CreateObject("ADODB.Connection")  
        Set rst = CreateObject("ADODB.Recordset")  


    ğŸ”¶ å¼•ç”¨æ³•: - éœ€è¦å¼•å…¥åº“

        å¼•ç”¨ADOç›¸å…³ç»„ä»¶ï¼šå¿…é¡»å…ˆå¼•ç”¨ ADO ç›¸å…³çš„åº“.
        æ‰“å¼€VBAç¼–è¾‘å™¨ï¼Œåœ¨èœå•ä¸­ç‚¹é€‰â€œå·¥å…·â€--ã€‹â€œå¼•ç”¨â€ã€‚
        ç¡®ä¿â€œMicrosoft ActiviteX Data Objects 2.8 Libraryâ€
        å’Œâ€œMicrosoft ActiviteX Data ObjectS Recordset 2.8 Libraryâ€è¢«å‹¾é€‰ä¸Šã€‚
        
        å¼•ç”¨åæ‰èƒ½åœ¨ä»£ç é‡Œé¢å£°æ˜: 

            Dim cnn As New Connection  'å£°æ˜é“¾æ¥å¯¹è±¡
            Dim rst As New Recordset    'å£°æ˜è®°å½•é›†å¯¹è±¡




ğŸ”µ Connection è¯­æ³• 


Excel 2007ä¹‹å‰ç‰ˆæœ¬å’Œä¹‹åç‰ˆConnectionä¸ä¸€æ ·
Excel 2007ä¹‹åç‰ˆæœ¬
cnn.Oen "provider=Microsoft.ACE.OLEDB.12.0;extended properties=excel 12.0;data source=D:\tmp.xlsx"





ğŸ”µ Provider

    VBA å…¥é—¨ä¸»è¦æ˜¯è¿æ¥æ•°æ®æº(æ•°æ®åº“)é—®é¢˜. 
    æ•°æ®æºåˆ†å¥½å¤šç§. Excel æ•°æ®æº, Access æ•°æ®æº, MySQL æ•°æ®æº. Oracle æ•°æ®æº...

    64ä½çš„OFFICE 2016å·²ç¶“ä¸æ”¯æ´å¤è€çš„Jetè³‡æ–™åº«å¼•æ“....


    ğŸ”¶ Excel æ•°æ®æº

        Dim sConstr  As String
        'åœ¨32ä½å¹³å°ä¸‹å¯ä»¥ç”¨çš„è¿æ¥å­—ç¬¦ä¸²
        sConstr = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\MyExcel.xls;Extended Properties=Excel 8.0;HDR=Yes;IMEX=1"


        Dim sConstr  As String
        'åœ¨64ä½å¹³å°ä¸‹å¯ä»¥ç”¨çš„è¿æ¥å­—ç¬¦ä¸²
        sConstr = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\myExcelFile.xls;Extended Properties=Excel 8.0;HDR=YES"
        åœ¨OFFICE 2007å¼€å§‹ï¼Œå¾®è½¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è¿æ¥ç¨‹åºï¼ŒOffice 2007 OLEDB driver




    ğŸ”¶ Access æ•°æ®æº


        Dim sConstr  As String
        '32ä½ä¸‹ç”¨çš„è¿æ¥å­—ç¬¦ä¸²
        sConstr = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\mydatabase.mdb"


        Dim sConstr  As String
        '64ä½ä¸‹ç”¨çš„è¿æ¥å­—ç¬¦ä¸²
        sConstr = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=C:\myAccessFile.accdb"





On Error Resume Next

Const adOpenStatic = 3
Const adLockOptimistic = 3
Const adCmdText = &H0001

Set objConnection = CreateObject("ADODB.Connection")
Set objRecordSet = CreateObject("ADODB.Recordset")

objConnection.Open "Provider=Microsoft.Jet.OLEDB.4.0;" & _
    "Data Source=C:\Scripts\Test.xls;" & _
        "Extended Properties=""Excel 8.0;HDR=Yes;"";" 

objRecordset.Open "Select * FROM [Sheet1$]", _
    objConnection, adOpenStatic, adLockOptimistic, adCmdText

Do Until objRecordset.EOF
    Wscript.Echo objRecordset.Fields.Item("Name"), _
        objRecordset.Fields.Item("Number")
    objRecordset.MoveNext
Loop






Public Sub GenInFolder()
    Dim cnn As Object, cat As Object, d As Object
    Dim SQL$, MyFile$, arr(), i&, j&, t$, s$, wk$, m&, n&
    Application.ScreenUpdating = False
    
    Set cnn = CreateObject("adodb.connection")
    cnn.Open "provider=Microsoft.ACE.OLEDB.12.0;extended properties='excel 12.0;hdr=no';data source=D:\tmp.xlsx"
    SQL = "select f1,sum(f2) from [Sheet1$a2:b65536] group by f1"
    Sheet1.[a1].CopyFromRecordset cnn.Execute(SQL)
   
    cnn.Close
    Set cnn = Nothing
    Application.ScreenUpdating = True
End Sub
å¤åˆ¶ä»£ç 








Sub OracleLocalConnect()
  Dim RecordSet As New ADODB.RecordSet
  Dim con As New ADODB.Connection
  Dim ExcelRange As Range
  Dim SQLStr As String
  
  Dim ws As Worksheet

  con.ConnectionString = "Provider=OraOLEDB.Oracle;" & _
  "Data Source=(DESCRIPTION=(CID=GTU_APP)(ADDRESS_LIST=" & _
  "(ADDRESS=(PROTOCOL=TCP)(HOST=LocalHost)(PORT=1521)))" & _
  "(CONNECT_DATA=(SERVICE_NAME=XE)(SERVER=DEDICATED)));" & _
  "User Id=System;Password=oracle;"
  
  con.Open
  Set RecordSet = CreateObject("ADODB.Recordset")

  SQLStr = "SELECT 'Retrieved' Status, per.person_id, per.person_type, per.title, per.first_name, per.last_name " & _
  "FROM  persons  per "
  

  RecordSet.Open SQLStr, con ' , adOpenStatic, adLockReadOnly
 
  Set ws = ActiveWorkbook.Sheets("Persons")
  Set ExcelRange = ws.Range("C3")
  ExcelRange.CopyFromRecordset RecordSet
  
  RecordSet.Close
  con.Close
Exit Sub




æˆ‘ä¹Ÿç»å¸¸é‡åˆ°è¿™æ ·çš„æƒ…å†µã€‚

æœ‰æ—¶å€™æç¤ºï¼šâ€œå¯¹è±¡å…³é—­æ—¶ï¼Œä¸å…è®¸æ“ä½œâ€

æ˜¯ç”±äºä»£ç ç»“æŸæ—¶ç”¨çš„æ˜¯ RST.Close ï¼Œæ”¹æˆ RST = Nothing å°±å¯ä»¥äº†ã€‚







ğŸ”µ è¿æ¥æ•°æ®åº“


strConnection = "Procider=OraOLEDB.oracle;Data Source=192.168.10.17:1521:YNTATEST;User Id=ta;Passwod=ta;"




 ' Open connection  
    strCnxn = "Provider='sqloledb';Data Source='MySqlServer';" & _  
        "Initial Catalog='Pubs';Integrated Security='SSPI';"  
    Set Cnxn = New ADODB.Connection  
    Cnxn.Open strCnxn  







ğŸ”µ åˆ›å»ºè¿æ¥å¯¹è±¡

    set å®ä¾‹å=Server.CreateObject("ADODB.Connection")


ğŸ”¶ è¿æ¥åˆ°å®ä¾‹

open 


ğŸ”¶ å…³é—­/é‡Šæ”¾ è¿æ¥
    Set conn=Nothing

    æœåŠ¡å™¨çš„è¿æ¥æ•°æ˜¯æœ‰é™åˆ¶çš„!



ğŸ”¶ æ‰§è¡Œå‘½ä»¤

ã€€ã€€ã€€ã€€Set å¯¹è±¡å˜é‡å=è¿æ¥å¯¹è±¡.Execute("SQL æŸ¥è¯¢è¯­è¨€")





CommandTimeOutã€€ã€€ã€€ è®¾ç½®Executeæ–¹æ³•çš„æœ€é•¿æ‰§è¡Œæ—¶é—´ï¼Œé»˜è®¤ä¸º30ç§’ã€‚è®¾ç½®ä¸º0ï¼Œæ— é™åˆ¶ã€‚
ConnectionTimeOutã€€ã€€è®¾ç½®Openæ–¹æ³•çš„æœ€é•¿æ‰§è¡Œæ—¶é—´ï¼Œé»˜è®¤ä¸º15ç§’ã€‚è®¾ç½®ä¸º0ï¼Œæ— é™åˆ¶ã€‚
ConnectionStringã€€ã€€ è®¾ç½®è¿æ¥å¯¹è±¡çš„é“¾æ¥ä¿¡æ¯ï¼Œå¦‚DSNã€æä¾›è€…ã€ç”¨æˆ·åã€å£ä»¤ç­‰ã€‚



ğŸ”µ ADO æ•°æ®åº“è¿æ¥

åˆ›å»ºä¸€ä¸ª ODBC æ•°æ®åº“è¿æ¥
å‡è®¾æ‚¨æ‹¥æœ‰ä¸€ä¸ªåä¸º "northwind" çš„ ODBC æ•°æ®åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ ASP ä»£ç è¿æ¥åˆ°æ­¤æ•°æ®åº“ï¼š

<%
set conn=Server.CreateObject("ADODB.Connection") 
conn.Open "northwind"
%>




ğŸ”µ ä¾‹å­



dim myconnection, myrecordset, name
set myconnection = server.createobject("ADODB.Connection")
' åˆ›å»ºè¿æ¥
set myrecordset = server.createobject("ADODB.Recordset")
' åˆ›å»ºè®°å½•é›†


myconnection.open mydatasource
myrecordset.open "Phonebook", myconnection
myrecordset.find "PhoneNumber = '555-5555'"
name = myrecordset.fields.item("Name")
myrecordset.close

set myrecordset = nothing
set myconnection = nothing









ğŸ”µ 


1ã€å¼•ç”¨æ³•
     å¼•ç”¨ADOç›¸å…³ç»„ä»¶ï¼šæ‰“å¼€VBAç¼–è¾‘å™¨ï¼Œåœ¨èœå•ä¸­ç‚¹é€‰â€œå·¥å…·â€--ã€‹â€œå¼•ç”¨â€ã€‚
     ç¡®ä¿â€œMicrosoft ActiviteX Data Objects 2.8 Libraryâ€
     å’Œâ€œMicrosoft ActiviteX Data ObjectS Recordset 2.8 Libraryâ€è¢«å‹¾é€‰ä¸Šã€‚å¼•ç”¨åå†å£°æ˜: 

    Dim cnn As New Connection  'å£°æ˜é“¾æ¥å¯¹è±¡
    Dim rst As New Recordset       'å£°æ˜è®°å½•é›†å¯¹è±¡

ä¸‹é¢æ˜¯ä¾‹ç¨‹ï¼š




Dim cnn As New Connection  
Dim rst As New Recordset  
cnn.Open "Provider=msdaora.1;Data Source=dl580;User Id=emssxjk;Password=emssxjk;"  
OraOpen = True 'æˆåŠŸæ‰§è¡Œåï¼Œæ•°æ®åº“å³è¢«æ‰“å¼€  
  
sqls = "select count(*) from tb_evt_dlv where mail_num='" & emsid & "'"  
Set rst = cnn.Execute(sqls)  
If rst(0) > 0 Then  
    sqls = "select b.zj_code,b.zj_mc,b.jgfl,b.city,b.ssxs  from tb_evt_dlv a, tb_jg b "  
    sqls = sqls & "where a.dlv_bureau_org_code = b.zj_code and a.mail_num='" & emsid & "' and rownum=1"  
    Set rst = cnn.Execute(sqls)  
    sqls = "CopyFromRecordset"  
    'maxrow = Sheets(qfxx).[A65536].End(xlUp).Row  
    'If maxrow > 1 Then Sheets(qfxx).Range("a2:H" & maxrow).ClearContents  
    Cells(row1, pos_sav).CopyFromRecordset rst  
Else  
    sqls = "select b.zj_code,b.zj_mc,b.jgfl,b.city,b.ssxs  from tb_evt_mail_clct a, tb_jg b "  
    sqls = sqls & "where a.clct_bureau_org_code = b.zj_code and a.mail_num='" & emsid & "' and rownum=1"  
    Set rst = cnn.Execute(sqls)  
    sqls = "CopyFromRecordset"  
    'maxrow = Sheets(qfxx).[A65536].End(xlUp).Row  
    'If maxrow > 1 Then Sheets(qfxx).Range("a2:H" & maxrow).ClearContents  
    Cells(row1, pos_sav + 5).CopyFromRecordset rst  
End If  





ğŸ”µ 2ã€åˆ›å»ºæ³•

ä¸éœ€è¦å¼•ç”¨ADOç›¸å…³ç»„ä»¶ï¼Œç›´æ¥ä½¿ç”¨CreateObjectå‡½æ•°åˆ›å»ºADOå¯¹è±¡ï¼Œå³ï¼š
      Set cnn = CreateObject("ADODB.connection")     'åˆ›å»ºadoå¯¹è±¡
      Set rst = CreateObject("ADODB.recordset")      'åˆ›å»ºè®°å½•é›†
ä¸‹é¢æ˜¯ä¾‹ç¨‹ï¼ˆå’Œä¸Šé¢ä¾‹ç¨‹ç±»ä¼¼ï¼Œå‰åŠéƒ¨åˆ†ä¸åŒï¼Œåé¢çš„ç›¸åŒï¼‰ï¼š

[vb] view plain copy
Dim cnn As Object, rst As Object  
  
Set cnn = CreateObject("ADODB.Connection")  
Set rst = CreateObject("ADODB.Recordset")  
cnn.Open "Provider=msdaora.1;Data Source=dl580;User Id=emssxjk;Password=emssxjk;"  
OraOpen = True 'æˆåŠŸæ‰§è¡Œåï¼Œæ•°æ®åº“å³è¢«æ‰“å¼€  

å…¶å®ƒç»„ä»¶çš„ä½¿ç”¨ä¹Ÿå’Œè¿™ä¸ªå·®ä¸å¤šï¼Œå»ºè®®ç”¨åˆ›å»ºæ³•ï¼Œè¿™æ ·å°±ä¸ç”¨ç®¡â€œå¼•ç”¨â€ä¸­çš„è®¾ç½®äº†ï¼Œä¾‹å¦‚ï¼š

Dim dic As Object       'ç›´æ¥åˆ›å»ºä¸éœ€è¦å¼•ç”¨
Set dic = CreateObject("scripting.dictionary")     'åˆ›å»ºå­—å…¸å¯¹è±¡


Dim fso as Object       'ç›´æ¥åˆ›å»ºä¸éœ€è¦å¼•ç”¨
Set fso = CreateObject("Scripting.FileSystemObject")     'åˆ›å»ºæ–‡ä»¶å¯¹è±¡æ¨¡å‹




ğŸ”µ count ğŸ‘¹ 


    æœ¬åœ°ä½¿ç”¨windows7 64ä½æ——èˆ°ç‰ˆï¼Œåœ¨è‡ªå¸¦çš„iis7ä¸‹è°ƒè¯•ä¸€ä¸ªaspç½‘ç«™ã€‚
    åŸæ¥åœ¨æœåŠ¡å™¨è¿è¡Œå¥½å¥½çš„ç½‘ç«™åˆ°äº†æœ¬åœ°å´å‡ºç°ASPè¿æ¥ACCESSé”™è¯¯ï¼š
    ADODB.Connection é”™è¯¯ '800a0e7a' æœªæ‰¾åˆ°æä¾›ç¨‹åºã€‚è¯¥ç¨‹åºå¯èƒ½æœªæ­£ç¡®å®‰è£…ã€‚ 
      ä¸»è¦åŸå› ï¼Œå‡ºç°ADODB.Connection é”™è¯¯ '800a0e7a' æœªæ‰¾åˆ°æä¾›ç¨‹åºã€‚è¯¥ç¨‹åºå¯èƒ½æœªæ­£ç¡®å®‰è£…ã€‚ 
      é”™è¯¯çš„åŸå› åœ¨äºåœ¨64ä½ç³»ç»Ÿä¸­ï¼ŒIIS7åº”ç”¨ç¨‹åºæ± é»˜è®¤æ²¡æœ‰å¯ç”¨32ä½ç¨‹åºï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½¿ç”¨çš„æ˜¯64ä½æ“ä½œç³»ç»Ÿï¼Œ
      è€Œæ²¡æœ‰64ä½çš„Jet 4.0é©±åŠ¨ç¨‹åºï¼Œé‚£ä¹ˆå°±è¦åœ¨IIS7ä¸­å¯ç”¨32ä½ç¨‹åºã€‚

    æˆ‘è¿™ä¸ª..offcie æ˜¯ 64çš„å•Š!! ä½†æ˜¯æˆ‘é‚£ä¸ª oracle å®¢æˆ·ç«¯æ˜¯ 32 çš„... å‘..


æ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š


IISä¿¡æ¯ç®¡ç†å™¨ - æŸ¥çœ‹åº”ç”¨ç¨‹åºæ±  - å³è¾¹æ“ä½œä¸­é€‰æ‹©--è®¾ç½®åº”ç”¨ç¨‹åºæ± é»˜è®¤è®¾ç½®ï¼Œåœ¨å¸¸è§„ä¸­è®¾ç½®--å¯ç”¨ 32 ä½ç¨‹åºä¸ºTrue.