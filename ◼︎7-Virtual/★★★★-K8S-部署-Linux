ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ CentOS_7 éƒ¨ç½² K8s ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

ğŸ”µ ç¡¬ä»¶è¦æ±‚

    ğŸ”¶ ç”µè„‘ä¸€å°
    
        k8s æ˜¯é›†ç¾¤. é‚£ä¹ˆè‚¯å®šå¾—å¥½å‡ å°æœåŠ¡å™¨. 
        å°±ç®—æˆ‘ä»¬ç”¨è™šæ‹Ÿæœº. ä¹Ÿå¾—è™šæ‹Ÿå¥½å‡ ä¸ªç³»ç»Ÿå‡ºæ¥.
        æ‰€ä»¥ ä¸€èˆ¬çš„ vps é…ç½®éƒ½æ¯”è¾ƒä½. ä¸é€‚åˆæ­å»ºé›†ç¾¤.
        æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¼„äº†ä¸ª windows çš„ç”µè„‘ å®‰è£… vmware.
        åœ¨ vmware é‡Œé¢å®‰è£… CentOS7.  åªè¦å†…å­˜å¤Ÿ.æƒ³è£…å‡ ä¸ªå°±è£…å‡ ä¸ªè™šæ‹Ÿæœº.


    ğŸ”¶ VPS (KVM) æœåŠ¡å™¨ä¸€ä¸ª

        å¾ˆå¤šé•œåƒæ˜¯éœ€è¦ç¿»å¢™ä¸‹è½½çš„.
        ä¸ç¿»å¢™çš„è¯å¾—æ³¨å†Œå„ç§ç½‘ç«™.. æ¯”å¦‚ é˜¿é‡Œäº‘çš„. Daocloud çš„...
        vps è¿˜å¾—æ˜¯å¯ä»¥è¿è¡ŒDocker çš„!!!  å¾ˆå¤šopenvz çš„vpsæ˜¯è¿è¡Œä¸äº†Dockerçš„.
        æ‰€ä»¥æˆ‘ä»¬æ¨èç”¨ KVM çš„ vps.


ğŸ”µ è™šæ‹Ÿæœºè¦æ±‚

    è™šæ‹Ÿæœºè‚¯å®šç”¨ Linux çš„.  ä¸€èˆ¬éƒ½æ˜¯ CentOS_7 x64 Mininul.
    é•œåƒå¤§å°é€‰æ‹©æœ€å°çš„é‚£ä¸ªå°±å¯ä»¥äº†. å®Œå…¨æ²¡å¿…é¡»é€‰æ‹© å®Œæ•´çš„ 8G çš„é‚£ä¸ª.



ğŸ”µ Docker ç‰ˆæœ¬è¦æ±‚ - (è™šæ‹Ÿæœº)

    k8s æ—¢ç„¶æ˜¯ç®¡ç†å®¹å™¨çš„. é¦–å…ˆä½ å¾—æœ‰å®¹å™¨æ‰èƒ½è®© k8s å»ç®¡ç†.
    è¦åˆ›å»ºå®¹å™¨ä¹ˆ. è‚¯å®šè¦å®‰è£… Docker ç¨‹åºäº†. è¿™å°±æ¶‰åŠåˆ° Docker ç‰ˆæœ¬é—®é¢˜äº†.
    è™½ç„¶ç°åœ¨ Docker å·²ç»å‡ºäº† v17äº†.  ä½†æ˜¯ k8s åªåœ¨ v12 çš„Docker ä¸Šé¢é€šè¿‡æµ‹è¯•.
    æˆ‘ä»¬ä¹Ÿå°±å®‰è£… 12 æˆ–è€… 13å¥½äº†. æ²¡å¿…è¦å®‰è£…å¤ªæ–°çš„.


ğŸ”µ k8s å®‰è£…æ–¹å¼.

    yum å¯ä»¥ç›´æ¥å®‰è£… k8s  ä½†æ˜¯ç‰ˆæœ¬æœ‰ç‚¹ä½! 1.5çš„ , ç°åœ¨éƒ½å‡ºåˆ° 1.8 äº†. æ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨å®‰è£…! 

    å…¶å®æœ‰è‡ªåŠ¨åŒ–éƒ¨ç½²çš„åŠæ³•çš„.
    ä½†æ˜¯æŠŠ ä½ è¦å­¦k8s è¿˜æ˜¯æ‰‹åŠ¨æ­å»ºå§... 
    ä¸ç„¶å„ç§äº‘ä¸Šéƒ½æœ‰ç°æˆçš„ k8s. ä½ åªè¦è´­ä¹°. ç„¶åå¼€æœºå°±å¯ä»¥äº†...

    é€šè¿‡æ‰‹åŠ¨é…ç½®, ä½ å°†ä¼šç†è§£æ‰€æœ‰åº•å±‚çš„åŒ…ã€æœåŠ¡ã€ç«¯å£ ç­‰ç­‰.


    ğŸ”¸ Kubeadm 

        ä½ å¯ä»¥ä¸€é¡¹ä¸€é¡¹å®‰è£….  ä¹Ÿå¯ä»¥ä½¿ç”¨ Kubeadm æ¥ä¸€é”®éƒ¨ç½²!
        kubeadmæ˜¯Kuberneteså®˜æ–¹æä¾›çš„å¿«é€Ÿå®‰è£…å’Œåˆå§‹åŒ–Kubernetesé›†ç¾¤çš„å·¥å…·
        å½“ç„¶ï¼Œç›®å‰çš„kubeadmæ˜¯ä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ã€‚


ğŸ”µ æœåŠ¡å™¨åˆ—è¡¨

    è™šæ‹Ÿæœº1:
    è™šæ‹Ÿæœº2:
    è™šæ‹Ÿæœº3:




ğŸ”µ CentOS7 å®‰è£…: Docker 






ğŸ”µ Docker ç§æœ‰ä»“åº“æ­å»º

    å…¬æœ‰ä»“åº“å¢™çš„å¢™. æ…¢çš„æ…¢. è‡ªå·±æ­ä¸€ä¸ªå§. å¾ˆç®€å•çš„. åˆ©äººåˆ©å·±....
    è€Œä¸”... ä½ å¯ä»¥æŠŠè‡ªå·±çš„é•œåƒå¤‡ä»½åˆ°ç§æœ‰ä»“åº“ä¸­!!! 
    è¿™æ—¶å€™ä½ å°±ä¸ç”¨æ‹…å¿ƒ å¤‡ä»½é•œåƒä¸­çš„èµ„æ–™ä¼šè¢«åˆ«äººè·å–äº†.

    æˆ‘ä»¬åœ¨ VPS 98.142.138.81 ä¸Šæ­å»ºç§æœ‰ä»“åº“.

    ğŸ”¶ åŸºç¡€çŸ¥è¯† - ç§æœ‰ä»“åº“
        
        Dockersä¸ä»…æä¾›äº†ä¸€ä¸ªä¸­å¤®ä»“åº“ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æˆ‘ä»¬ä½¿ç”¨æ­å»ºæœ¬åœ°ç§æœ‰ä»“åº“ã€‚
        
        ç§æœ‰ä»“åº“åˆ†ä¸¤ç§:. 
            â¦¿ ä¸ªäººçš„: Docker Registry
            â¦¿ ä¼ä¸šçš„: Docker Distribution 

            ä¸¤è€…åŒºåˆ«ä¸ç”¨ç®¡.æˆ‘ä»¬ç”¨ç”¨ä¸ªäººçš„è¶³å¤Ÿäº†!!! 


    ğŸ”¶ åŸºç¡€çŸ¥è¯† - Docker æ ‡ç­¾

        Git çš„æ ‡ç­¾åŠŸèƒ½æ˜¯ç»™æ–‡æ¡£æ‰“ä¸Šä¸€ä¸ªæ ‡è®°. ç›¸å½“äºæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªå¤‡ä»½!!!
        Docker çš„æ ‡ç­¾  å°±æ˜¯ç»™é•œåƒä¸€ä¸ªå–ä¸ªå¥½è®°çš„åå­—!!! æ–¹ä¾¿ç®¡ç†.


    ğŸ”¶ Docker Registry(æ³¨å†Œ) é•œåƒ

        ç§æœ‰ä»“åº“æ˜¯ä¸ªåˆšéœ€. æ‰€ä»¥Docker è‡ªå·±æä¾›äº†ä¸€ä¸ªå« Registry çš„å®¹å™¨é•œåƒ!
        æŠŠè¿™ä¸ªé•œåƒä¸‹åˆ° vps ä¸Šè¿è¡Œå°±å¯ä»¥äº†.
        å½“ç„¶ vps é‡Œé¢. Docker çš„å®‰è£….å’Œå¯åŠ¨å°±ä¸è¯´äº†...
        

    ğŸ”¶ ç§æœ‰ä»“åº“æ­å»º

        â¦¿ ä¸€: ä¸‹è½½é•œåƒ

            docker pull registry:latest

        â¦¿ äºŒ: æŸ¥çœ‹é•œåƒ

            VPSâˆ™ ~ %}âœ docker images
            REPOSITORY                                       TAG                 IMAGE ID            CREATED             SIZE
            docker.io/registry                               latest              d1fd7d86a825        3 months ago        33.3 MB

        â¦¿ ä¸‰: è¿è¡Œé•œåƒ

            docker run \
            --detach \
            --name registry \
            --hostname registry \
            --volume $(pwd)/registry:/var/lib/registry/docker/registry \
            --publish 5000:5000 \
            --restart unless-stopped \
            registry:latest



            // è¿™ä¸ªå‘½ä»¤ å°±æ˜¯ä½ é‡å¯äº†Docker æœåŠ¡. è¿™ä¸ªå®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨é‡å¯çš„.... ç‰›...
            // è¿™ä¸ªå‘½ä»¤ ä¼šåœ¨ vps å’Œ docker éƒ½å¼€ä¸€ä¸ª 5000 ç«¯å£. vpsçš„5000 ç«¯å£å¯¹åº” docker å®¹å™¨çš„ 5000ç«¯å£.

            // å°†registryçš„æ•°æ®å·ä¸æœ¬åœ°å…³è”ï¼Œä¾¿äºç®¡ç†å’Œå¤‡ä»½registryæ•°æ®.
            // å°±æ˜¯ä»¥åæŠŠé•œåƒ ä¸‹è½½åˆ° vps çš„æŸä¸ªç›®å½•. ç„¶ååˆ«çš„ç”µè„‘å°±å¯ä»¥é€šè¿‡ Docker Registry æ¥ä¸‹é•œåƒäº†.
                $ sudo docker run -d -p 5000:5000 registry
                é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå°†ä»“åº“å­˜æ”¾äºå®¹å™¨å†…çš„/tmp/registryç›®å½•ä¸‹ï¼Œ
                è¿™æ ·å¦‚æœå®¹å™¨è¢«åˆ é™¤ï¼Œåˆ™å­˜æ”¾äºå®¹å™¨ä¸­çš„é•œåƒä¹Ÿä¼šä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹ä¼šæŒ‡å®šæœ¬åœ°ä¸€ä¸ªç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„/tmp/registryä¸‹ï¼Œ
                å¦‚ä¸‹ï¼šsudo docker run -d -p 5000:5000 -v /opt/data/registry:/tmp/registry registry


        â¦¿ å››: æŸ¥çœ‹è¿è¡Œä¸­é•œåƒ

            VPSâˆ™ ~ %}âœ docker ps
            CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
            c264c19a9bf4        registry:latest     "/entrypoint.sh /e..."   9 seconds ago       Up 9 seconds        0.0.0.0:5000->5000/tcp   registry



        â¦¿ æŸ¥çœ‹ç§æœ‰ä»“åº“çš„é•œåƒ

            VPS æœåŠ¡å™¨ç”¨ curl å‘½ä»¤æŸ¥çœ‹:  curl http://127.0.0.1:5000/v2/_catalog
            æˆ–è€…
            æœ¬åœ°æµè§ˆå™¨è®¿é—®  http://98.142.138.81:5000/v2/_catalog
            éƒ½ä¼šå¾—åˆ°  {"repositories":[]}  
            è¿™æ˜¯å› ä¸ºç°åœ¨è¿˜æ²¡æœ‰ é•œåƒæ¨é€åˆ° ç§æœ‰ä»“åº“....


        â¦¿ æŸ¥çœ‹ç°æœ‰é•œåƒ

            VPSâˆ™ ~ %}âœ docker images
            REPOSITORY                                       TAG                 IMAGE ID            CREATED             SIZE
            docker.io/registry                               latest              d1fd7d86a825        3 months ago        33.3 MB
            gcr.io/google_containers/k8s-dns-sidecar-amd64   1.14.1              fc5e302d8309        14 months ago       44.5 MB

                æˆ‘ä»¬ä¸‹è½½çš„æ—¶å€™ç”¨çš„æ˜¯   docker pull registry:latest
                å†’å·åé¢çš„æ˜¯ ç‰ˆæœ¬.  å†’å·å‰é¢çš„æ˜¯é•œåƒå.


        â¦¿ ç»™é•œåƒæ‰“æ ‡ç­¾ (é‡å‘½å-? ä¸æ˜¯å•Š .. æ–°å»ºäº†ä¸ª é•œåƒå‡ºæ¥å•Š.. æ˜¯å“ªä¸ªç”¨çš„ é•œåƒçš„æ„æ€!!! å¿«ç…§)
            
            è¯­æ³•: docker tag ID ä»“åº“å/é•œåƒå:ç‰ˆæœ¬
            ä¾‹å­: docker tag fc5e302d8309 127.0.0.1:5000/xxx:114
                æ ‡ç­¾åå­—æ˜¯ ç§æœ‰ä»“åº“+åå­—+ç‰ˆæœ¬å·ç»„æˆçš„!!! å¿…é¡»å¸¦æœ‰ ç§æœ‰ä»“åº“..

        â¦¿ VPS ä¸Šæ¨é€é•œåƒåˆ° ç§æœ‰ä»“åº“

            docker push 127.0.0.1:5000/xxx:114 

        â¦¿ ç§æœ‰ä»“åº“ æŸ¥çœ‹é•œåƒ
            http://98.142.138.81:5000/v2/_catalog
            {"repositories":["xxx"]}
            å°±è¯´æ˜ æˆ‘ä»¬çš„ç§æœ‰ä»“åº“ æœ‰äº†ä¸ª xxx çš„é•œåƒ.

        â¦¿ 9ã€ä»ä½ çš„æœ¬åœ°ç¯å¢ƒä¸­ç§»é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼š
            docker -rmi -f $(docker images -q -a )


        â¦¿ ç§æœ‰ä»“åº“ æµ‹è¯• - æœåŠ¡å™¨

            docker run localhost:5000/hello-mine
            è¿™é‡Œå¿…é¡»åŠ ä¸Š ç§æœ‰ä»“åº“çš„ç½‘å€: localhost:5000  ä¸ç„¶é»˜è®¤æ˜¯ä» docker.io è¿™ä¸ªç½‘ç«™ä¸Šä¸‹è½½çš„.
            

        â¦¿ ç§æœ‰ä»“åº“ æµ‹è¯• - å®¢æˆ·ç«¯

docker pull 98.142.138.81:5000/xxx



        â¦¿ ç»“å°¾

            ç§æœ‰ä»“åº“å»ºå¥½äº†. ä¹Ÿä¼šä¸Šä¼ é•œåƒäº†.
            ä¸‹é¢å°±æ˜¯æŠŠ k8s æ‰€éœ€çš„é•œåƒ ä¸Šä¼ åˆ°æˆ‘ä»¬è‡ªå·±çš„ç§æœ‰ä»“åº“é‡Œé¢.
            é¦–å…ˆ æˆ‘ä»¬è¦æŸ¥çœ‹ä¸‹ æœ€æ–°çš„ k8s çš„é•œåƒç‰ˆæœ¬. ä»¥åŠè¦å“ªäº›é•œåƒ.





....







ğŸ”µ K8S æœ€æ–°é•œåƒ

    docker é»˜è®¤éƒ½æ˜¯ä»è¿™ä¸ªç½‘ç«™ docker.io ä¸‹è½½/æœç´¢ é•œåƒçš„.
    ä½†æ˜¯æˆ‘ä»¬çš„ K8S å®˜æ–¹é•œåƒæ˜¯è°·æ­Œå‡ºçš„. è¦å» gcr.io ä¸‹è½½.æ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤.
    docker pull gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.1

    é¦–å…ˆä½ å¾—çŸ¥é“æœ€æ–°çš„k8sç‰ˆæœ¬å§. è¿™å°±è¦æœç´¢ gcr.io é‡Œé¢çš„é•œåƒäº†
    docker å‘½ä»¤ ä¹Ÿæ˜¯æ”¯æŒæœç´¢ç§æœ‰ä»“åº“çš„!!!









ğŸ”µ CentOS åˆ›å»º Docker (CentOS)

    ç”¨ä»€ä¹ˆé•œåƒå‘¢...  


ğŸ”¸ Docker èŠ‚ç‚¹ é…ç½®é˜²ç«å¢™ 
      Dockerä»1.13ç‰ˆæœ¬å¼€å§‹è°ƒæ•´äº†é»˜è®¤çš„é˜²ç«å¢™è§„åˆ™ï¼Œç¦ç”¨äº†iptables filterè¡¨ä¸­FOWARDé“¾ï¼Œ
      è¿™æ ·ä¼šå¼•èµ·Kubernetesé›†ç¾¤ä¸­è·¨Nodeçš„Podæ— æ³•é€šä¿¡ï¼Œ
      åœ¨å„ä¸ªDockerèŠ‚ç‚¹æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼šæ¥å…è®¸æµé‡è½¬å‘.

      iptables -P FORWARD ACCEPT

      iptables -L âœ æŸ¥çœ‹é˜²ç«å¢™...
      iprables -F âœ æ¸…ç©ºé˜²ç«å¢™...
      systemctl stop firewalld  âœ åœæ­¢é˜²ç«å¢™
      systemctl disable firewalld  âœ ç¦æ­¢å¼€æœºè‡ªå¯


ğŸ”¸ Docker èŠ‚ç‚¹ å…³é—­ Selinux 

    cat /etc/sysconfig/selinux  âœ SELINUX=disabled âœ å°±è¯´æ˜æ˜¯å…³é—­çš„.
    å¦‚æœä¸æ˜¯disableå°±éœ€è¦æ‰‹åŠ¨æ‰§è¡Œä¸‹é¢ä¸€æ­¥
    vi /etc/sysconfig/selinux  âœ æ”¹æˆ  SELINUX=disabled âœ  ç„¶åé‡å¯æœºå™¨å°±å¯ä»¥äº†.






ğŸ”µ CentOS_7 x64 k8s æº


ğŸ”¶ è°·æ­Œçš„ k8s æº
cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg
        https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF




ğŸ”¶ é˜¿é‡Œäº‘çš„ k8s æº

cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
EOF





    æ·»åŠ æºä¹‹åå°±å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹k8så„æ ¸å¿ƒç»„ä»¶çš„ç‰ˆæœ¬äº†,é€‰æ‹©æŸä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£….
yum list kubeadm  --showduplicates |sort -r
yum list kubelet  --showduplicates |sort -r
yum list kubectl  --showduplicates |sort -r
yum list kubernetes-cni  --showduplicates |sort -r



ğŸ”¸ k8s æ ¸å¿ƒç»„ä»¶å®‰è£…
    yum -y install kubeadm-1.8.0 kubelet-1.8.0 kubectl-1.8.0 kubernetes-cni-1.8.0

    yum -y install kubeadm-1.10.1-0 kubelet-1.10.1-0 kubectl-1.10.1-0 kubernetes-cni-0.6.0-0

    ä¹Ÿè®¸ ä¸‹é¢å‘½ä»¤ä¼šè‡ªåŠ¨å®‰è£… æœ€æ–°çš„ç‰ˆæœ¬çš„...
    yum -y install docker kubelet kubeadm kubectl kubernetes-cni


    rpm -qa|grep kube  âœ æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬





ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ K8S å‡†å¤‡é•œåƒ  ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

ğŸ”¶ VPSä¸€å°.

    openvz çš„vps è¿˜ä¸è¡Œ.  å› ä¸ºä¸€èˆ¬ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä½. è¿è¡Œä¸äº†Docker.
    è€Œä¸”è¿™ä¸ª é•œåƒæ˜¯ä¸èƒ½ é€šè¿‡ä»£ç†æ¥ä¸‹è½½çš„...
    æ‰€ä»¥åªèƒ½ç™»å½•åˆ° vpsä¸Šå». å®‰è£…å¥½Docker . ç”¨Docker Pull æŠŠé•œåƒæ‹‰ä¸‹æ¥.
    ç„¶å å¯¼å‡º Docker é•œåƒ. å†ä¸‹è½½åˆ°æœ¬åœ°....
    æˆ–è€…è‡ªå·±æ­å»ºä¸ª Docker çš„....ç½‘ç«™å‡ºæ¥??




ğŸ”¶ é•œåƒç‰ˆæœ¬é—®é¢˜.

    docker 





ğŸ”¸
k8s æ˜¯éå¸¸å¤šçš„è½¯ä»¶ç»„åˆè€Œæˆçš„! 
è¿™äº›è½¯ä»¶éƒ½è¢«åˆ¶ä½œæˆDockeré•œåƒäº†! 
æ‰€ä»¥è¿™äº›é•œåƒä¹Ÿæ˜¯å¿…é¡»è¦ä¸‹è½½çš„! 
è¿™ä¹ˆå¤šé•œåƒçš„è½¯ä»¶ç‰ˆæœ¬ä¹Ÿä¸æ˜¯éšä¾¿æ¥çš„. æœ‰äº›è¦å’Œ k8s ä¸»ç‰ˆæœ¬ä¸€è‡´.


ä¸‹é¢å››ä¸ª ä¸€èˆ¬è·Ÿç€å¤§ç‰ˆæœ¬èµ°. å¦‚æœk8s çš„ç‰ˆæœ¬æ˜¯1.8.0 ä¸‹é¢çš„ä¹Ÿå¿…é¡»å¯¹åº”
gcr.io/google_containers/kube-apiserver-amd64:v1.5.2
gcr.io/google_containers/kube-proxy-amd64:v1.5.2
gcr.io/google_containers/kube-controller-manager-amd64:v1.5.2
gcr.io/google_containers/kube-scheduler-amd64:v1.5.2


ä¸‹é¢è¿™ä¸ªæ˜¯k8s çš„æ§åˆ¶å°. å°½é‡è·Ÿç€å¤§ç‰ˆæœ¬, å¤§ç‰ˆæœ¬æ˜¯1.8.x è¿™ä¸ªå¯ä»¥å®‰è£… 1.8.0
gcr.io/google_containers/kubernetes-dashboard-amd64:v1.5.1


ä¸‹é¢ä¸‰ä¸ªæ˜¯ DNS æœåŠ¡, ä¸€èˆ¬ä¸è·Ÿ k8s ! 
# docker pull gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.1
# docker pull gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.1
# docker pull gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.1


etcd æœåŠ¡.ä¸è·Ÿk8s
# docker pull gcr.io/google_containers/etcd-amd64:3.0.17

å¾ˆä¹…éƒ½æ˜¯3.0äº†. 
# docker pull gcr.io/google_containers/pause-amd64:3.0

ç½‘ç»œç»„ä»¶
# docker pull quay.io/coreos/flannel:v0.7.1-amd64

æŸ¥çœ‹é•œåƒï¼š# docker images







images=(kube-proxy-amd64:v1.7.3 kube-scheduler-amd64:v1.7.3 kube-controller-manager-amd64:v1.7.3 kube-apiserver-amd64:v1.7.3 etcd-amd64:3.0.17 k8s-dns-sidecar-amd64:1.14.4 pause-amd64:3.0 k8s-dns-kube-dns-amd64:1.14.4 k8s-dns-dnsmasq-nanny-amd64:1.14.4)
for imageName in ${images[@]} ; do
  docker pull gcr.io/google_containers/$imageName
done

  docker pull gcr.io/google_containers/kube-proxy-amd64:v1.7.3



gcr.io/google_containers/kube-scheduler-amd64








ğŸ”¸ ä¿®æ”¹ç½‘ç»œ 


ä¸»è¦æ˜¯å¼€å¯æ¡¥æ¥ç›¸å…³æ”¯æŒï¼Œè¿™ä¸ªæ˜¯ flannel éœ€è¦çš„é…ç½®ï¼Œå…·ä½“æ˜¯å¦éœ€è¦ï¼Œçœ‹è‡ªå·±çš„ç½‘ç»œç»„ä»¶é€‰æ‹©çš„æ˜¯ä»€ä¹ˆã€‚

ä¿®æ”¹/usr/lib/sysctl.d/00-system.conf,å°†net.bridge.bridge-nf-call-iptablesæ”¹æˆ1.ä¹‹åä¿®æ”¹å½“å‰å†…æ ¸çŠ¶æ€

echo 1 > /proc/sys/net/bridge/bridge-nf-call-iptables





ğŸ”¸ å¯åŠ¨kubeletï¼š

# systemctl enable kubelet
# systemctl start kubelet



ğŸ”¸ åˆå§‹åŒ–masteræœºå™¨ï¼š

# kubeadm init \
    --apiserver-advertise-address=172.16.20.99 \
    --kubernetes-version=v1.6.1 \
    --pod-network-cidr=10.244.0.0/16
  å‚æ•°è§£é‡Šï¼š
 --apiserver-advertise-address # API Serverï¼ˆmasterï¼‰IPåœ°å€
 --kubernetes-version # åˆå§‹åŒ–å®‰è£…çš„Kubernetesç‰ˆæœ¬
 --pod-network-cidr # é€‰æ‹©flannelä½œä¸ºPodçš„ç½‘ç»œæ’ä»¶ï¼Œæ‰€ä»¥æŒ‡å®š 10.244.0.0/16


;ğŸ”¸ ä½¿ç”¨kubectl ç®¡ç†å‘½ä»¤è¡Œï¼š

ä¸ºäº†ä½¿ç”¨kubectlè®¿é—®apiserverï¼Œåœ¨~/.bash_profileä¸­è¿½åŠ ä¸‹é¢çš„ç¯å¢ƒå˜é‡ï¼š

# echo "export KUBECONFIG=/etc/kubernetes/admin.conf" >> ~/.bash_profile
# source ~/.bash_profile
# kubectl get nodesNAME STATUS AGE VERSIONnode0 NotReady 3m v1.6.1








