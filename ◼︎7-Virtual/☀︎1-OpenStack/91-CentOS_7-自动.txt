

â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ IPsec  VPN  æ­å»º ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”¸ VPN å‡†å¤‡.
	è¿™é‡Œä¸å»ºè®®ç”¨ è„šæœ¬. 
	ä¸€æ—¦mac vpn è¿åˆ°æœåŠ¡å™¨, æœåŠ¡å™¨ä¼šç»™mac åˆ†é…ä¸€ä¸ªå†…ç½‘IPåœ°å€.
	æˆ‘ä»¬è¦ç¡®ä¿ è¿™ä¸ªIPåœ°å€ å’Œ aaa/bbb /gce åœ¨ä¸€ä¸ªå†…ç½‘ç½‘æ®µå†…!
	è¿™å°±éœ€è¦æ‰‹åŠ¨æŒ‡å®š vpn çš„ç½‘æ®µè®¾ç½®.


ğŸ”¸ å‚è€ƒ: https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/README-zh.md

ğŸ”¸ ç³»ç»Ÿ: KVM GCE Ubuntu_17 


ğŸ”¸ aaa å®‰è£…: wget https://git.io/vpnsetup -O vpnsetup.sh && sudo sh vpnsetup.sh

	================================================

	IPsec VPN server is now ready for use!

	Connect to your new VPN with these details:

	Server IP: 104.199.235.151
	IPsec PSK: GZmMBvhMXsU74RNW
	Username: vpnuser
	Password: VzT9X23C2SkgErGx

	Write these down. You'll need them to connect!

	Important notes:   https://git.io/vpnnotes
	Setup VPN clients: https://git.io/vpnclients

	================================================




ğŸ”¸ bbb å®‰è£…: wget https://git.io/vpnsetup -O vpnsetup.sh && sudo sh vpnsetup.sh

        ================================================

        IPsec VPN server is now ready for use!

        Connect to your new VPN with these details:

        Server IP: 35.194.218.62
        IPsec PSK: HS6yYSukdAqasjWw
        Username: vpnuser
        Password: jAABrZd4f6DqeUib

        Write these down. You'll need them to connect!

        Important notes:   https://git.io/vpnnotes
        Setup VPN clients: https://git.io/vpnclients

        ================================================


    ä½ çš„ VPN ç™»å½•å‡­è¯å°†ä¼šè¢«è‡ªåŠ¨éšæœºç”Ÿæˆï¼Œå¹¶åœ¨å®‰è£…å®Œæˆåæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚



ğŸ”¸ ä¿®æ”¹ VPN ç½‘æ®µ
    è¯¦ç»†å‚è€ƒ: http://blog.csdn.net/lic95/article/details/48264933
     
     sudo vi /etc/xl2tpd/xl2tpd.conf
        ip range = 10.140.0.21-10.140.0.100 
        local ip = 10.140.0.20



ğŸ”¸ Mac VPN è¿æ¥è®¾ç½® 

    â¦¿ æ–°å»º VPN 
        L2TP over IPSec ; bbbVPN

    â¦¿ é…ç½® VPN
        server address : 35.194.218.62
        Account Name:   vpnuser
        Authentication settingss : password        jAABrZd4f6DqeUib
        Authentication settingss : shared Secret   HS6yYSukdAqasjWw

    â¦¿ ä¿å­˜ apply 
    â¦¿ è¿æ¥ connect 

    â¦¿ æŸ¥çœ‹ç½‘æ®µ : 192.168.42.10 




ğŸ”¸ ç›¸å…³å‘½ä»¤     
    service ipsec start && service ipsec status
    service ipsec stop && service ipsec status
    service ipsec restart

ğŸ”¸ reboot 
    è„šæœ¬è®¾ç½®å¼€æœºå¯åŠ¨çš„. ä¸æƒ³ç ”ç©¶å„ç§å¯åŠ¨å‘½ä»¤. ç›´æ¥é‡å¯

ğŸ”¸ è¿æ¥æµ‹è¯•
    æˆåŠŸ. ç°åœ¨ mac åˆ†é…åˆ°çš„IP å°±æ˜¯ 10.140.0.21 
    

ğŸ”¸ ping gce bbb å†…å®¹IPæµ‹è¯•
	ping 10.140.0.3  å¯ä»¥....
	ä½†æ˜¯ping ä¸äº† gce å®ä¾‹ç»„çš„ aaa å’Œ gce ...
	ä¸ºå•¥... 
	10 ç½‘æ®µæ˜¯å†…ç½‘! åªèƒ½åœ¨ç½‘ç»œå†…éƒ¨é€šä¿¡,è¿™ä¸ªç½‘ç»œ æ˜¯ bbb åˆ›å»ºçš„
	è€Œæˆ‘ä»¬å®ä¾‹ç»„çš„ å†…ç½‘ æ˜¯è°·æ­Œåˆ›å»ºçš„!  
	å°±å¥½æ¯”æˆ‘å®¶é‡Œè·¯ç”±å™¨ç½‘æ®µæ˜¯ 192.168.1.1  å…¬å¸çš„ç½‘æ®µä¹Ÿæ˜¯ 192.168.1.1
	è™½ç„¶éƒ½æ˜¯192.168.1.1 ä½†æ˜¯è‚¯å®šä¸äº’é€šçš„..

	çœ‹äº†æˆ‘ä»¬çš„ openstack æ§åˆ¶å° è¦å’Œ vpn è£…åœ¨ä¸€ä¸ªæœåŠ¡å™¨å†…æ‰è¡Œäº†.




â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ  GCE -  devstack å®‰è£… - Ubuntu 16 âœ”ï¸ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

â—ï¸â—ï¸ æœ€æ–°ç‰ˆæœ¬çš„ devstack å¿…é¡»ç”¨ Ubuntu 16/17 ä¸èƒ½ç”¨ Ubuntu 14 â—ï¸â—ï¸
â—ï¸â—ï¸ æœ€æ–°ç‰ˆæœ¬çš„ devstack å¿…é¡»ç”¨ Ubuntu 16/17 ä¸èƒ½ç”¨ Ubuntu 14 â—ï¸â—ï¸
â—ï¸â—ï¸ æœ€æ–°ç‰ˆæœ¬çš„ devstack å¿…é¡»ç”¨ Ubuntu 16/17 ä¸èƒ½ç”¨ Ubuntu 14 â—ï¸â—ï¸



ğŸ”¸ æ¶æ„
	ä¸¤ä¸ª GCE æœåŠ¡å™¨, å•ç½‘å¡å°±è¡Œ. åªè¦å†…å­˜é«˜ç‚¹. å…¶ä»–æ— æ‰€è°“.


ğŸ”¸ GCE å®ä¾‹åˆ›å»º
	æˆ‘ä»¬ä¼šåˆ›å»ºä¸¤ä¸ªä¸´æ—¶çš„ gce è™šæ‹Ÿæœº. æœåŠ¡å™¨.å†…å­˜è¦æ±‚è¾ƒé«˜ 8G+ . å…¶ä»–è¶Šé«˜è¶Šå¥½.
	å»ºè®®é…ç½®: 2 vcpu + 13G å†…å­˜ + 30G SSD +  CentOS_7 x64

	â¦¿ å®ä¾‹1 : aaa    Ubuntu 17    104.199.235.151 
	â¦¿ å®ä¾‹2 : bbb     Ubuntu 17    35.194.218.62 


ğŸ”¸ GCE åˆ›å»ºå®ä¾‹ç»„

	â¦¿ åˆ›å»ºå®ä¾‹ç»„: 
		å•åœ°åŒº âœ asia-east1-a âœ éæ‰˜ç®¡å®ä¾‹ç»„ âœ ç½‘ç»œé»˜è®¤ âœ å­ç½‘é»˜è®¤: 10.140.0.0/20
		vm å®ä¾‹ æ·»åŠ  aaa . bbb 

	â¦¿ ç¼–è¾‘å®ä¾‹ç»„
		æˆ‘ä»¬æŠŠ aaa å’Œ bbb éƒ½æ”¾åˆ°è¿™ä¸ªç»„å†…. 
		ç„¶åæˆ‘ä»¬æŠŠ gce ä¹Ÿæ”¾åˆ°è¿™ä¸ªç»„å†….
		æœ€ååœ¨gce ä¸Šåˆ›å»ºvpn . è¿™æ ·æˆ‘ä»¬çš„macæœ¬åœ°ç”µè„‘ å°±èƒ½è®¿é—® å®ä¾‹ç»„çš„å†…ç½‘IPäº†.

			å®ä¾‹å  å†…éƒ¨IP       å¤–éƒ¨IP            SSH ç™»å½•
			aaa     10.140.0.5   104.199.235.151   ssh v@104.199.235.151
			bbb     10.140.0.3   35.194.218.62     ssh v@35.194.218.62
			gce     10.140.0.2   35.194.128.92     ssh -p 2190 root@35.194.128.92

	â¦¿ ç½‘ç»œç¡®è®¤
		ç™»å½• aaa  ip addr âœ å­˜åœ¨ : inet 10.140.0.5/32 brd 10.140.0.5
		ç™»å½• bbb  ip addr âœ å­˜åœ¨ : inet 10.140.0.3/32 brd 10.140.0.3
		ç™»å½• gce  ip addr âœ å­˜åœ¨ : inet 10.140.0.2/32 brd 10.140.0.2

	â¦¿ äº’ ping ç¡®è®¤
		ç¡®ä¿ä¸‰å°æœºå™¨çš„ å†…ç½‘IP å¯ä»¥äº’ç›¸ping é€š





ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸


ğŸ”¸ æœåŠ¡å™¨å‡†å¤‡å·¥ä½œ 

	â¦¿ ssh è®¾ç½®:  ä¸Šä¼ mac å¯†é’¥ âœ 	ç”¨ v è´¦æˆ·å…å¯†ç ç™»å½• âœ  sudo su åˆ‡æ¢åˆ°root.
	â¦¿ å…³é—­ é˜²ç«å¢™  ??
	â¦¿ å…³é—­ SELINUX  ??
		â€¢ æŸ¥çœ‹å½“å‰çŠ¶æ€:   /usr/sbin/sestatus -v 
		â€¢ å…³é—­ SELINUX:   /etc/selinux/config  é‡Œçš„ SELINUX=enforcing æ”¹ä¸º SELINUX=disabled
		â€¢ sed ä¸€é”®å‘½ä»¤:	  sed -i '/SELINUX=enforcing/c SELINUX=disabled' /etc/selinux/config
		â€¢   é‡å¯æœåŠ¡å™¨:   reboot å°±è¡Œ. ä¸è¦å…³æœºå†å¯åŠ¨(éå¸¸å—), ä¸€ä¸ªæ˜¯è½¯é‡å¯. ä¸€ä¸ªæ˜¯ç¡¬é‡å¯.




ğŸ”¸ Ubuntu å‡†å¤‡ 

	â¦¿ åˆ‡æ¢root:    sudo su 
	â¦¿ æ›´æ–°è½¯ä»¶:    apt-get update
	â¦¿ å®‰è£… git:    sudo apt-get install git -y



ğŸ”¸ ä¸‹è½½ devstack
	å¼ºçƒˆå»ºè®®ä¸‹è½½åˆ° /opt/stack ä¸‹é¢. ä¸‹è½½å¥½åçš„è·¯å¾„: /opt/stack/devstack

	mkdir /opt/stack && cd /opt/stack && git clone https://git.openstack.org/openstack-dev/devstack && cd devstack




ğŸ”¸ åˆ›å»ºé…ç½®æ–‡ä»¶.

	åˆ›å»º:  cp /opt/stack/devstack/samples/local.conf /opt/stack/devstack/local.conf
	ç¼–è¾‘:  vi /opt/stack/devstack/local.conf

		[[local|localrc]]                          # å¼€å¤´.. éƒ½æ˜¯è¿™æ ·çš„. ä¸ç®¡
		MULTI_HOST=true                            # â—ï¸? æ·»åŠ :  ä¹Ÿå°±æ˜¯æœ‰å¤šä¸ªèŠ‚ç‚¹. 
		HOST_IP=35.194.253.203                     # â—ï¸ æ·»åŠ :  ç®¡ç†æœåŠ¡å™¨çš„IP! è¿™é‡Œæ˜¯æœ¬æœºip.

		#DISABLED_SERVICES=n-net'                  # ! æ³¨é‡Š ???

		LOGFILE=/opt/stack/devstack/stack.sh.log   # â—ï¸ å¿…é¡»æ”¹æ‰. æ—¥å¿—æ–‡ä»¶ä½ç½®.
		ADMIN_PASSWORD=nomoresecret                # é»˜è®¤å¯†ç , å»ºè®®æ”¹æ‰
		DATABASE_PASSWORD=stackdb                  # é»˜è®¤å¯†ç 
		RABBIT_PASSWORD=stackqueue                 # é»˜è®¤å¯†ç 
		SERVICE_PASSWORD=$ADMIN_PASSWORD           # é»˜è®¤å¯†ç 



ğŸ”¸ é…ç½®ç”¨æˆ· 
	Devstack è„šæœ¬ ä¸èƒ½ç”¨root ç”¨æˆ·è¿è¡Œ.å¿…é¡»ä¸èƒ½ç”¨ root è¿è¡Œ! æ‰€ä»¥è¦æ–°å»ºä¸ªç”¨æˆ·
	Devstack è„šæœ¬ éœ€è¦ root æƒé™.
	åˆ›å»ºç”¨æˆ·ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨. Devstack è‡ªå¸¦åˆ›å»ºç”¨æˆ·çš„è„šæœ¬.

	â¦¿ è„šæœ¬è‡ªåŠ¨åˆ›å»º (æ¨è)
		â€¢ åˆ›å»ºç”¨æˆ· 		/opt/stack/devstack/tools/create-stack-user.sh
		â€¢ æ–‡ä»¶å¤¹æƒé™    chown -R stack:stack /opt/stack/devstack
		â€¢ ç™»å½•ç”¨æˆ·	    su stack


	â¦¿ æ‰‹åŠ¨åˆ›å»º (å¯é€‰)
		â€¢ åˆ›å»ºç”¨æˆ·    sudo useradd -s /bin/bash -d /opt/stack -m stack
		â€¢ æƒé™è®¾ç½®    echo "stack ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/stack
			è¿™é‡Œé»˜è®¤æŠŠ stack ç™»å½•ä½ç½®æ”¹åˆ° /opt/stack äº†. çŸ¥é“å°±è¡Œ.
		â€¢ ç™»å½•ç”¨æˆ·    sudo su - stack



ğŸ”¸ å¼€å§‹éƒ¨ç½²:  
	sudo su  å…ˆç™»å½• root . ä¸ç„¶ ç™»å½• stack è¦å¯†ç .    ç¡®ä¿ç°åœ¨æ˜¯ su stack
	/opt/stack/devstack/stack.sh   æ—¶é—´è›®é•¿çš„!  


ğŸ”¸ å‘½ä»¤
    sudo systemctl stop devstack@dstat.service
    sudo systemctl start devstack@dstat.service
    sudo systemctl status devstack@dstat.service


ğŸ”¸ Horizon ç™»å½•   http://10.140.0.5/dashboard
	admin / nomoresecret
	å…·ä½“å¯†ç  vi /opt/stack/devstack/local.conf é‡Œé¢çœ‹ 



ğŸ”¸ å¤–ç½‘é…ç½®
ä¸Šé¢åªèƒ½ç”¨å†…ç½‘IP è®¿é—®. å¿…é¡»ç”¨vpnæ‰è¡Œ. å¤ªéº»çƒ¦äº† ç°åœ¨æˆ‘ä»¬æ¥é…ç½®å¤–ç½‘è®¿é—®.
æˆ‘ä»¬éœ€è¦åœ¨ Neutron ä¸­å®šä¹‰å¤–éƒ¨ç½‘ç»œçš„å¯¹è±¡ï¼Œè¿™æ · router æ‰çŸ¥é“å¦‚ä½•å°†ç§Ÿæˆ·ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œè¿æ¥èµ·æ¥

ç®¡ç†å‘˜ âœ ç½‘ç»œ âœ ç½‘ç»œ âœ åˆ›å»ºç½‘ç»œ.
â¦¿ ç½‘ç»œ 
	åç§°: ext_net 
	é¡¹ç›®: ??
	ä¾›åº”å•†ç½‘ç»œç±»å‹: Flat 
	ç‰©ç†ç½‘ç»œ: external

â¦¿ å­ç½‘ 
?



â¦¿ å­ç½‘è¯¦æƒ…
??

