â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ è®¡ç®—æœåŠ¡ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

ğŸ”¸ åºŸè¯

    OpenStackè®¡ç®—ç»„ä»¶è¯·æ±‚OpenStack IdentityæœåŠ¡è¿›è¡Œè®¤è¯ï¼›
    è¯·æ±‚OpenStack ImageæœåŠ¡æä¾›ç£ç›˜é•œåƒï¼›
    ä¸ºOpenStack dashboardæä¾›ç”¨æˆ·ä¸ç®¡ç†å‘˜æ¥å£ã€‚
    ç£ç›˜é•œåƒè®¿é—®é™åˆ¶åœ¨é¡¹ç›®ä¸ç”¨æˆ·ä¸Šï¼›
    é…é¢ä»¥æ¯ä¸ªé¡¹ç›®è¿›è¡Œè®¾å®šï¼ˆä¾‹å¦‚ï¼Œæ¯ä¸ªé¡¹ç›®ä¸‹å¯ä»¥åˆ›å»ºå¤šå°‘å®ä¾‹ï¼‰ã€‚
    OpenStackç»„ä»¶å¯ä»¥åœ¨æ ‡å‡†ç¡¬ä»¶ä¸Šæ°´å¹³å¤§è§„æ¨¡æ‰©å±•ï¼Œå¹¶ä¸”ä¸‹è½½ç£ç›˜é•œåƒå¯åŠ¨è™šæ‹Ÿæœºå®ä¾‹ã€‚


ğŸ”¸ æ•°æ®åº“æ“ä½œ .
    æŸ¥çœ‹æ•°æ®åº“: show databases; 
    åˆ é™¤æ•°æ®åº“: drop database nova;
    åˆ é™¤æ•°æ®åº“: drop database nova_api;
    åˆ é™¤æ•°æ®åº“: drop database nova_cell0;


ğŸ”¸ cell map æ˜¯ä»€ä¹ˆ...



ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸å‡†å¤‡å·¥ä½œğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸


ğŸ”¸ æ•°æ®åº“è®¾ç½® 
    è®¡ç®—ç»„ä»¶ä¹Ÿéœ€è¦å•ç‹¬åˆ›å»ºæ•°æ®åº“. è¿˜æ˜¯ä¸¤ä¸ªæ•°æ®åº“.



ğŸ”¸ åˆ›å»ºè¯¥æœåŠ¡çš„æ•°æ®åº“å’Œæ•°æ®åº“ç®¡ç†è´¦æˆ·
    æ³¨æ„ nova_cell0 è¿™ä¸ªæ•°æ®åº“. å®˜ç½‘æ•™ç¨‹æ²¡æœ‰! ä¸åˆ›å»ºåé¢ä¼šæŠ¥é”™!

    â€¢ ç™»å½•æ•°æ®åº“.              mysql -u root -ptoor
    â€¢ åˆ›å»º nova_api æ•°æ®åº“ï¼š   CREATE DATABASE nova_api;
    â€¢ åˆ›å»º nova     æ•°æ®åº“ï¼š   CREATE DATABASE nova;
    â€¢ åˆ›å»º nova_cell0 æ•°æ®åº“ï¼š CREATE DATABASE nova_cell0; 

    â€¢ åˆ›å»ºæ•°æ®åº“ç”¨æˆ·.å¹¶ç»™æƒé™, å¯†ç è‡ªå·±è®¾ç½®
        GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
        GRANT ALL PRIVILEGES ON nova_api.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
        GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
        GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
        GRANT ALL PRIVILEGES ON nova_cell0.* TO'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
        GRANT ALL PRIVILEGES ON nova_cell0.* TO'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';

    â€¢ é€€å‡ºæ•°æ®åº“:    exit;




ğŸ”¸ admin ç¯å¢ƒ:    source admin-openrc



ğŸ”¸ åˆ›å»ºnovaç”¨æˆ·ã€æœåŠ¡ã€API

    â¦¿ åˆ›å»º nova ç”¨æˆ·ï¼š
        openstack user create --domain default --password-prompt nova
            è®¾ç½®å¯†ç : nova-passwd

    â¦¿ ç»™ç”¨æˆ·åˆ†é… admin ç®¡ç†å‘˜è§’è‰²ï¼š
        openstack role add --project service --user nova admin


    â¦¿ åˆ›å»º nova æœåŠ¡ï¼š
        openstack service create --name nova --description "OpenStack Compute" compute

    â¦¿ åˆ›å»º Compute æœåŠ¡ API ï¼š
        openstack endpoint create --region RegionOne compute public http://controller:8774/v2.1
        openstack endpoint create --region RegionOne compute internal http://controller:8774/v2.1
        openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1




ğŸ”¸ åˆ›å»ºplacementç”¨æˆ·ã€æœåŠ¡ã€API

    â¦¿ åˆ›å»ºplacement ç”¨æˆ·
        openstack user create --domain default --password-prompt placement
            è®¾ç½®å¯†ç : placement-passwd

   â¦¿ ç»™ç”¨æˆ·åˆ†é… admin ç®¡ç†å‘˜è§’è‰²
        openstack role add --project service --user placement admin

    â¦¿ åˆ›å»ºplacement æœåŠ¡
        openstack service create --name placement --description "Placement API" placement

    â¦¿ åˆ›å»º Placement API
        openstack endpoint create --region RegionOne placement public http://controller:8778
        openstack endpoint create --region RegionOne placement internal http://controller:8778
        openstack endpoint create --region RegionOne placement admin http://controller:8778




ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸å®‰è£…é…ç½®ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸


ğŸ”¸ å®‰è£…

    yum install openstack-nova-api openstack-nova-conductor \
    openstack-nova-console openstack-nova-novncproxy \
    openstack-nova-scheduler openstack-nova-placement-api -y



ğŸ”¸ é…ç½®   vi /etc/nova/nova.conf

    [DEFAULT] 
    # æ·»åŠ . æ— éœ€ä¿®æ”¹ 
    enabled_apis = osapi_compute,metadata

    # RABBIT_PASS æ”¹æˆç¯å¢ƒé…ç½®.txt é‡Œ æ¶ˆæ¯é˜Ÿåˆ— é‡Œè®¾ç½®çš„rabbitmq å¯†ç 
    transport_url = rabbit://openstack:RABBIT_PASS@controller

    # æ·»åŠ è¡Œ. æ”¹æˆä½ æœåŠ¡å™¨æœ¬åœ°çš„ç®¡ç†æ¥å£çš„IP. 
    my_ip = 192.168.1.112

    # ä¸‹ä¸¤è¡Œæ˜¯é˜²ç«å¢™è®¾ç½®. ä½¿ç”¨ç½‘ç»œæœåŠ¡ä¸­çš„é˜²ç«å¢™. è€Œä¸æ˜¯è®¡ç®—æœåŠ¡ä¸­çš„é˜²ç«å¢™.
    use_neutron = True
    firewall_driver = nova.virt.firewall.NoopFirewallDriver



    [api]
    # æ·»åŠ ä¸€è¡Œ, æ— éœ€ä¿®æ”¹
    auth_strategy = keystone

    [api_database] 
    # æ·»åŠ  + æ”¹ä½ è®¾ç½®çš„ nova_api ç”¨æˆ·çš„æ•°æ®åº“å¯†ç .
    connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api

    [database] 
    # æ·»åŠ  + å¡«ä½ novaçš„æ•°æ®åº“å¯†ç .
    connection = mysql+pymysql://nova:NOVA_DBPASS@controller/nova


    [keystone_authtoken]
    # æ·»åŠ  + passwordçš„å€¼æ”¹æˆä½ è‡ªå·±çš„ nova ç”¨æˆ·çš„å¯†ç . 
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = nova
    password = nova-passwd



    [vnc]
    # æ·»åŠ ä¸‰è¡Œ, æ— éœ€ä¿®æ”¹
    # é…ç½®VNCä»£ç†ä½¿ç”¨æ§åˆ¶èŠ‚ç‚¹çš„ç®¡ç†æ¥å£IPåœ°å€.
    enabled = true
    vncserver_listen = $my_ip
    vncserver_proxyclient_address = $my_ip



    [glance]
    # é…ç½®é•œåƒæœåŠ¡ API çš„ä½ç½®ï¼š
    api_servers = http://controller:9292


    [oslo_concurrency]
    # é…ç½®é”è·¯å¾„ï¼š
    lock_path = /var/lib/nova/tmp


    [placement]
    # éœ€è¦ä¿®æ”¹å¯†ç    placement-passwd
    # é…ç½® placementçš„ API
    os_region_name = RegionOne
    project_domain_name = Default
    project_name = service
    auth_type = password
    user_domain_name = Default
    auth_url = http://controller:35357/v3
    username = placement
    password =  placement-passwd




ğŸ”¸ vi /etc/httpd/conf.d/00-nova-placement-api.conf  
    å°¾éƒ¨æ·»åŠ  
        <Directory /usr/bin>
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
        <IfVersion < 2.4>
            Order allow,deny
            Allow from all
        </IfVersion>
        </Directory>


ğŸ”¸ apache é‡å¯          systemctl restart httpd


ğŸ”¸ åŒæ­¥æ•°æ®åº“.

    â¦¿ åŒæ­¥ nova-api æ•°æ®åº“  su -s /bin/sh -c "nova-manage api_db sync" nova
    â¦¿ åŒæ­¥ cell0    æ•°æ®åº“  su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova
    â¦¿                       su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova
    â¦¿ åŒæ­¥ nova     æ•°æ®åº“  su -s /bin/sh -c "nova-manage db sync" nova
            âŒ âŒ âŒ âŒ âŒ âŒ âœ  æœªè§£å†³!  
            ğŸ‘¹ /usr/lib/python2.7/site-packages/pymysql/cursors.py:166: Warning: (1831, u'Duplicate index `block_device_mapping_instance_uuid_virtual_name_device_name_idx`. This is deprecated and will be disallowed in a future release.')
            result = self._query(query)
            /usr/lib/python2.7/site-packages/pymysql/cursors.py:166: Warning: (1831, u'Duplicate index `uniq_instances0uuid`. This is deprecated and will be disallowed in a future release.')
            result = self._query(query)


ğŸ”¸ æŸ¥çœ‹cell_v2æ‰€ç”Ÿæˆçš„UUID
    nova-manage cell_v2 list_cells
    +-------+--------------------------------------+
    | Name  | UUID                                 |
    +-------+--------------------------------------+
    | cell1 | 109e1d4b-536a-40d0-83c6-5f121b82b650 |
    | cell0 | 00000000-0000-0000-0000-000000000000 |
    +-------+--------------------------------------+


ğŸ”¸ Nova å¼€æœºè‡ªå¯ 
    systemctl enable openstack-nova-api.service \
    openstack-nova-consoleauth.service openstack-nova-scheduler.service \
    openstack-nova-conductor.service openstack-nova-novncproxy.service


ğŸ”¸ Nova å¯åŠ¨ 
    systemctl start openstack-nova-api.service \
    openstack-nova-consoleauth.service openstack-nova-scheduler.service \
    openstack-nova-conductor.service openstack-nova-novncproxy.service


ğŸ”¸ Nova çŠ¶æ€ 
    systemctl status openstack-nova-api.service \
    openstack-nova-consoleauth.service openstack-nova-scheduler.service \
    openstack-nova-conductor.service openstack-nova-novncproxy.service



