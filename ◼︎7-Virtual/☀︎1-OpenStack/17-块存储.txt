â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ å— å­˜ å‚¨ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸

äº‘ è‚¯å®šè¦è¿›è¡Œæ•°æ®å­˜å‚¨çš„.å¯ä»¥ç”¨æœåŠ¡å™¨ä¸Šçš„ç¡¬ç›˜,ä¹Ÿå¯ä»¥ç”¨ NAS/SAN è¿™ç±»ä¸“ç”¨å­˜å‚¨.

OpenStackå—å­˜å‚¨æœåŠ¡(cinder)ä¸ºè™šæ‹Ÿæœºæ·»åŠ æŒä¹…çš„å­˜å‚¨ï¼Œå—å­˜å‚¨æä¾›ä¸€ä¸ªåŸºç¡€è®¾æ–½ä¸ºäº†ç®¡ç†å·ï¼Œä»¥åŠå’ŒOpenStackè®¡ç®—æœåŠ¡äº¤äº’ï¼Œä¸ºå®ä¾‹æä¾›å·ã€‚æ­¤æœåŠ¡ä¹Ÿä¼šæ¿€æ´»ç®¡ç†å·çš„å¿«ç…§å’Œå·ç±»å‹çš„åŠŸèƒ½ã€‚



ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸æ§åˆ¶èŠ‚ç‚¹ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸


ğŸ”¸ åˆ›å»ºæ•°æ®åº“/æ•°æ®åº“ç”¨æˆ·
    mysql -u root -ptoor
    CREATE DATABASE cinder;
    GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'localhost' IDENTIFIED BY 'CINDER_DBPASS';
    GRANT ALL PRIVILEGES ON cinder.* TO 'cinder'@'%' IDENTIFIED BY 'CINDER_DBPASS';
    exit;



ğŸ”¸ admin ç¯å¢ƒ:    source admin-openrc
    

ğŸ”¸ åˆ›å»º cinder ç”¨æˆ·ã€æœåŠ¡ã€API
    
    â¦¿ åˆ›å»º cinder ç”¨æˆ·     
        openstack user create --domain default --password-prompt cinder
        è®¾ç½®å¯†ç : cinder-passwd

    â¦¿ ç»™ cinder ç”¨æˆ·åˆ†é… admin ç®¡ç†å‘˜è§’è‰²ï¼š
        openstack role add --project service --user cinder admin

    â¦¿ åˆ›å»ºä¸¤ä¸ª cinder æœåŠ¡ï¼š
        openstack service create --name cinderv2 --description "OpenStack Block Storage" volumev2
        openstack service create --name cinderv3 --description "OpenStack Block Storage" volumev3


    â¦¿ åˆ›å»º cinder æœåŠ¡ API ï¼š
        openstack endpoint create --region RegionOne \
        volumev2 public http://controller:8776/v2/%\(project_id\)s

        openstack endpoint create --region RegionOne \
        volumev2 internal http://controller:8776/v2/%\(project_id\)s

        openstack endpoint create --region RegionOne \
        volumev2 admin http://controller:8776/v2/%\(project_id\)s

        openstack endpoint create --region RegionOne \
        volumev3 public http://controller:8776/v3/%\(project_id\)s

        openstack endpoint create --region RegionOne \
        volumev3 internal http://controller:8776/v3/%\(project_id\)s

        openstack endpoint create --region RegionOne \
        volumev3 admin http://controller:8776/v3/%\(project_id\)s



ğŸ”¸ å®‰è£…    yum install openstack-cinder -y

ğŸ”¸ é…ç½®    vi /etc/cinder/cinder.conf

    [DEFAULT]

    # æ”¹å¯†ç 
    transport_url = rabbit://openstack:RABBIT_PASS@controller
    # ...
    auth_strategy = keystone
    # â—ï¸ æ”¹IP
    my_ip = 192.168.1.112


    [keystone_authtoken]
    # â—ï¸ æ”¹å¯†ç 
    auth_uri = http://controller:5000
    auth_url = http://controller:35357
    memcached_servers = controller:11211
    auth_type = password
    project_domain_name = default
    user_domain_name = default
    project_name = service
    username = cinder
    password = cinder-pass


    [database]
    # æ”¹ cinder æ•°æ®åº“å¯†ç .
    connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder


    [oslo_concurrency]
    # ...
    lock_path = /var/lib/cinder/tmp




ğŸ”¸ åˆå§‹åŒ–å—è®¾å¤‡æœåŠ¡çš„æ•°æ®åº“ï¼š
    su -s /bin/sh -c "cinder-manage db sync" cinder
    ğŸ‘¹ Option "logdir" from group "DEFAULT" is deprecated. Use option "log-dir" from group "DEFAULT".
    â—ï¸ å¿½ç•¥è¾“å‡ºä¸­ä»»ä½•ä¸æ¨èä½¿ç”¨çš„ä¿¡æ¯,  ä¹Ÿå°±æ˜¯å¿½ç•¥è¿™ä¸ªæç¤º..




ğŸ”¸ é…ç½®è®¡ç®—èŠ‚ç‚¹ä»¥ä½¿ç”¨å—è®¾å¤‡å­˜å‚¨
    vi /etc/nova/nova.conf

    [cinder]
    # æ·»åŠ 
    os_region_name = RegionOne



ğŸ”¸ é‡å¯ Nova API æœåŠ¡ï¼š
    systemctl restart openstack-nova-api.service

ğŸ”¸ Cinder å¼€æœºå¯åŠ¨ 
    systemctl enable openstack-cinder-api.service openstack-cinder-scheduler.service

ğŸ”¸ Cinder è¿è¡Œ 
    systemctl start openstack-cinder-api.service openstack-cinder-scheduler.service




ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸å­˜å‚¨èŠ‚ç‚¹ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸
ğŸ”¸ å­˜å‚¨èŠ‚ç‚¹å¯ä»¥å®‰è£…åœ¨ä¸€èµ·.

ğŸ”¸ LVM ç®€ä»‹
    LVMåˆ©ç”¨Linuxå†…æ ¸çš„device-mapperæ¥å®ç°å­˜å‚¨ç³»ç»Ÿçš„è™šæ‹ŸåŒ–ï¼ˆç³»ç»Ÿåˆ†åŒºç‹¬ç«‹äºåº•å±‚ç¡¬ä»¶)
    ç®€å•çš„è¯´... å¹³æ—¶å®‰è£…ç³»ç»Ÿçš„æ—¶å€™éƒ½ä¼šè¿›è¡Œåˆ†åŒº.  win7 å¦‚æœcç›˜ä¸å¤Ÿç”¨.é‚£ä¹ˆåªèƒ½é‡è£…ç³»ç»Ÿ.
    ä½†æ˜¯ Linux çš„è¯, ç”¨ LVM å¯ä»¥è‡ªåŠ¨è°ƒæ•´åˆ†åŒºå¤§å°.. 


    â¦¿ pvcreate å‘½ä»¤
        å°†ç‰©ç†ç¡¬ç›˜åˆ†åŒºåˆå§‹åŒ–ä¸ºç‰©ç†å·ï¼Œä»¥ä¾¿LVMä½¿ç”¨ã€‚

    â¦¿ fdisk -l  æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ï¼š
    è®¾å¤‡ Boot      Start         End      Blocks   Id  System
        /dev/sda1   *        2048     2099199     1048576   83  Linux
        /dev/sda2         2099200    41943039    19921920   8e  Linux LVM

    â¦¿ pvscan æ£€æŸ¥æœ‰æ—  PV åœ¨ç³»ç»Ÿä¸Š
    PV /dev/sda2   VG cl              lvm2 [19.00 GiB / 0    free]
    Total: 1 [19.00 GiB] / in use: 1 [19.00 GiB] / in no VG: 0 [0   ]



ğŸ”¸ å®‰è£… LVM åŒ…ï¼š
    yum install lvm2 -y
    systemctl enable lvm2-lvmetad.service
    systemctl start lvm2-lvmetad.service


ğŸ”¸ åˆ›å»ºLVM ç‰©ç†å· /dev/sdbï¼š
    pvcreate /dev/sdb
        ğŸ‘¹ Device /dev/sdb not found (or ignored by filtering).
        df æŸ¥çœ‹ 


ğŸ”¸ åˆ›å»º LVM å·ç»„ cinder-volumesï¼š
    å—å­˜å‚¨æœåŠ¡ä¼šåœ¨è¿™ä¸ªå·ç»„ä¸­åˆ›å»ºé€»è¾‘å·ã€‚åªæœ‰å®ä¾‹å¯ä»¥è®¿é—®å—å­˜å‚¨å·ç»„ã€‚
    vgcreate cinder-volumes /dev/sdb



ğŸ”¸ å®‰è£…
    yum install openstack-cinder targetcli python-keystone



ğŸ”¸ é…ç½® 
    vi /etc/cinder/cinder.conf    

[database]
# ...
connection = mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder

[DEFAULT]
# ...
transport_url = rabbit://openstack:RABBIT_PASS@controller


[DEFAULT]
# ...
auth_strategy = keystone

[keystone_authtoken]
# ...
auth_uri = http://controller:5000
auth_url = http://controller:35357
memcached_servers = controller:11211
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = service
username = cinder
password = CINDER_PASS    

[DEFAULT]
# ...
my_ip = MANAGEMENT_INTERFACE_IP_ADDRESS


[lvm]
volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
volume_group = cinder-volumes
iscsi_protocol = iscsi
iscsi_helper = lioadm


[DEFAULT]
# ...
enabled_backends = lvm



[DEFAULT]
# ...
glance_api_servers = http://controller:9292



[oslo_concurrency]
# ...
lock_path = /var/lib/cinder/tmp


ğŸ”¸ è‡ªå¯   systemctl enable openstack-cinder-volume.service target.service
ğŸ”¸ å¯åŠ¨   systemctl start openstack-cinder-volume.service target.service



ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸éªŒè¯ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

ğŸ”¸ admin ç¯å¢ƒ:    source admin-openrc

    openstack volume service list





