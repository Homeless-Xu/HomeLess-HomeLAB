â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ é•œåƒæœåŠ¡ ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ
â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸------â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸â¬›ï¸
ğŸ”¸ å‚¨å¤‡çŸ¥è¯†
    é•œåƒæœåŠ¡ (glance) å…è®¸ç”¨æˆ·å‘ç°ã€æ³¨å†Œå’Œè·å–è™šæ‹Ÿæœºé•œåƒã€‚



ğŸ”¸ å‡†å¤‡
    å®‰è£…å’Œé…ç½®é•œåƒæœåŠ¡ä¹‹å‰ï¼Œä½ å¿…é¡»åˆ›å»ºåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€æœåŠ¡å‡­è¯å’ŒAPIç«¯ç‚¹ã€‚

    â¦¿ åˆ›å»ºæ•°æ®åº“ 
        â€¢ ç™»å½•æ•°æ®åº“.    mysql -u root -p
        â€¢ åˆ›å»ºæ•°æ®åº“ï¼š   CREATE DATABASE glance;
        â€¢ åˆ›å»ºæ•°æ®åº“ç”¨æˆ·.å¹¶ç»™æƒé™, 
            GLANCE_DBPASS æ˜¯æ•°æ®åº“ç”¨æˆ· glance çš„å¯†ç . å¯ä»¥è‡ªå·±è®¾ç½®!
            GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'GLANCE_DBPASS';
            GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'GLANCE_DBPASS';
        â€¢ é€€å‡ºæ•°æ®åº“:    exit;



    â¦¿ é…ç½® admin ç¯å¢ƒ:  source admin-openrc 
        å› ä¸ºè¦æ‰§è¡Œä¸€äº›ç‰¹æ®Šå‘½ä»¤. éœ€è¦ admin æƒé™.  
        è¦ä½¿ç”¨ admin, å°±éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® adminçš„ç”¨æˆ· å¯†ç  ç­‰ç­‰å‚æ•°.
        å¯ä»¥ç”¨ . admin-openrc æˆ– source admin-openrc æ¥å¿«é€Ÿè®¾ç½®ç¯å¢ƒå˜é‡.
        è¿™æ ·ä¸ä¸éœ€è¦ æ‰‹åŠ¨æ‰§è¡Œå¾ˆå¤šè¡Œç±»ä¼¼ export OS_USERNAME=demo è¿™æ ·çš„å‘½ä»¤äº†


    â¦¿ åˆ›å»º  glance user:
        openstack user create --domain default --password-prompt glance
            å¯†ç è®¾ç½®æˆ glance-passwd
            +---------------------+----------------------------------+
            | Field               | Value                            |
            +---------------------+----------------------------------+
            | domain_id           | default                          |
            | enabled             | True                             |
            | id                  | 59d8ba2128f34d9b8ce7d6abb7a86e94 |
            | name                | glance                           |
            | options             | {}                               |
            | password_expires_at | None                             |
            +---------------------+----------------------------------+

    â¦¿ æ·»åŠ  admin è§’è‰²åˆ° glance ç”¨æˆ·å’Œ service é¡¹ç›®ä¸Š
        openstack role add --project service --user glance admin


    â¦¿ åˆ›å»º glance æœåŠ¡å®ä½“ï¼š
        openstack service create --name glance --description "OpenStack Image" image
            +-------------+----------------------------------+
            | Field       | Value                            |
            +-------------+----------------------------------+
            | description | OpenStack Image                  |
            | enabled     | True                             |
            | id          | 0321823e7fec4ed4ade5d46d2d8ad89b |
            | name        | glance                           |
            | type        | image                            |
            +-------------+----------------------------------+


    â¦¿ åˆ›å»ºé•œåƒæœåŠ¡çš„ API ç«¯ç‚¹ï¼š

        openstack endpoint create --region RegionOne image public http://controller:9292
            +--------------+----------------------------------+
            | Field        | Value                            |
            +--------------+----------------------------------+
            | enabled      | True                             |
            | id           | 310d9e7506b64ba7bb23a691eca949a4 |
            | interface    | public                           |
            | region       | RegionOne                        |
            | region_id    | RegionOne                        |
            | service_id   | 0321823e7fec4ed4ade5d46d2d8ad89b |
            | service_name | glance                           |
            | service_type | image                            |
            | url          | http://controller:9292           |
            +--------------+----------------------------------+


        openstack endpoint create --region RegionOne image internal http://controller:9292
            +--------------+----------------------------------+
            | Field        | Value                            |
            +--------------+----------------------------------+
            | enabled      | True                             |
            | id           | 20c4986553ab4dbf9a1553c165be0d63 |
            | interface    | internal                         |
            | region       | RegionOne                        |
            | region_id    | RegionOne                        |
            | service_id   | 0321823e7fec4ed4ade5d46d2d8ad89b |
            | service_name | glance                           |
            | service_type | image                            |
            | url          | http://controller:9292           |
            +--------------+----------------------------------+



        openstack endpoint create --region RegionOne image admin http://controller:9292
            +--------------+----------------------------------+
            | Field        | Value                            |
            +--------------+----------------------------------+
            | enabled      | True                             |
            | id           | 43af1ba8e2f14e1489c3257b20dad47c |
            | interface    | admin                            |
            | region       | RegionOne                        |
            | region_id    | RegionOne                        |
            | service_id   | 0321823e7fec4ed4ade5d46d2d8ad89b |
            | service_name | glance                           |
            | service_type | image                            |
            | url          | http://controller:9292           |
            +--------------+----------------------------------+



ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸å®‰è£…é…ç½®ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

ğŸ”¸ glance å®‰è£…:    yum install openstack-glance -y
    ğŸ‘¹ python-networkx-core-1.10-1.el7.noarch: [Errno 256] No more mirrors to try.
    å¦‚é‡åˆ° No more mirrors to try æŠ¥é”™å¯ä»¥ç”¨ yum clean metadata && yum clean all

    å†ä¸è¡Œä¸Š ç»ˆç«¯ä»£ç†. éœ€è¦è‡ªå·±æ”¹IP. å’Œç«¯å£. 
    export https_proxy=http://192.168.1.222:9090;export http_proxy=http://192.168.1.222:9090
    .. è¿™å°±å¯ä»¥äº†. è¯¶. å›½å†…çš„å¢™å•Š... æ— è¯­..


ğŸ”¸ glance é…ç½®1:    vi /etc/glance/glance-api.conf
    
    â€¢ [database] éƒ¨åˆ†ä¸‹æ·»åŠ ä¸€è¡Œ: ç”¨æ¥é…ç½®æ•°æ®åº“è®¿é—®.
        connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
            GLANCE_DBPASS æ”¹æˆä½ åœ¨æ•°æ®åº“ä¸­ç»™ glance ç”¨æˆ·è®¾ç½®çš„å¯†ç .
            vi çš„è¯ å¯ä»¥ç”¨ :/[databse] æ¥æŸ¥æ‰¾æ–‡ä»¶. å¿«é€Ÿå®šä½è¡Œ..


    â€¢ [keystone_authtoken] ä¸‹æ·»åŠ 
        auth_uri = http://controller:5000
        auth_url = http://controller:35357
        memcached_servers = controller:11211
        auth_type = password
        project_domain_name = default
        user_domain_name = default
        project_name = service
        username = glance
        password = glance-passwd
            å°† password å‚æ•°å€¼ æ›¿æ¢ä¸ºä½ ä¸ºè®¤è¯æœåŠ¡ä¸­ä½ ä¸º glance ç”¨æˆ·é€‰æ‹©çš„å¯†ç . 
            æˆ‘è¿™é‡Œæ˜¯ glance-passwd
            [keystone_authtoken] ä¸­æ³¨é‡Šæˆ–è€…åˆ é™¤å…¶ä»–é€‰é¡¹. åªä¿ç•™æˆ‘ä»¬ä¸Šé¢è®¾ç½®çš„.


    â€¢ [paste_deploy] ä¸‹æ·»åŠ ä¸€è¡Œ: 
        flavor = keystone

    â€¢ [glance_store] ä¸‹æ·»åŠ ä¸‰è¡Œ
        stores = file,http
        default_store = file
        filesystem_store_datadir = /var/lib/glance/images/





ğŸ”¸ glance é…ç½®2:    vi /etc/glance/glance-registry.conf

    â€¢ [database]
        connection = mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
            GLANCE_DBPASS æ”¹æˆä½ åœ¨æ•°æ®åº“ä¸­ç»™ glance ç”¨æˆ·è®¾ç½®çš„å¯†ç .


    â€¢ [keystone_authtoken]
        auth_uri = http://controller:5000
        auth_url = http://controller:35357
        memcached_servers = controller:11211
        auth_type = password
        project_domain_name = default
        user_domain_name = default
        project_name = service
        username = glance
        password = glance-passwd
            å°† password å‚æ•°å€¼ æ›¿æ¢ä¸ºä½ ä¸ºè®¤è¯æœåŠ¡ä¸­ä½ ä¸º glance ç”¨æˆ·é€‰æ‹©çš„å¯†ç . 
            [keystone_authtoken] ä¸­æ³¨é‡Šæˆ–è€…åˆ é™¤å…¶ä»–é€‰é¡¹. åªä¿ç•™æˆ‘ä»¬ä¸Šé¢è®¾ç½®çš„.
            â—ï¸ ç¬¬ä¸€è¡Œçš„ auth_uri  ä¸æ˜¯ auth_url 
                URL æ˜¯ URI çš„å­é›†ã€‚
                ä»»ä½•ä¸œè¥¿ï¼Œåªè¦èƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è¯†å‡ºæ¥ï¼Œéƒ½å¯ä»¥è¯´è¿™ä¸ªæ ‡è¯†æ˜¯ URI ã€‚
                å¦‚æœè¿™ä¸ªæ ‡è¯†æ˜¯ä¸€ä¸ªå¯è·å–åˆ°ä¸Šè¿°å¯¹è±¡çš„è·¯å¾„ï¼Œé‚£ä¹ˆåŒæ—¶å®ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URL ï¼›
                ä½†å¦‚æœè¿™ä¸ªæ ‡è¯†ä¸æä¾›è·å–åˆ°å¯¹è±¡çš„è·¯å¾„ï¼Œé‚£ä¹ˆå®ƒå°±å¿…ç„¶ä¸æ˜¯ URL ã€‚ 


    â€¢ [paste_deploy]
        flavor = keystone




ğŸ”¸ å†™å…¥é•œåƒæœåŠ¡æ•°æ®åº“ï¼šè¯¥å‘½ä»¤çš„çš„è¾“å‡ºä¸ç”¨ç®¡!!
    su -s /bin/sh -c "glance-manage db_sync" glance
    

ğŸ”¸ é•œåƒæœåŠ¡å¼€æœºè‡ªå¯
    systemctl enable openstack-glance-api.service openstack-glance-registry.service

ğŸ”¸ é•œåƒæœåŠ¡å¯åŠ¨
    systemctl start openstack-glance-api.service openstack-glance-registry.service

ğŸ”¸ é•œåƒæœåŠ¡é‡å¯
    systemctl restart openstack-glance-api.service openstack-glance-registry.service

ğŸ”¸ é•œåƒæœåŠ¡çŠ¶æ€
    systemctl status openstack-glance-api.service openstack-glance-registry.service


ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸éªŒè¯ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸ğŸ”¸

ğŸ”¸ åºŸè¯:     ä¸‹è½½ä¸ªé•œåƒæ¥æµ‹è¯•ä¸‹ glance æ˜¯å¦æ­£å¸¸.

ğŸ”¸ è®¾ç½® admin ç¯å¢ƒå˜é‡:   source admin-openrc

ğŸ”¸ ä¸‹è½½é•œåƒ:  wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img

ğŸ”¸ ä¸Šä¼ é•œåƒåˆ° image server; 
    ä½¿ç”¨ QCOW2 ç£ç›˜æ ¼å¼; ä½¿ç”¨ bare å®¹å™¨æ ¼å¼;
    è®¾ç½®å…¬å…±å¯è§: æ‰€æœ‰é¡¹ç›®éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªé•œåƒï¼š

    openstack image create "cirros" \
    --file cirros-0.3.5-x86_64-disk.img \
    --disk-format qcow2 --container-format bare \
    --public
        +------------------+------------------------------------------------------+
        | Field            | Value                                                |
        +------------------+------------------------------------------------------+
        | checksum         | f8ab98ff5e73ebab884d80c9dc9c7290                     |
        | container_format | bare                                                 |
        | created_at       | 2017-08-25T12:12:49Z                                 |
        | disk_format      | qcow2                                                |
        | file             | /v2/images/5f1ad43b-4e95-4d87-96da-4dcd0e51a66f/file |
        | id               | 5f1ad43b-4e95-4d87-96da-4dcd0e51a66f                 |
        | min_disk         | 0                                                    |
        | min_ram          | 0                                                    |
        | name             | cirros                                               |
        | owner            | 48cbf0c9f5854d64aea5f260c7b7221e                     |
        | protected        | False                                                |
        | schema           | /v2/schemas/image                                    |
        | size             | 13267968                                             |
        | status           | active                                               |
        | tags             |                                                      |
        | updated_at       | 2017-08-25T12:12:51Z                                 |
        | virtual_size     | None                                                 |
        | visibility       | public                                               |
        +------------------+------------------------------------------------------+
            æœ‰æ—¶å€™ä¼šåˆ›å»ºå¤±è´¥...  å¯ä»¥æ–°å»ºä¸ªé¡¹ç›®çœ‹çœ‹. 
            è¿™ä¸ªéœ€è¦ admin æƒé™çš„.å¯ä»¥çœ‹å‡ºæ˜¯è®¤è¯æœåŠ¡çš„é—®é¢˜ è¿˜æ˜¯ é•œåƒæœåŠ¡çš„é—®é¢˜.
            openstack project create --domain default --description "Test Project" test
            å¦‚æœå¯ä»¥åˆ›å»ºçš„.. è¯´æ˜.. æ˜¯é•œåƒé—®é¢˜..





ğŸ”¸ æŸ¥çœ‹é•œåƒ.
    openstack image list
    å¦‚æœä¸Šä¼ æˆåŠŸ å°±ä¼šæœ‰æ˜¾ç¤º.
    +--------------------------------------+--------+--------+
    | ID                                   | Name   | Status |
    +--------------------------------------+--------+--------+
    | 5f1ad43b-4e95-4d87-96da-4dcd0e51a66f | cirros | active |
    +--------------------------------------+--------+--------+

