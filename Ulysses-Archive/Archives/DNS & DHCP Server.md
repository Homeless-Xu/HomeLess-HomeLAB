## DNS & DHCP Server

本机搭建 DNS 服务器:
DNS 服务器 作用:
域名 → IP : 正向解析
IP → 域名 : 反向解析

用户上网  
1. 连接到 dns 服务器  查询到域名
2. 把 ip 返回给客户  
3. 用 ip 连接 web 服务器


域名 
采用分层结构 

最上面的是  
- 根域(root)

- 顶级域名
net 网络服务机构
 edu 教育部门
  com 商业部门
   gov 政府部门
mil 军事部门
 org 民间团体…


- 二级域名 (比如 顶级com 下面的各种网站)

- 三极域名 www / mail 




DNS 查询方式

递归查询

迭代查询




上网流程
要上 www.google.com
 1. 首先 将 www.google.com 发送给自己的首选 DNS 服务器  
 2. 首选DNS查询数据库,没有这个网址的记录 就会把这个 递送给更高级的 DNS 服务器
3. 域名解析成功后 客户端 将 http 请求发送给 web 服务器
4. web 服务器 响应客户端的访问请求  客户端就能上 google 了




# 安装 DNS 服务器 角色

条件: 配置静态 IP (ip+ 掩码) 工作组 或者域

服务器管理器 → 基于角色 或 功能 → DNS 管理控制台 → 正向查找区域 →  新建区域  →  主要区域 → 区域名 →  区域文件(nds 是文件 可以从别dns 服务器复制过来的) → 动态更新 (选择 不接受) →  完成 


## 创建反向查找区域:
选择 方向查找区域  新建区域 主要区域  ipv4 方向查找区域  网络 ID: 192.168.1 
新建区域文件 不允许动态更新 完成


资源记录类型
SOA 
NS 名称服务器
A 主机
PTR 指针
MX 邮件交换记录 向指定的邮件交换主机提供消息路由
SRV 服务 列出 正在提供特定服务的服务器
CNAME 别名 将多个名字 映射到同一台计算机上.

创建主机记录:
为公司的 web 服务器 创建一个域名到 ip 地址之间的 正向解析的主机记录

新建主机(A 或AAAA)
名称 www
域名 0219.oicp.net
ip 地址 192.168.6.1

新建别名记录(CNAME):
别名: ftp
域名: ftp.0219.oicp.net
ip 192.168.6.1


为公司的邮件服务器 创建 MX 邮件交换记录
新建邮件交换记录(MX)

完全限定的域名
0219.oicp.net
邮件服务器完全限定的域名
www.0219.oicp.net
邮件服务器优先级 10

为反向查找区域创建 反向 PTR 指针记录
反向查找区域 → 新建指针
主机 ip 
192.168.6.1
完全限定的域名
1.6.168.192.in-addr.arpa
 主机名
 www.0219.oicp.net
 
 
 用 DNS 客户机 来 验证各种资源记录.
 
 验证主机记录
 ping www.0219.oicp.net
 
 验证指针记录 PTR 
 终端 输入nslookup
然后就能输入内容了 
输入 localhost
Server:		192.168.11.254
Address:	192.168.11.254#53

Non-authoritative answer:
*** Can't find localhost: No answer


输入 www.baidu.com
Server:		192.168.11.254
Address:	192.168.11.254#53

Non-authoritative answer:
www.baidu.com	canonical name = www.a.shifen.com.
Name:	www.a.shifen.com
Address: 115.239.210.27
Name:	www.a.shifen.com
Address: 115.239.211.112

DNS 转发功能

假设 公司是一个域环境
有两颗域树 分别是 0219.com 023.com
每个域下面各有一台 DNS 服务器
192.168.6.1 
192.168.6.10

现在 0219 下的一个用户 要访问 0223 下的资源
可以实现 前提是:两个域必须能相互解析域名.

配置转发器:
两个本地 DNS 服务器 → 条件转发器 下面各自指向对方的 ip 地址 

1. 0219 DNS 服务器 → 条件转发器 → 新建条件转发器
2. DNS 域 xie 0223.com
3. IP 地址 写 192.168.6.10


0223 DNS 服务器 → 条件转发器 → 新建条件转发器
2. DNS 域 写 0219.com
3. IP 地址 写 192.168.6.1







---- 

# DHCP 服务简介:
  自动给局域网内的电脑 分配 IP. 

不开启这个功能 就只能每台电脑都手动设置 IP/ 子网掩码/网关/DNS 服务器地址了.

注: 一个局域网内 只能有一台 DHCP 服务器. 
你要电脑上安装 DHCP 服务功能 就得在路由器上关闭 DHCP 功能.
 


# 安装:
  添加角色功能 → 角色 选择 DHCP.

# 服务器断点配置

选择 IPv4 →  新建作用域  → 下一步……


# 授权 DHCP 服务器.
局域网 开启 AD 域的话 要经过授权 才能启动 DHCP 服务.
AD 授权的目的为了确保整个网络 只有一个DHCP.


授权: DHCP 工具界面下  选择 计算机名 然后操作菜单上 点击授权.

测试:
手机连上 wifi   地址租用里面 就能看到手机 了

地址保留(固定 IP)
作用域 → 地址保留 → 新建 输入 IP/Mac/描述

筛选器:  是否给特定 MAC 地址提供 DHCP 服务.










 
 
 















